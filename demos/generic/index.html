<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title>AXIA Interactive Demo V6.24</title>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 80 80'%3E%3Ccircle cx='40' cy='40' r='36' fill='%2309434e'/%3E%3Ccircle cx='40' cy='40' r='28' fill='none' stroke='%23fff' stroke-width='2'/%3E%3Ccircle cx='40' cy='40' r='18' fill='none' stroke='%23fff' stroke-width='1.5'/%3E%3Ccircle cx='40' cy='40' r='3' fill='%23fff'/%3E%3Cline x1='40' y1='8' x2='40' y2='18' stroke='%23fff' stroke-width='2'/%3E%3Cline x1='40' y1='62' x2='40' y2='72' stroke='%23fff' stroke-width='2'/%3E%3Cline x1='8' y1='40' x2='18' y2='40' stroke='%23fff' stroke-width='2'/%3E%3Cline x1='62' y1='40' x2='72' y2='40' stroke='%23fff' stroke-width='2'/%3E%3C/svg%3E"/>
    <link href="https://fonts.googleapis.com" rel="preconnect"/>
    <link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap" rel="stylesheet"/>
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script>
        // AXIA Demo V6.24 - Insights tab redesign: Overall Posture, Cases timeline, reorganized layout
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        // Brand colors
                        "primary": "#09434e",
                        "primary-hover": "#0a5563",
                        "accent-orange": "#B8540C",
                        "accent-teal": "#22D3EE",

                        // Severity colors
                        "severity-critical": "#E74C3C",
                        "severity-critical-bg": "rgba(231, 76, 60, 0.08)",
                        "severity-high": "#F39C12",
                        "severity-high-bg": "rgba(243, 156, 18, 0.08)",
                        "severity-medium": "#3498DB",
                        "severity-medium-bg": "rgba(52, 152, 219, 0.08)",
                        "severity-low": "#6B7280",
                        "severity-low-bg": "rgba(107, 114, 128, 0.08)",

                        // Light mode surfaces (V5.16: deeper card contrast)
                        "surface-dark": "#FFFFFF",
                        "surface-card": "#EAECEF",
                        "surface-elevated": "#F9FAFB",
                        "surface-hover": "#E5E7EB",

                        // Light mode borders
                        "border-default": "#E5E7EB",
                        "border-subtle": "#D1D5DB",
                        "border-strong": "#9CA3AF",

                        // Light mode text (V5.16: improved contrast)
                        "text-primary": "#111827",
                        "text-secondary": "#4B5563",
                        "text-muted": "#9CA3AF",

                        // Status colors
                        "status-success": "#22C55E",
                        "status-blocked": "#EF4444",
                        "status-warning": "#F59E0B",

                        // Operational colors (distinct from severity)
                        "ops-teal": "#0D9488",
                        "ops-teal-bg": "rgba(13, 148, 136, 0.08)",
                        "ops-slate": "#64748B",
                        "ops-slate-bg": "rgba(100, 116, 139, 0.08)",
                        "ops-purple": "#8B5CF6",
                        "ops-purple-bg": "rgba(139, 92, 246, 0.08)",
                    },
                    fontSize: {
                        "xs": ["15px", { lineHeight: "1.4" }],
                        "sm": ["17px", { lineHeight: "1.5" }],
                        "base": ["19px", { lineHeight: "1.6" }],
                        "lg": ["24px", { lineHeight: "1.5" }],
                        "xl": ["28px", { lineHeight: "1.4" }],
                        "2xl": ["34px", { lineHeight: "1.3" }],
                        "3xl": ["40px", { lineHeight: "1.3" }],
                        "4xl": ["48px", { lineHeight: "1.2" }],
                    },
                    fontFamily: {
                        "display": ["Manrope", "system-ui", "sans-serif"],
                        "mono": ["JetBrains Mono", "ui-monospace", "monospace"],
                    },
                    boxShadow: {
                        "glow-critical": "0 0 12px rgba(231, 76, 60, 0.15)",
                        "glow-primary": "0 0 12px rgba(9, 67, 78, 0.2)",
                        "card": "0 2px 8px rgba(0, 0, 0, 0.12)",
                    },
                    // V5.16: Rationalized z-index scale
                    zIndex: {
                        "base": "0",
                        "dropdown": "100",
                        "sticky": "200",
                        "modal": "1000",
                        "tooltip": "1100",
                        "tour": "1200",
                    }
                },
            },
        }
    </script>
    <style>
        /* Scrollbar hiding */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        /* Details/Summary reset */
        details > summary { list-style: none; }
        details > summary::-webkit-details-marker { display: none; }

        /* Glass navigation - Light mode */
        .glass-nav {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            box-shadow: 0 -1px 3px rgba(0, 0, 0, 0.05);
        }

        /* V6.9: Dark mode overrides - Brand-aligned colors */
        .dark {
            --tw-bg-opacity: 1;
        }
        .dark body {
            background-color: #0f172a;
            color: #e2e8f0;
        }
        .dark .bg-white, .dark .bg-white\/95, .dark .bg-white\/80 {
            background-color: #1e293b !important;
        }
        .dark .bg-surface-card, .dark .bg-surface-elevated {
            background-color: #1e293b !important;
        }
        .dark .bg-surface-dark {
            background-color: #0f172a !important;
        }
        .dark .bg-surface-hover {
            background-color: #334155 !important;
        }
        .dark .text-text-primary {
            color: #f1f5f9 !important;
        }
        .dark .text-text-secondary {
            color: #94a3b8 !important;
        }
        .dark .text-text-muted {
            color: #64748b !important;
        }
        .dark .border-border-default {
            border-color: #334155 !important;
        }
        .dark .border-border-subtle {
            border-color: #475569 !important;
        }
        .dark .glass-nav {
            background: rgba(15, 23, 42, 0.95) !important;
            box-shadow: 0 -1px 3px rgba(0, 0, 0, 0.3);
        }
        .dark header {
            background: rgba(15, 23, 42, 0.95) !important;
        }
        .dark .tour-tooltip {
            background: #1e293b !important;
            border-color: #334155 !important;
        }
        /* V6.22: Brand colors adjusted for dark mode - using brand Cyan #22D3EE */
        .dark .text-primary {
            color: #22d3ee !important; /* Brand Cyan for dark mode visibility */
        }
        .dark .bg-primary {
            background-color: #0d5c66 !important; /* Lighter primary for dark backgrounds */
        }
        .dark .bg-primary\/10, .dark .bg-primary\/20 {
            background-color: rgba(34, 211, 238, 0.15) !important;
        }
        .dark .border-primary, .dark .border-primary\/20 {
            border-color: rgba(34, 211, 238, 0.3) !important;
        }
        .dark .ring-primary {
            --tw-ring-color: rgba(34, 211, 238, 0.5) !important;
        }
        /* V6.23: Enforcement buttons dark mode fix */
        .dark .bg-surface-dark\/50 {
            background-color: rgba(30, 41, 59, 0.5) !important;
        }
        .dark label.cursor-not-allowed .text-text-muted,
        .dark label.cursor-not-allowed span.text-text-muted {
            color: #94a3b8 !important;
        }
        .dark label span.text-text-primary,
        .dark label span.text-xs.text-text-primary {
            color: #e2e8f0 !important;
        }

        /* Base body */
        body { min-height: 100dvh; }

        /* Focus styles */
        button:focus-visible, a:focus-visible, input:focus-visible, [tabindex]:focus-visible {
            outline: 2px solid #09434e;
            outline-offset: 2px;
        }

        /* Tooltips - Light mode */
        .tooltip { position: relative; }
        .tooltip::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: #111827;
            color: #fff;
            padding: 6px 10px;
            border-radius: 6px;
            font-size: 14px;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.2s;
            margin-bottom: 6px;
            z-index: 100;
        }
        .tooltip:hover::after { opacity: 1; }

        /* Custom checkbox */
        .custom-checkbox:checked {
            background-color: #09434e;
            border-color: #09434e;
        }

        /* Recommended highlight */
        .recommended {
            border-color: rgba(9, 67, 78, 0.3);
            background: rgba(9, 67, 78, 0.05);
        }

        /* Active filter */
        .filter-active {
            background: rgba(9, 67, 78, 0.1);
            border-color: #09434e;
            color: #09434e;
        }

        /* Chat bubbles */
        .chat-bubble-user { border-radius: 16px 16px 4px 16px; }
        .chat-bubble-ai { border-radius: 16px 16px 16px 4px; }

        /* Typing animation */
        @keyframes typing {
            0%, 60%, 100% { opacity: 0.3; }
            30% { opacity: 1; }
        }
        .typing-dot:nth-child(1) { animation: typing 1.4s infinite 0s; }
        .typing-dot:nth-child(2) { animation: typing 1.4s infinite 0.2s; }
        .typing-dot:nth-child(3) { animation: typing 1.4s infinite 0.4s; }

        /* Screen transitions */
        /* Screen display */
        .screen { display: none; }
        .screen.active { display: flex; flex-direction: column; }

        /* V5.16: Pressed/active states for mobile feedback */
        .severity-card:active,
        .nav-btn:active,
        .time-btn:active,
        .filter-btn:active {
            transform: scale(0.98);
            transition: transform 100ms ease-out;
        }

        /* Tour overlay */
        .tour-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.2);
            z-index: 1000;
            display: none;
        }
        .tour-overlay.active { display: block; }

        /* Tour tooltip - Light mode */
        .tour-tooltip {
            position: fixed;
            background: #FFFFFF;
            border: 1px solid #E5E7EB;
            border-radius: 16px;
            padding: 24px;
            width: 340px;
            max-width: calc(100vw - 32px);
            z-index: 1001;
            box-shadow: 0 25px 50px rgba(0,0,0,0.15);
            left: 50%;
            transform: translateX(-50%);
            top: 50%;
        }
        .tour-tooltip.hidden { display: none !important; }
        .tour-tooltip.top-position {
            top: 120px;
            transform: translateX(-50%);
        }
        .tour-tooltip.center-position {
            top: 50%;
            transform: translate(-50%, -50%);
        }
        .tour-tooltip.bottom-position {
            top: auto;
            bottom: 140px;
            transform: translateX(-50%);
        }
        .tour-tooltip h3 {
            font-size: 22px;
            font-weight: 700;
            color: #111827;
            margin-bottom: 8px;
        }
        .tour-tooltip p {
            font-size: 17px;
            color: #6B7280;
            line-height: 1.6;
            margin-bottom: 20px;
        }

        /* Tour progress */
        .tour-progress {
            display: flex;
            gap: 6px;
            margin-bottom: 16px;
            justify-content: center;
        }
        .tour-progress-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #E5E7EB;
            transition: all 0.2s;
        }
        .tour-progress-dot.active { background: #09434e; transform: scale(1.2); }
        .tour-progress-dot.completed { background: #22D3EE; }

        /* Welcome modal */
        .welcome-modal {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1002;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        .welcome-modal.hidden { display: none; }

        /* Filter dropdown - Light mode */
        .filter-dropdown {
            position: fixed;
            margin-top: 4px;
            background: #FFFFFF;
            border: 1px solid #E5E7EB;
            border-radius: 8px;
            padding: 8px;
            min-width: 180px;
            z-index: 200;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            display: none;
        }
        .filter-dropdown.open { display: block; }
        .filter-option {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            transition: background 0.15s;
        }
        .filter-option:hover { background: #F3F4F6; }
        .filter-option input { accent-color: #09434e; }

        /* API Key modal */
        .api-modal {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1003;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        .api-modal.hidden { display: none; }

        /* Chat message markdown styling - Light mode */
        .chat-content p { margin-bottom: 0.5rem; }
        .chat-content p:last-child { margin-bottom: 0; }
        .chat-content strong { color: #111827; font-weight: 600; }
        .chat-content ul, .chat-content ol { margin: 0.5rem 0; padding-left: 1.25rem; }
        .chat-content li { margin-bottom: 0.25rem; }
        .chat-content code { background: #F3F4F6; padding: 0.125rem 0.375rem; border-radius: 4px; font-size: 0.85em; }

        /* Channel card status indicators */
        .channel-status-connected { color: #22C55E; }
        .channel-status-coming-soon { color: #9CA3AF; }

        /* Scenario definition styling */
        .scenario-condition {
            display: grid;
            grid-template-columns: auto 1fr;
            gap: 0.5rem;
            align-items: baseline;
        }
        .scenario-label {
            font-size: 0.9rem;
            font-weight: 600;
            color: #09434e;
            text-transform: uppercase;
        }
        .scenario-value {
            font-size: 1.05rem;
            color: #374151;
        }

        /* Deployment badge */
        .deployment-badge {
            background: linear-gradient(135deg, #09434e, #22D3EE);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 4px;
            font-size: 0.9rem;
            font-weight: 600;
        }

        /* Card shadows for light mode */
        .card-shadow {
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
        }

        /* V6.20: Document viewer highlights */
        .doc-highlight {
            background: rgba(239, 68, 68, 0.15);
            color: inherit;
            padding: 1px 4px;
            border-radius: 3px;
            border-bottom: 2px solid rgba(239, 68, 68, 0.5);
        }

        /* V5.5: Readable text utilities */
        .text-readable-sm { font-size: 16px; }
        .text-readable-base { font-size: 18px; }
        .text-readable-lg { font-size: 21px; }

        /* V5.5: Improved contrast for data values */
        .data-value {
            font-weight: 700;
            color: #111827;
        }

        /* V5.5: Better card visibility */
        .stat-card {
            background: #F9FAFB;
            border: 1px solid #D1D5DB;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        /* V6.0: Left sidebar navigation */
        .app-layout {
            display: flex;
            min-height: 100vh;
        }
        .sidebar-nav {
            width: 80px;
            position: fixed;
            left: 0;
            top: 0;
            bottom: 0;
            z-index: 40;
        }
        .main-content-area {
            flex: 1;
            margin-left: 80px;
            padding-bottom: 0;
        }
        .sidebar-nav-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            padding: 12px 8px;
            border-radius: 8px;
            transition: all 0.15s ease;
            color: #4B5563;
        }
        .sidebar-nav-btn:hover {
            background: rgba(9, 67, 78, 0.08);
            color: #09434e;
        }
        .sidebar-nav-btn.active {
            background: rgba(9, 67, 78, 0.12);
            color: #09434e;
        }
        .sidebar-nav-btn.active .material-symbols-outlined {
            font-variation-settings: 'FILL' 1;
        }
        .dark .sidebar-nav-btn {
            color: #94a3b8;
        }
        .dark .sidebar-nav-btn:hover,
        .dark .sidebar-nav-btn.active {
            background: rgba(99, 102, 241, 0.15);
            color: #818CF8;
        }
        @media (max-width: 640px) {
            .sidebar-nav { width: 64px; }
            .main-content-area { margin-left: 64px; }
            .sidebar-nav-label { display: none; }
            #screen-intel .fixed { left: 64px; }
        }

        /* V6.4: Draggable widget styles */
        .dashboard-widget {
            transition: all 0.2s ease;
        }
        .dashboard-widget[draggable="true"] {
            cursor: move;
        }
        .dashboard-widget[draggable="true"]:hover {
            transform: scale(1.02);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
        .dashboard-widget.dragging {
            opacity: 0.5;
        }
    </style>
</head>
<body class="bg-surface-dark text-text-primary font-display antialiased overflow-x-hidden selection:bg-primary selection:text-white">

    <!-- Welcome Modal (starts visible, hidden by JS after interaction) -->
    <div id="welcome-modal" class="welcome-modal" style="z-index: 1002;">
        <div class="bg-white rounded-2xl border border-border-default p-8 max-w-md w-full text-center shadow-xl">
            <div class="w-16 h-16 rounded-2xl bg-primary/10 flex items-center justify-center mx-auto mb-6">
                <span class="material-symbols-outlined text-primary text-4xl">security</span>
            </div>
            <h1 class="text-2xl font-extrabold text-text-primary mb-2">Welcome to AXIA</h1>
            <p class="text-text-secondary mb-6">The CISO's front-line AI for insider risk. Experience how AXIA transforms security operations with contextual intelligence and judgment.</p>
            <div class="flex flex-col gap-3">
                <button onclick="startTour()" class="w-full h-12 px-6 rounded-lg bg-primary hover:bg-primary-hover text-white font-bold transition-colors flex items-center justify-center gap-2">
                    <span class="material-symbols-outlined">play_circle</span>
                    Start Guided Tour
                </button>
                <button onclick="skipTour()" class="w-full h-10 px-6 rounded-lg bg-surface-hover text-text-secondary hover:text-text-primary font-medium transition-colors">
                    Skip and Explore
                </button>
            </div>
        </div>
    </div>

    <!-- Fallback script for core functions (ensures app works before app.js loads) -->
    <script>
        // Define minimal fallback functions immediately
        window.startTour = window.startTour || function() {
            var modal = document.getElementById('welcome-modal');
            if (modal) { modal.style.display = 'none'; modal.classList.add('hidden'); }
        };
        window.skipTour = window.skipTour || function() {
            var modal = document.getElementById('welcome-modal');
            if (modal) { modal.style.display = 'none'; modal.classList.add('hidden'); }
        };
        window.navigateTo = window.navigateTo || function(screen) {
            console.log('Fallback navigateTo:', screen);
            document.querySelectorAll('.screen').forEach(function(s) { s.classList.remove('active'); });
            var target = document.getElementById('screen-' + screen);
            if (target) { target.classList.add('active'); }
            // V6.0: Update sidebar navigation
            document.querySelectorAll('.sidebar-nav-btn').forEach(function(btn) {
                var isActive = btn.dataset.screen === screen;
                btn.classList.toggle('active', isActive);
            });
        };
        window.endTour = window.endTour || function() {
            var overlay = document.getElementById('tour-overlay');
            var tooltip = document.getElementById('tour-tooltip');
            if (overlay) { overlay.style.display = 'none'; overlay.classList.remove('active'); }
            if (tooltip) { tooltip.style.display = 'none'; tooltip.classList.add('hidden'); }
        };
        window.nextTourStep = window.nextTourStep || function() { window.endTour(); };
        window.prevTourStep = window.prevTourStep || function() { window.endTour(); };
    </script>

    <!-- Tour Overlay -->
    <div id="tour-overlay" class="tour-overlay" style="display: none;"></div>

    <!-- Tour Tooltip -->
    <div id="tour-tooltip" class="tour-tooltip hidden center-position" style="display: none;">
        <div id="tour-progress" class="tour-progress"></div>
        <h3 id="tour-title"></h3>
        <p id="tour-content"></p>
        <div class="flex gap-2">
            <button onclick="prevTourStep()" id="tour-back" class="flex-1 h-10 px-4 rounded-lg bg-surface-hover text-text-secondary hover:text-text-primary font-medium text-sm transition-colors">Back</button>
            <button onclick="nextTourStep()" id="tour-next" class="flex-1 h-10 px-4 rounded-lg bg-primary hover:bg-primary-hover text-white font-bold text-sm transition-colors">Next</button>
        </div>
        <button onclick="endTour()" class="absolute top-4 right-4 text-text-secondary hover:text-text-primary transition-colors">
            <span class="material-symbols-outlined text-[24px]">close</span>
        </button>
    </div>

    <!-- App Container -->
    <div id="app" class="app-layout">
        <!-- Left Sidebar Navigation -->
        <nav class="sidebar-nav glass-nav border-r border-border-default flex flex-col items-center py-4 gap-1">
            <div class="mb-4 px-2">
                <div id="axia-logo-container" class="w-10 h-10 rounded-xl flex items-center justify-center">
                    <!-- V6.22: Scanning Lens Logo - Brand two-tone per brand guidelines -->
                    <svg id="axia-logo" viewBox="0 0 80 80" width="28" height="28">
                        <circle class="logo-outer" cx="40" cy="40" r="28" fill="none" stroke="#0F766E" stroke-width="2"/>
                        <circle class="logo-inner" cx="40" cy="40" r="18" fill="none" stroke="#0D9488" stroke-width="1.5"/>
                        <circle class="logo-glow" cx="40" cy="40" r="8" fill="#0D9488" opacity="0.3"/>
                        <circle class="logo-center" cx="40" cy="40" r="3" fill="#0D9488"/>
                        <line class="logo-crosshair" x1="40" y1="8" x2="40" y2="18" stroke="#0F766E" stroke-width="2"/>
                        <line class="logo-crosshair" x1="40" y1="62" x2="40" y2="72" stroke="#0F766E" stroke-width="2"/>
                        <line class="logo-crosshair" x1="8" y1="40" x2="18" y2="40" stroke="#0F766E" stroke-width="2"/>
                        <line class="logo-crosshair" x1="62" y1="40" x2="72" y2="40" stroke="#0F766E" stroke-width="2"/>
                    </svg>
                </div>
            </div>
            <!-- V6.17: Reordered sidebar nav - Command first, added Cases -->
            <button onclick="navigateTo('dashboard')" class="sidebar-nav-btn active" data-screen="dashboard">
                <span class="material-symbols-outlined text-[24px]">grid_view</span>
                <span class="sidebar-nav-label text-[10px] font-bold">Command</span>
            </button>
            <button onclick="navigateTo('cases')" class="sidebar-nav-btn" data-screen="cases">
                <span class="material-symbols-outlined text-[24px]">folder_open</span>
                <span class="sidebar-nav-label text-[10px] font-medium">Cases</span>
            </button>
            <button onclick="navigateTo('dashboard-view')" class="sidebar-nav-btn" data-screen="dashboard-view">
                <span class="material-symbols-outlined text-[24px]">monitoring</span>
                <span class="sidebar-nav-label text-[10px] font-medium">Insights</span>
            </button>
            <button onclick="navigateTo('intel')" class="sidebar-nav-btn" data-screen="intel">
                <span class="material-symbols-outlined text-[24px]">assistant</span>
                <span class="sidebar-nav-label text-[10px] font-medium">Intel</span>
            </button>
            <button onclick="navigateTo('connections')" class="sidebar-nav-btn" data-screen="connections">
                <span class="material-symbols-outlined text-[24px]">link</span>
                <span class="sidebar-nav-label text-[10px] font-medium">Enforce</span>
            </button>
            <button onclick="navigateTo('posture')" class="sidebar-nav-btn" data-screen="posture">
                <span class="material-symbols-outlined text-[24px]">shield</span>
                <span class="sidebar-nav-label text-[10px] font-medium">Posture</span>
            </button>
            <div class="flex-1"></div>
            <button onclick="navigateTo('connect')" class="sidebar-nav-btn" data-screen="connect">
                <span class="material-symbols-outlined text-[24px]">cable</span>
                <span class="sidebar-nav-label text-[10px] font-medium">Connect</span>
            </button>
            <button onclick="navigateTo('settings')" class="sidebar-nav-btn" data-screen="settings">
                <span class="material-symbols-outlined text-[24px]">settings</span>
                <span class="sidebar-nav-label text-[10px] font-medium">Settings</span>
            </button>
        </nav>

        <!-- Main Content Area -->
        <main class="main-content-area">

        <!-- ==================== POSTURE SCREEN ==================== -->
        <section id="screen-posture" class="screen">
            <header class="sticky top-0 z-30 bg-white/95 backdrop-blur-sm border-b border-border-default">
                <!-- V6.8: Text-only header (like Dashboard) -->
                <div class="flex items-center justify-between px-5 py-3">
                    <div class="flex flex-col gap-0.5">
                        <h1 class="text-xl font-extrabold tracking-tight leading-none text-text-primary">Posture</h1>
                        <p class="text-[13px] font-medium text-text-secondary uppercase tracking-wider">Security Overview</p>
                    </div>
                    <div class="flex items-center gap-2">
                        <button class="relative flex items-center justify-center w-10 h-10 rounded-lg bg-surface-card hover:bg-surface-hover transition-colors border border-border-subtle text-text-secondary" title="3 unread notifications">
                            <span class="material-symbols-outlined text-[24px]">notifications</span>
                            <span class="absolute top-2 right-2 w-2 h-2 bg-severity-critical rounded-full border-2 border-white"></span>
                        </button>
                        <button class="flex items-center justify-center w-10 h-10 rounded-lg bg-surface-card hover:bg-surface-hover transition-colors border border-border-subtle text-text-secondary tooltip" data-tooltip="Refresh data">
                            <span class="material-symbols-outlined text-[24px]">refresh</span>
                        </button>
                    </div>
                </div>
                <div id="posture-time-selector" class="flex items-center gap-2 px-5 pb-4 overflow-x-auto no-scrollbar w-full">
                    <button class="posture-time-btn shrink-0 h-9 px-4 rounded-lg bg-primary text-white text-xs font-bold border border-primary shadow-sm shadow-primary/20 min-w-[44px]" data-range="1d">1d</button>
                    <button class="posture-time-btn shrink-0 h-9 px-4 rounded-lg bg-surface-card text-text-secondary text-xs font-medium border border-border-subtle hover:bg-surface-hover hover:text-text-primary transition-colors min-w-[44px]" data-range="7d">7d</button>
                    <button class="posture-time-btn shrink-0 h-9 px-4 rounded-lg bg-surface-card text-text-secondary text-xs font-medium border border-border-subtle hover:bg-surface-hover hover:text-text-primary transition-colors min-w-[44px]" data-range="30d">30d</button>
                    <button class="posture-time-btn shrink-0 h-9 px-4 rounded-lg bg-surface-card text-text-secondary text-xs font-medium border border-border-subtle hover:bg-surface-hover hover:text-text-primary transition-colors min-w-[44px]" data-range="90d">90d</button>
                </div>
            </header>

            <div class="flex flex-col px-4 pt-4 gap-4">
                <!-- SECURITY POSTURE (dynamic widget) -->
                <div id="security-posture" class="bg-surface-card rounded-xl p-4 border border-border-subtle">
                    <!-- Content rendered by renderSecurityPosture() in app.js -->
                </div>
            </div>
        </section>

        <!-- ==================== COMMAND SCREEN (V6.17: Default screen) ==================== -->
        <section id="screen-dashboard" class="screen active">
            <header class="sticky top-0 z-30 bg-white/95 backdrop-blur-sm border-b border-border-default">
                <!-- V6.8: Text-only header (like Dashboard) -->
                <div class="flex items-center justify-between px-5 py-3">
                    <div class="flex flex-col gap-0.5">
                        <h1 class="text-xl font-extrabold tracking-tight leading-none text-text-primary">Command</h1>
                        <p class="text-[13px] font-medium text-text-secondary uppercase tracking-wider">Risk Command Center</p>
                    </div>
                    <div class="flex items-center gap-2">
                        <button class="relative flex items-center justify-center w-10 h-10 rounded-lg bg-surface-card hover:bg-surface-hover transition-colors border border-border-subtle text-text-secondary" title="3 unread notifications">
                            <span class="material-symbols-outlined text-[24px]">notifications</span>
                            <span class="absolute top-2 right-2 w-2 h-2 bg-severity-critical rounded-full border-2 border-white"></span>
                        </button>
                        <button class="flex items-center justify-center w-10 h-10 rounded-lg bg-surface-card hover:bg-surface-hover transition-colors border border-border-subtle text-text-secondary tooltip" data-tooltip="Refresh data">
                            <span class="material-symbols-outlined text-[24px]">refresh</span>
                        </button>
                    </div>
                </div>
                <div id="time-selector" class="flex items-center gap-2 px-5 pb-4 overflow-x-auto no-scrollbar w-full">
                    <button class="time-btn shrink-0 h-9 px-4 rounded-lg bg-primary text-white text-xs font-bold border border-primary shadow-sm shadow-primary/20 min-w-[44px]" data-range="1d">1d</button>
                    <button class="time-btn shrink-0 h-9 px-4 rounded-lg bg-surface-card text-text-secondary text-xs font-medium border border-border-subtle hover:bg-surface-hover hover:text-text-primary transition-colors min-w-[44px]" data-range="7d">7d</button>
                    <button class="time-btn shrink-0 h-9 px-4 rounded-lg bg-surface-card text-text-secondary text-xs font-medium border border-border-subtle hover:bg-surface-hover hover:text-text-primary transition-colors min-w-[44px]" data-range="30d">30d</button>
                    <button class="time-btn shrink-0 h-9 px-4 rounded-lg bg-surface-card text-text-secondary text-xs font-medium border border-border-subtle hover:bg-surface-hover hover:text-text-primary transition-colors min-w-[44px]" data-range="90d">90d</button>
                </div>
            </header>

            <main class="flex flex-col px-4 pt-4 gap-4">
                <!-- Severity Summary Cards -->
                <!-- V5.18: Severity cards - responsive: 2-col on mobile, 4-col on sm+ -->
                <div id="severity-cards" class="grid grid-cols-2 sm:grid-cols-4 gap-2">
                    <div class="severity-card bg-surface-card p-3 rounded-lg border border-border-default relative overflow-hidden group hover:border-severity-critical/30 transition-colors cursor-pointer card-shadow" data-severity="critical" onclick="filterBySeverity('critical')">
                        <div class="flex justify-between items-start mb-1.5">
                            <div class="flex items-center gap-1">
                                <span class="material-symbols-outlined text-severity-critical text-[19px]">error</span>
                                <p class="text-[14px] font-bold text-severity-critical uppercase tracking-wider">Critical</p>
                            </div>
                            <span class="text-2xl font-bold text-text-primary tracking-tight leading-none">12</span>
                        </div>
                        <div class="text-[14px] font-medium text-text-secondary leading-tight">
                            <span class="text-text-primary font-bold">Open: 8</span> · Closed: 4
                        </div>
                        <div class="text-[14px] text-text-secondary flex items-center gap-1 mt-0.5">
                            <span class="material-symbols-outlined text-[15px] text-status-blocked">shield</span>
                            <span>DLP: <span class="text-text-primary font-bold">6</span></span>
                        </div>
                        <div class="h-1 w-full bg-surface-hover mt-2 rounded-full overflow-hidden">
                            <div class="h-full bg-severity-critical w-[67%] rounded-full"></div>
                        </div>
                    </div>

                    <div class="severity-card bg-surface-card p-3 rounded-lg border border-border-default relative overflow-hidden group hover:border-severity-high/30 transition-colors cursor-pointer card-shadow" data-severity="high" onclick="filterBySeverity('high')">
                        <div class="flex justify-between items-start mb-1.5">
                            <div class="flex items-center gap-1">
                                <span class="material-symbols-outlined text-severity-high text-[19px]">warning</span>
                                <p class="text-[14px] font-bold text-severity-high uppercase tracking-wider">High</p>
                            </div>
                            <span class="text-2xl font-bold text-text-primary tracking-tight leading-none">8</span>
                        </div>
                        <div class="text-[14px] font-medium text-text-secondary leading-tight">
                            <span class="text-text-primary font-bold">Open: 3</span> · Closed: 5
                        </div>
                        <div class="text-[14px] text-text-secondary flex items-center gap-1 mt-0.5">
                            <span class="material-symbols-outlined text-[15px] text-status-blocked">shield</span>
                            <span>DLP: <span class="text-text-primary font-bold">2</span></span>
                        </div>
                        <div class="h-1 w-full bg-surface-hover mt-2 rounded-full overflow-hidden">
                            <div class="h-full bg-severity-high w-[38%] rounded-full"></div>
                        </div>
                    </div>

                    <div class="severity-card bg-surface-card p-3 rounded-lg border border-border-default relative overflow-hidden group hover:border-severity-medium/30 transition-colors cursor-pointer card-shadow" data-severity="medium" onclick="filterBySeverity('medium')">
                        <div class="flex justify-between items-start mb-1.5">
                            <div class="flex items-center gap-1">
                                <span class="material-symbols-outlined text-severity-medium text-[19px]">info</span>
                                <p class="text-[14px] font-bold text-severity-medium uppercase tracking-wider">Medium</p>
                            </div>
                            <span class="text-2xl font-bold text-text-primary tracking-tight leading-none">18</span>
                        </div>
                        <div class="text-[14px] font-medium text-text-secondary leading-tight">
                            <span class="text-text-primary font-bold">Open: 5</span> · Closed: 13
                        </div>
                        <div class="text-[14px] text-text-secondary flex items-center gap-1 mt-0.5">
                            <span class="material-symbols-outlined text-[15px] text-status-blocked">shield</span>
                            <span>DLP: <span class="text-text-primary font-bold">9</span></span>
                        </div>
                        <div class="h-1 w-full bg-surface-hover mt-2 rounded-full overflow-hidden">
                            <div class="h-full bg-severity-medium w-[28%] rounded-full"></div>
                        </div>
                    </div>

                    <div class="severity-card bg-surface-card p-3 rounded-lg border border-border-default relative overflow-hidden group hover:border-severity-low/30 transition-colors cursor-pointer card-shadow" data-severity="low" onclick="filterBySeverity('low')">
                        <div class="flex justify-between items-start mb-1.5">
                            <div class="flex items-center gap-1">
                                <span class="material-symbols-outlined text-severity-low text-[19px]">check_circle</span>
                                <p class="text-[14px] font-bold text-severity-low uppercase tracking-wider">Low</p>
                            </div>
                            <span class="text-2xl font-bold text-text-primary tracking-tight leading-none">42</span>
                        </div>
                        <div class="text-[14px] font-medium text-text-secondary leading-tight">
                            <span class="text-text-primary font-bold">Open: 0</span> · Closed: 42
                        </div>
                        <div class="text-[14px] text-text-secondary flex items-center gap-1 mt-0.5">
                            <span class="material-symbols-outlined text-[15px] text-status-blocked">shield</span>
                            <span>DLP: <span class="text-text-primary font-bold">18</span></span>
                        </div>
                        <div class="h-1 w-full bg-surface-hover mt-2 rounded-full overflow-hidden">
                            <div class="h-full bg-severity-low w-[0%] rounded-full"></div>
                        </div>
                    </div>
                </div>

                <!-- V6.9: AXIA + DLP Totals Summary Bar (now dynamic based on timeframe) -->
                <div id="command-totals-bar" class="bg-surface-card rounded-lg border border-border-default p-3 card-shadow">
                    <!-- Content rendered by renderCommandTotals() -->
                </div>

                <!-- Critical Cases Accordion -->
                <div id="critical-accordion" class="flex flex-col gap-3">
                    <details class="group bg-surface-card rounded-lg border border-border-default overflow-hidden card-shadow" open>
                        <summary class="flex flex-col p-4 cursor-pointer select-none hover:bg-surface-hover transition-colors">
                            <div class="flex items-center justify-between mb-2">
                                <div class="flex items-center gap-3">
                                    <div class="w-2.5 h-2.5 rounded-full bg-severity-critical shadow-glow-critical"></div>
                                    <span class="material-symbols-outlined text-severity-critical text-[22px]">error</span>
                                    <span class="text-base font-bold text-text-primary">Critical (12)</span>
                                </div>
                                <span class="material-symbols-outlined text-text-secondary transition-transform duration-300 group-open:rotate-180">expand_more</span>
                            </div>
                            <div class="text-[14px] font-medium text-text-secondary leading-tight ml-[22px]">
                                Open: 8 · Closed: 4 · DLP Alerted: 6
                            </div>
                        </summary>
                        <div class="bg-surface-elevated border-t border-border-default" id="critical-cases-list"></div>
                    </details>

                    <details class="group bg-surface-card rounded-lg border border-border-default overflow-hidden card-shadow">
                        <summary class="flex flex-col p-4 cursor-pointer select-none hover:bg-surface-hover transition-colors">
                            <div class="flex items-center justify-between mb-2">
                                <div class="flex items-center gap-3">
                                    <div class="w-2.5 h-2.5 rounded-full bg-severity-high"></div>
                                    <span class="material-symbols-outlined text-severity-high text-[22px]">warning</span>
                                    <span class="text-base font-bold text-text-primary">High (8)</span>
                                </div>
                                <span class="material-symbols-outlined text-text-secondary transition-transform duration-300 group-open:rotate-180">expand_more</span>
                            </div>
                            <div class="text-[14px] font-medium text-text-secondary leading-tight ml-[22px]">
                                Open: 3 · Closed: 5 · DLP Alerted: 2
                            </div>
                        </summary>
                        <div class="bg-surface-elevated border-t border-border-default" id="high-cases-list"></div>
                    </details>

                    <details class="group bg-surface-card rounded-lg border border-border-default overflow-hidden card-shadow">
                        <summary class="flex flex-col p-4 cursor-pointer select-none hover:bg-surface-hover transition-colors">
                            <div class="flex items-center justify-between mb-2">
                                <div class="flex items-center gap-3">
                                    <div class="w-2.5 h-2.5 rounded-full bg-severity-medium"></div>
                                    <span class="material-symbols-outlined text-severity-medium text-[22px]">info</span>
                                    <span class="text-base font-bold text-text-primary">Medium (18)</span>
                                </div>
                                <span class="material-symbols-outlined text-text-secondary transition-transform duration-300 group-open:rotate-180">expand_more</span>
                            </div>
                            <div class="text-[14px] font-medium text-text-secondary leading-tight ml-[22px]">
                                Open: 5 · Closed: 13 · DLP Alerted: 9
                            </div>
                        </summary>
                        <div class="bg-surface-elevated border-t border-border-default" id="medium-cases-list"></div>
                    </details>

                    <details class="group bg-surface-card rounded-lg border border-border-default overflow-hidden card-shadow">
                        <summary class="flex flex-col p-4 cursor-pointer select-none hover:bg-surface-hover transition-colors">
                            <div class="flex items-center justify-between mb-2">
                                <div class="flex items-center gap-3">
                                    <div class="w-2.5 h-2.5 rounded-full bg-severity-low"></div>
                                    <span class="material-symbols-outlined text-severity-low text-[22px]">check_circle</span>
                                    <span class="text-base font-bold text-text-primary">Low (42)</span>
                                </div>
                                <span class="material-symbols-outlined text-text-secondary transition-transform duration-300 group-open:rotate-180">expand_more</span>
                            </div>
                            <div class="text-[14px] font-medium text-text-secondary leading-tight ml-[22px]">
                                Open: 0 · Closed: 42 · DLP Alerted: 18
                            </div>
                        </summary>
                        <div class="bg-surface-elevated border-t border-border-default" id="low-cases-list"></div>
                    </details>
                </div>
            </main>
        </section>

        <!-- ==================== CASES SCREEN ==================== -->
        <section id="screen-cases" class="screen">
            <header class="sticky top-0 z-30 bg-white/95 backdrop-blur-sm border-b border-border-default">
                <div class="flex items-center justify-between px-5 py-4">
                    <div class="flex flex-col gap-0.5">
                        <h1 class="text-xl font-extrabold tracking-tight leading-none text-text-primary">Cases</h1>
                        <p class="text-[14px] font-medium text-text-secondary uppercase tracking-wider">Investigation Workbench</p>
                    </div>
                    <button class="relative flex items-center justify-center w-10 h-10 rounded-lg bg-surface-card hover:bg-surface-hover transition-colors border border-border-subtle text-text-secondary">
                        <span class="material-symbols-outlined text-[24px]">notifications</span>
                        <span class="absolute top-2 right-2 w-2 h-2 bg-severity-critical rounded-full border-2 border-white"></span>
                    </button>
                </div>
                <div id="cases-time-selector" class="flex items-center gap-2 px-5 pb-4 overflow-x-auto no-scrollbar w-full">
                    <button class="cases-time-btn shrink-0 h-9 px-4 rounded-lg bg-primary text-white text-xs font-bold border border-primary shadow-sm shadow-primary/20 min-w-[44px]" data-range="1d">1d</button>
                    <button class="cases-time-btn shrink-0 h-9 px-4 rounded-lg bg-surface-card text-text-secondary text-xs font-medium border border-border-subtle hover:bg-surface-hover hover:text-text-primary transition-colors min-w-[44px]" data-range="7d">7d</button>
                    <button class="cases-time-btn shrink-0 h-9 px-4 rounded-lg bg-surface-card text-text-secondary text-xs font-medium border border-border-subtle hover:bg-surface-hover hover:text-text-primary transition-colors min-w-[44px]" data-range="30d">30d</button>
                    <button class="cases-time-btn shrink-0 h-9 px-4 rounded-lg bg-surface-card text-text-secondary text-xs font-medium border border-border-subtle hover:bg-surface-hover hover:text-text-primary transition-colors min-w-[44px]" data-range="90d">90d</button>
                </div>
            </header>

            <main class="flex flex-col px-4 pt-4 gap-4 overflow-y-auto flex-1">
                <!-- AI Search Bar -->
                <div class="relative group">
                    <div class="absolute inset-0 bg-gradient-to-r from-primary/10 via-severity-medium/10 to-primary/10 rounded-xl blur-md opacity-30 group-focus-within:opacity-50 transition-opacity"></div>
                    <div class="relative bg-surface-card border border-border-subtle rounded-xl flex items-center p-2 shadow-lg focus-within:border-primary/50 focus-within:ring-1 focus-within:ring-primary/30 transition-all">
                        <div class="pl-3 pr-2 text-primary flex items-center justify-center">
                            <span class="material-symbols-outlined text-xl">auto_awesome</span>
                        </div>
                        <input id="case-search" class="w-full bg-transparent border-none text-sm text-text-primary placeholder-text-secondary focus:ring-0 h-10" placeholder="Try: &quot;Critical cases involving Engineering&quot;" type="text"/>
                        <button class="bg-primary hover:bg-primary-hover text-white px-4 py-2 rounded-lg font-bold text-xs transition-colors shrink-0 min-h-[36px]">Search</button>
                    </div>
                </div>

                <!-- Filters with Dropdowns -->
                <div id="case-filters" class="flex items-center gap-2 overflow-x-auto no-scrollbar pb-1">
                    <span class="text-[14px] font-bold text-text-secondary uppercase tracking-wider shrink-0">Filters:</span>

                    <!-- Severity Filter -->
                    <div class="relative">
                        <button onclick="toggleFilter('severity')" class="filter-btn shrink-0 flex items-center gap-1.5 px-3 py-2 bg-surface-card border border-border-subtle rounded-lg text-[14px] font-medium text-text-secondary hover:text-text-primary hover:border-border-strong transition-colors min-h-[36px]" data-filter="severity">
                            <span class="material-symbols-outlined text-[17px]">error</span>
                            Severity
                            <span id="severity-badge" class="hidden bg-primary text-white text-[13px] font-bold px-1.5 py-0.5 rounded">0</span>
                            <span class="material-symbols-outlined text-[17px]">arrow_drop_down</span>
                        </button>
                        <div id="severity-dropdown" class="filter-dropdown">
                            <label class="filter-option">
                                <input type="checkbox" value="critical" onchange="updateFilters()">
                                <span class="material-symbols-outlined text-severity-critical text-[17px]">error</span>
                                <span class="text-sm text-text-primary">Critical</span>
                            </label>
                            <label class="filter-option">
                                <input type="checkbox" value="high" onchange="updateFilters()">
                                <span class="material-symbols-outlined text-severity-high text-[17px]">warning</span>
                                <span class="text-sm text-text-primary">High</span>
                            </label>
                            <label class="filter-option">
                                <input type="checkbox" value="medium" onchange="updateFilters()">
                                <span class="material-symbols-outlined text-severity-medium text-[17px]">info</span>
                                <span class="text-sm text-text-primary">Medium</span>
                            </label>
                            <label class="filter-option">
                                <input type="checkbox" value="low" onchange="updateFilters()">
                                <span class="material-symbols-outlined text-severity-low text-[17px]">check_circle</span>
                                <span class="text-sm text-text-primary">Low</span>
                            </label>
                        </div>
                    </div>

                    <!-- Status Filter -->
                    <div class="relative">
                        <button onclick="toggleFilter('status')" class="filter-btn shrink-0 flex items-center gap-1.5 px-3 py-2 bg-surface-card border border-border-subtle rounded-lg text-[14px] font-medium text-text-secondary hover:text-text-primary hover:border-border-strong transition-colors min-h-[36px]" data-filter="status">
                            State
                            <span id="status-badge" class="hidden bg-primary text-white text-[13px] font-bold px-1.5 py-0.5 rounded">0</span>
                            <span class="material-symbols-outlined text-[17px]">arrow_drop_down</span>
                        </button>
                        <div id="status-dropdown" class="filter-dropdown">
                            <label class="filter-option">
                                <input type="checkbox" value="open" onchange="updateFilters()">
                                <span class="w-2 h-2 rounded-full bg-status-success"></span>
                                <span class="text-sm text-text-primary">Open</span>
                            </label>
                            <label class="filter-option">
                                <input type="checkbox" value="closed" onchange="updateFilters()">
                                <span class="material-symbols-outlined text-text-secondary text-[17px]">check_circle</span>
                                <span class="text-sm text-text-primary">Closed</span>
                            </label>
                        </div>
                    </div>

                    <!-- Actions Taken Filter -->
                    <div class="relative">
                        <button onclick="toggleFilter('actions')" class="filter-btn shrink-0 flex items-center gap-1.5 px-3 py-2 bg-surface-card border border-border-subtle rounded-lg text-[14px] font-medium text-text-secondary hover:text-text-primary hover:border-border-strong transition-colors min-h-[36px]" data-filter="actions">
                            <span class="material-symbols-outlined text-[17px]">bolt</span>
                            Actions Taken
                            <span id="actions-badge" class="hidden bg-primary text-white text-[13px] font-bold px-1.5 py-0.5 rounded">0</span>
                            <span class="material-symbols-outlined text-[17px]">arrow_drop_down</span>
                        </button>
                        <div id="actions-dropdown" class="filter-dropdown">
                            <label class="filter-option">
                                <input type="checkbox" value="none" onchange="updateFilters()">
                                <span class="text-sm text-text-primary">None</span>
                            </label>
                            <label class="filter-option">
                                <input type="checkbox" value="employee" onchange="updateFilters()">
                                <span class="text-sm text-text-primary">Employee engaged</span>
                            </label>
                            <label class="filter-option">
                                <input type="checkbox" value="manager" onchange="updateFilters()">
                                <span class="text-sm text-text-primary">Manager engaged</span>
                            </label>
                            <label class="filter-option">
                                <input type="checkbox" value="legal" onchange="updateFilters()">
                                <span class="text-sm text-text-primary">Legal engaged</span>
                            </label>
                            <label class="filter-option">
                                <input type="checkbox" value="evidence" onchange="updateFilters()">
                                <span class="text-sm text-text-primary">Evidence preserved</span>
                            </label>
                        </div>
                    </div>

                    <!-- DLP Status Filter -->
                    <div class="relative">
                        <button onclick="toggleFilter('dlp')" class="filter-btn shrink-0 flex items-center gap-1.5 px-3 py-2 bg-surface-card border border-border-subtle rounded-lg text-[14px] font-medium text-text-secondary hover:text-text-primary hover:border-border-strong transition-colors min-h-[36px]" data-filter="dlp">
                            <span class="material-symbols-outlined text-[17px]">shield</span>
                            DLP
                            <span id="dlp-badge" class="hidden bg-primary text-white text-[13px] font-bold px-1.5 py-0.5 rounded">0</span>
                            <span class="material-symbols-outlined text-[17px]">arrow_drop_down</span>
                        </button>
                        <div id="dlp-dropdown" class="filter-dropdown">
                            <label class="filter-option">
                                <input type="checkbox" value="alerted" onchange="updateFilters()">
                                <span class="material-symbols-outlined text-status-blocked text-[17px]">shield</span>
                                <span class="text-sm text-text-primary">Alerted</span>
                            </label>
                            <label class="filter-option">
                                <input type="checkbox" value="not-alerted" onchange="updateFilters()">
                                <span class="text-sm text-text-primary">Not alerted</span>
                            </label>
                        </div>
                    </div>

                    <button onclick="clearFilters()" class="shrink-0 text-[14px] text-primary hover:text-text-primary transition-colors font-medium px-2 min-h-[36px]">Clear all</button>
                </div>

                <!-- Active Filter Tags -->
                <div id="active-filters" class="flex items-center gap-2 flex-wrap hidden"></div>

                <!-- Stats Bar -->
                <div class="bg-surface-card rounded-lg border border-border-default p-3 card-shadow">
                    <div class="flex flex-wrap items-center gap-x-4 gap-y-2 text-[14px]">
                        <div class="flex items-center gap-1.5">
                            <span class="w-2 h-2 rounded-full bg-status-success shadow-[0_0_6px_rgba(34,197,94,0.5)]"></span>
                            <span class="text-text-secondary">Open:</span>
                            <span id="stats-open" class="text-text-primary font-bold font-mono">16</span>
                        </div>
                        <div class="flex items-center gap-1.5">
                            <span class="w-2 h-2 rounded-full bg-text-secondary"></span>
                            <span class="text-text-secondary">Closed:</span>
                            <span id="stats-closed" class="text-text-primary font-bold font-mono">64</span>
                        </div>
                        <div class="ml-auto text-text-secondary">
                            Showing <span id="stats-showing" class="text-text-primary font-bold">10</span> cases
                        </div>
                    </div>
                </div>

                <!-- Case List -->
                <div id="case-list" class="flex flex-col gap-3"></div>

                <button onclick="loadMoreCases()" class="text-sm font-bold text-primary hover:text-text-primary transition-colors px-6 py-3 rounded-lg hover:bg-surface-hover border border-border-subtle flex items-center justify-center gap-2 min-h-[44px] mb-4">
                    <span>Load more cases</span>
                    <span class="material-symbols-outlined text-[22px]">expand_more</span>
                </button>
            </main>
        </section>

        <!-- ==================== CASE DETAILS SCREEN ==================== -->
        <section id="screen-case-details" class="screen">
            <header class="sticky top-0 z-30 bg-white/95 backdrop-blur-sm border-b border-border-default">
                <div class="flex items-center justify-between px-4 py-3">
                    <button onclick="goBack()" class="flex items-center justify-center w-10 h-10 rounded-lg hover:bg-surface-hover transition-colors text-text-secondary min-w-[44px] min-h-[44px]">
                        <span class="material-symbols-outlined">arrow_back</span>
                    </button>
                    <div class="flex flex-col items-center">
                        <div class="flex items-center gap-1 text-[14px] text-text-secondary mb-0.5">
                            <span>Cases</span>
                            <span class="material-symbols-outlined text-[15px]">chevron_right</span>
                            <span id="detail-case-id" class="text-text-primary font-medium">CASE-8940</span>
                        </div>
                        <h2 id="detail-title" class="text-sm font-bold leading-tight tracking-tight text-text-primary text-center max-w-[200px] truncate">Source code archive shared externally</h2>
                    </div>
                    <button class="flex items-center justify-center w-10 h-10 rounded-lg hover:bg-surface-hover transition-colors text-text-secondary min-w-[44px] min-h-[44px]">
                        <span class="material-symbols-outlined">more_horiz</span>
                    </button>
                </div>
            </header>

            <main id="case-detail-content" class="flex-1 flex flex-col gap-5 p-4 overflow-y-auto"></main>
        </section>

        <!-- ==================== DASHBOARD SCREEN (V6.4 - Scrollable Value Dashboard with 10 Widgets) ==================== -->
        <section id="screen-dashboard-view" class="screen">
            <header class="sticky top-0 z-30 bg-white/95 backdrop-blur-sm border-b border-border-default">
                <div class="flex items-center justify-between px-5 py-3">
                    <div class="flex flex-col gap-0.5">
                        <h1 class="text-xl font-extrabold tracking-tight leading-none text-text-primary">Insights</h1>
                        <p class="text-[13px] font-medium text-text-secondary uppercase tracking-wider">Risk · Volume · Effectiveness</p>
                    </div>
                    <div class="flex items-center gap-2">
                        <button onclick="toggleDashboardEditMode()" class="h-8 px-3 rounded-lg bg-surface-card text-text-secondary text-xs font-medium border border-border-subtle hover:bg-surface-hover hover:text-text-primary transition-colors flex items-center gap-1" title="Rearrange widgets">
                            <span class="material-symbols-outlined text-[16px]">drag_indicator</span>
                            <span id="edit-mode-label">Edit</span>
                        </button>
                    </div>
                </div>
                <!-- V6.21: Standard time selector row (same as Command/Posture tabs) -->
                <div id="dashboard-time-selector" class="flex items-center gap-2 px-5 pb-4 overflow-x-auto no-scrollbar w-full">
                    <button class="dashboard-time-btn shrink-0 h-9 px-4 rounded-lg bg-surface-card text-text-secondary text-xs font-medium border border-border-subtle hover:bg-surface-hover hover:text-text-primary transition-colors min-w-[44px]" data-range="1d">1d</button>
                    <button class="dashboard-time-btn shrink-0 h-9 px-4 rounded-lg bg-primary text-white text-xs font-bold border border-primary shadow-sm shadow-primary/20 min-w-[44px]" data-range="7d">7d</button>
                    <button class="dashboard-time-btn shrink-0 h-9 px-4 rounded-lg bg-surface-card text-text-secondary text-xs font-medium border border-border-subtle hover:bg-surface-hover hover:text-text-primary transition-colors min-w-[44px]" data-range="30d">30d</button>
                    <button class="dashboard-time-btn shrink-0 h-9 px-4 rounded-lg bg-surface-card text-text-secondary text-xs font-medium border border-border-subtle hover:bg-surface-hover hover:text-text-primary transition-colors min-w-[44px]" data-range="90d">90d</button>
                </div>
            </header>

            <!-- V6.24: Redesigned Insights layout - Overall Posture, Cases timeline, reorganized widgets -->
            <main id="dashboard-view-content" class="grid grid-cols-12 gap-3 p-4 overflow-y-auto pb-8" style="max-height: calc(100vh - 130px);">
                <!-- Row 1: Overall Posture (RCS + MTTR dual chart) - prominent, 9 of 12 cols -->
                <div id="widget-overall-posture" class="col-span-12 lg:col-span-9 dashboard-widget bg-white rounded-xl p-4 border border-border-subtle shadow-sm flex flex-col" draggable="false" data-widget="overall-posture" style="min-height: 220px;">
                    <!-- Overall Posture: RCS rising + MTTR declining -->
                </div>

                <!-- Row 2: Cases timeline (9 cols) + AXIA Actions (3 cols) -->
                <div id="widget-cases-timeline" class="col-span-12 lg:col-span-9 dashboard-widget bg-white rounded-xl p-4 border border-border-subtle shadow-sm flex flex-col" draggable="false" data-widget="cases-timeline" style="min-height: 240px;">
                    <!-- Cases across time with open/closed or severity breakdown + interactions -->
                </div>
                <div id="widget-axia-actions" class="col-span-12 lg:col-span-3 dashboard-widget bg-white rounded-xl p-3 border border-border-subtle shadow-sm flex flex-col" draggable="false" data-widget="axia-actions">
                    <!-- AXIA Actions -->
                </div>

                <!-- Row 3: Top Case Types (3 cols) + Departments (6 cols) -->
                <div id="widget-case-types" class="col-span-12 sm:col-span-4 lg:col-span-3 dashboard-widget bg-white rounded-xl p-3 border border-border-subtle shadow-sm flex flex-col" draggable="false" data-widget="case-types">
                    <!-- Top Case Types -->
                </div>
                <div id="widget-dept-heatmap" class="col-span-12 sm:col-span-8 lg:col-span-6 dashboard-widget bg-white rounded-xl p-3 border border-border-subtle shadow-sm flex flex-col" draggable="false" data-widget="dept-heatmap">
                    <!-- Department Risk Heatmap -->
                </div>

                <!-- Row 4: Total Alerts vs True Cases (6 cols) -->
                <div id="widget-false-alarms" class="col-span-12 lg:col-span-6 dashboard-widget bg-white rounded-xl p-4 border border-border-subtle shadow-sm flex flex-col" draggable="false" data-widget="false-alarms" style="min-height: 200px;">
                    <!-- Total Alerts vs True Cases - prominent -->
                </div>
            </main>
        </section>

        <!-- ==================== V6.13: ENFORCE SCREEN ==================== -->
        <section id="screen-connections" class="screen">
            <header class="sticky top-0 z-30 bg-white/95 backdrop-blur-sm border-b border-border-default">
                <div class="flex items-center justify-between px-5 py-4">
                    <div class="flex flex-col gap-0.5">
                        <h1 class="text-xl font-extrabold tracking-tight leading-none text-text-primary">Enforce</h1>
                        <p class="text-[14px] font-medium text-text-secondary uppercase tracking-wider">DLP Systems & Smart Block</p>
                    </div>
                    <div class="flex items-center gap-2">
                        <span class="w-2 h-2 rounded-full bg-status-success animate-pulse"></span>
                        <span class="text-[14px] font-bold text-status-success">All systems active</span>
                    </div>
                </div>
            </header>

            <main id="connections-content" class="flex flex-col px-4 pt-4 gap-6 overflow-y-auto flex-1">
                <!-- Content rendered by JS -->
            </main>
        </section>

        <!-- ==================== INTEL SCREEN (LIVE CHAT) ==================== -->
        <section id="screen-intel" class="screen" style="height: 100vh;">
            <header class="sticky top-0 z-30 bg-white/95 backdrop-blur-sm border-b border-border-default shrink-0">
                <!-- V6.8: Text-only header (like Dashboard) -->
                <div class="flex items-center justify-between px-5 py-3">
                    <div class="flex flex-col gap-0.5">
                        <h1 class="text-xl font-extrabold tracking-tight leading-none text-text-primary">Intel</h1>
                        <div class="flex items-center gap-1.5">
                            <span class="w-1.5 h-1.5 rounded-full bg-status-success animate-pulse"></span>
                            <p id="intel-status-text" class="text-[13px] font-medium text-text-secondary uppercase tracking-wider">Strategic Advisor</p>
                        </div>
                    </div>
                    <div class="flex items-center gap-2">
                        <button onclick="clearChat()" class="flex items-center justify-center w-10 h-10 rounded-lg bg-surface-card hover:bg-surface-hover transition-colors border border-border-subtle text-text-secondary min-w-[44px] min-h-[44px]" title="New conversation">
                            <span class="material-symbols-outlined text-[24px]">add_comment</span>
                        </button>
                        <button class="flex items-center justify-center w-10 h-10 rounded-lg bg-surface-card hover:bg-surface-hover transition-colors border border-border-subtle text-text-secondary min-w-[44px] min-h-[44px]" title="Chat History">
                            <span class="material-symbols-outlined text-[24px]">history</span>
                        </button>
                    </div>
                </div>
            </header>

            <main id="intel-chat" class="flex-1 overflow-y-auto p-4 space-y-5 pb-[160px] no-scrollbar">
                <!-- Chat messages will be rendered here -->
            </main>

            <!-- Input Area -->
            <div class="fixed bottom-0 left-[80px] right-0 px-4 pb-4 z-20">
                <div class="bg-white/95 backdrop-blur-xl border border-border-subtle rounded-xl shadow-2xl p-3 flex flex-col gap-2 relative overflow-hidden">
                    <div class="absolute inset-0 bg-gradient-to-r from-primary/5 to-severity-medium/5 pointer-events-none"></div>
                    <!-- File preview (shown when file attached) -->
                    <div id="file-preview" class="hidden z-10">
                        <div class="flex items-center gap-3 p-2 bg-surface-card rounded-lg border border-border-subtle">
                            <div class="w-10 h-10 rounded-lg bg-primary/20 flex items-center justify-center">
                                <span class="material-symbols-outlined text-primary text-[24px]">description</span>
                            </div>
                            <div class="flex-1 min-w-0">
                                <p id="file-name" class="text-sm font-medium text-text-primary truncate"></p>
                                <p id="file-size" class="text-[14px] text-text-secondary"></p>
                            </div>
                            <button onclick="removeAttachedFile()" class="p-2 rounded-lg hover:bg-surface-hover text-text-secondary hover:text-text-primary transition-colors">
                                <span class="material-symbols-outlined text-[22px]">close</span>
                            </button>
                        </div>
                    </div>
                    <div class="flex items-end gap-2 z-10">
                        <input type="file" id="file-input" class="hidden" accept=".pdf,.doc,.docx,.txt,.csv,.xlsx,.xls,.ppt,.pptx,.md,.json" onchange="handleFileSelect(event)" />
                        <button onclick="document.getElementById('file-input').click()" class="p-2 rounded-lg hover:bg-surface-hover text-text-secondary hover:text-text-primary transition-colors shrink-0 min-w-[40px] min-h-[40px]" title="Attach file">
                            <span class="material-symbols-outlined text-[26px]">attach_file</span>
                        </button>
                        <textarea id="intel-input" class="w-full bg-transparent border-none text-text-primary placeholder-text-secondary text-sm focus:ring-0 resize-none py-2.5 max-h-32" placeholder="Ask AXIA anything..." rows="1" style="min-height: 44px;" onkeydown="handleInputKeydown(event)"></textarea>
                        <button id="intel-send-btn" onclick="sendMessage()" class="p-2.5 rounded-lg bg-primary hover:bg-primary-hover text-white transition-colors shrink-0 shadow-lg shadow-primary/20 min-w-[44px] min-h-[44px] disabled:opacity-50 disabled:cursor-not-allowed">
                            <span class="material-symbols-outlined text-[24px]" style="font-variation-settings: 'FILL' 1">arrow_upward</span>
                        </button>
                    </div>
                    <!-- Quick prompts -->
                    <div class="flex items-center gap-2 overflow-x-auto no-scrollbar z-10">
                        <span class="text-[14px] text-text-secondary shrink-0">Try:</span>
                        <button onclick="sendSuggestedPrompt('Summarize this week')" class="shrink-0 text-[14px] text-primary hover:text-text-primary bg-primary/10 hover:bg-primary/20 px-2 py-1 rounded transition-colors">"Summarize this week"</button>
                        <button onclick="sendSuggestedPrompt('What patterns should I watch?')" class="shrink-0 text-[14px] text-primary hover:text-text-primary bg-primary/10 hover:bg-primary/20 px-2 py-1 rounded transition-colors">"Watch patterns"</button>
                        <button onclick="sendSuggestedPrompt('Send Sarah Kim\\'s manager a check-in email')" class="shrink-0 text-[14px] text-primary hover:text-text-primary bg-primary/10 hover:bg-primary/20 px-2 py-1 rounded transition-colors">"Send manager email"</button>
                    </div>
                </div>
            </div>
        </section>

        <!-- ==================== V6.20: CONNECT SCREEN ==================== -->
        <section id="screen-connect" class="screen">
            <header class="sticky top-0 z-30 bg-white/95 backdrop-blur-sm border-b border-border-default">
                <div class="flex items-center justify-between px-5 py-4">
                    <div class="flex flex-col gap-0.5">
                        <h1 class="text-xl font-extrabold tracking-tight leading-none text-text-primary">Connect</h1>
                        <p class="text-[14px] font-medium text-text-secondary uppercase tracking-wider">Data Sources & Integrations</p>
                    </div>
                </div>
            </header>
            <main class="flex flex-col px-4 pt-4 gap-4 overflow-y-auto flex-1">
                <!-- Connected Systems -->
                <details id="connect-systems" class="group bg-surface-card rounded-lg border border-primary/30 overflow-hidden card-shadow" open>
                    <summary class="flex items-center justify-between p-4 cursor-pointer select-none hover:bg-surface-hover transition-colors">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 rounded-lg bg-accent-teal/10 flex items-center justify-center">
                                <span class="material-symbols-outlined text-accent-teal text-[24px]">hub</span>
                            </div>
                            <div>
                                <h3 class="text-base font-bold text-text-primary">Connected Systems</h3>
                                <p class="text-[14px] text-text-secondary">Active data sources & context connections</p>
                            </div>
                        </div>
                        <span class="material-symbols-outlined text-text-secondary transition-transform duration-300 group-open:rotate-180">expand_more</span>
                    </summary>
                    <div class="border-t border-border-default bg-surface-elevated p-4 space-y-4">
                        <p class="text-sm text-text-secondary">Connected data sources for monitoring, enrichment, and context. These integrations feed AXIA's analysis engine.</p>
                        <div id="connect-active-content">
                            <!-- Rendered by renderConnectScreen() -->
                        </div>
                    </div>
                </details>

                <!-- Additional Connections -->
                <details id="connect-additional" class="group bg-surface-card rounded-lg border border-border-default overflow-hidden card-shadow">
                    <summary class="flex items-center justify-between p-4 cursor-pointer select-none hover:bg-surface-hover transition-colors">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 rounded-lg bg-primary/10 flex items-center justify-center">
                                <span class="material-symbols-outlined text-primary text-[24px]">add_circle</span>
                            </div>
                            <div>
                                <h3 class="text-base font-bold text-text-primary">Additional Connections</h3>
                                <p class="text-[14px] text-text-secondary">Available integrations for your environment</p>
                            </div>
                        </div>
                        <span class="material-symbols-outlined text-text-secondary transition-transform duration-300 group-open:rotate-180">expand_more</span>
                    </summary>
                    <div class="border-t border-border-default bg-surface-elevated p-4">
                        <div id="connect-additional-content">
                            <!-- Rendered by renderConnectScreen() -->
                        </div>
                    </div>
                </details>
            </main>
        </section>

        <!-- ==================== SETTINGS SCREEN ==================== -->
        <section id="screen-settings" class="screen">
            <header class="sticky top-0 z-30 bg-white/95 backdrop-blur-sm border-b border-border-default">
                <div class="flex items-center justify-between px-5 py-4">
                    <div class="flex flex-col gap-0.5">
                        <h1 class="text-xl font-extrabold tracking-tight leading-none text-text-primary">Settings</h1>
                        <p class="text-[14px] font-medium text-text-secondary uppercase tracking-wider">Configuration & Preferences</p>
                    </div>
                </div>
            </header>

            <main class="flex flex-col px-4 pt-4 gap-4 overflow-y-auto flex-1">
                <!-- V6.20: Connected Systems moved to standalone Connect tab -->

                <!-- Case Action Options -->
                <details id="action-options-config" class="group bg-surface-card rounded-lg border border-border-default overflow-hidden card-shadow">
                    <summary class="flex items-center justify-between p-4 cursor-pointer select-none hover:bg-surface-hover transition-colors">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 rounded-lg bg-primary/10 flex items-center justify-center">
                                <span class="material-symbols-outlined text-primary text-[24px]">checklist</span>
                            </div>
                            <div>
                                <h3 class="text-base font-bold text-text-primary">Case Action Options</h3>
                                <p class="text-[14px] text-text-secondary">Actions available in case investigations</p>
                            </div>
                        </div>
                        <span class="material-symbols-outlined text-text-secondary transition-transform duration-300 group-open:rotate-180">expand_more</span>
                    </summary>
                    <div class="border-t border-border-default bg-surface-elevated p-4 space-y-3">
                        <p class="text-[14px] text-text-secondary mb-3">Enabled actions appear as suggested options in Case Details. Toggle to show/hide.</p>
                        <div id="action-toggles" class="space-y-2">
                            <!-- Rendered by renderActionToggles() -->
                        </div>
                    </div>
                </details>

                <!-- Organizational Guidance Documents -->
                <details class="group bg-surface-card rounded-lg border border-border-default overflow-hidden card-shadow">
                    <summary class="flex items-center justify-between p-4 cursor-pointer select-none hover:bg-surface-hover transition-colors">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 rounded-lg bg-severity-medium/10 flex items-center justify-center">
                                <span class="material-symbols-outlined text-severity-medium text-[24px]">description</span>
                            </div>
                            <div>
                                <h3 class="text-base font-bold text-text-primary">Organizational Guidance</h3>
                                <p class="text-[14px] text-text-secondary">Policies & context documents</p>
                            </div>
                        </div>
                        <span class="material-symbols-outlined text-text-secondary transition-transform duration-300 group-open:rotate-180">expand_more</span>
                    </summary>
                    <div class="border-t border-border-default bg-surface-elevated p-4 space-y-4">
                        <p class="text-sm text-text-secondary">Upload organizational policies, acceptable use documents, and context files to help AXIA understand your specific risk tolerance and business context.</p>

                        <!-- Uploaded Documents -->
                        <div class="space-y-2">
                            <div class="flex items-center gap-3 p-3 bg-white rounded-lg border border-border-default">
                                <div class="w-8 h-8 rounded-lg bg-status-success/10 flex items-center justify-center">
                                    <span class="material-symbols-outlined text-status-success text-[19px]">check_circle</span>
                                </div>
                                <div class="flex-1 min-w-0">
                                    <h4 class="text-sm font-medium text-text-primary truncate">Acceptable_Use_Policy_2025.pdf</h4>
                                    <p class="text-[14px] text-text-secondary">Uploaded Jan 15, 2025 - 2.4 MB</p>
                                </div>
                                <button class="text-text-secondary hover:text-text-primary p-1"><span class="material-symbols-outlined text-[22px]">more_vert</span></button>
                            </div>
                            <div class="flex items-center gap-3 p-3 bg-white rounded-lg border border-border-default">
                                <div class="w-8 h-8 rounded-lg bg-status-success/10 flex items-center justify-center">
                                    <span class="material-symbols-outlined text-status-success text-[19px]">check_circle</span>
                                </div>
                                <div class="flex-1 min-w-0">
                                    <h4 class="text-sm font-medium text-text-primary truncate">Data_Classification_Guide.pdf</h4>
                                    <p class="text-[14px] text-text-secondary">Uploaded Jan 10, 2025 - 1.1 MB</p>
                                </div>
                                <button class="text-text-secondary hover:text-text-primary p-1"><span class="material-symbols-outlined text-[22px]">more_vert</span></button>
                            </div>
                        </div>

                        <!-- Upload Button -->
                        <button class="w-full flex items-center justify-center gap-2 p-4 rounded-lg border-2 border-dashed border-border-subtle hover:border-primary/50 hover:bg-primary/5 transition-colors group">
                            <span class="material-symbols-outlined text-text-secondary group-hover:text-primary text-[28px]">cloud_upload</span>
                            <span class="text-sm font-medium text-text-secondary group-hover:text-text-primary">Upload guidance document</span>
                        </button>
                        <p class="text-[14px] text-text-secondary text-center">Supported: PDF, DOCX, TXT - Max 10MB per file</p>
                    </div>
                </details>

                <!-- Appearance Toggle (moved to end in V5.8) -->
                <div class="bg-surface-card rounded-lg border border-border-default p-4 shadow-card">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 rounded-lg bg-ops-purple/10 flex items-center justify-center">
                                <span id="theme-icon" class="material-symbols-outlined text-ops-purple text-[24px]">light_mode</span>
                            </div>
                            <div>
                                <h3 class="text-base font-bold text-text-primary">Appearance</h3>
                                <p class="text-[14px] text-text-secondary">Switch between light and dark mode</p>
                            </div>
                        </div>
                        <button id="theme-toggle" onclick="toggleTheme()" class="relative w-14 h-8 rounded-full bg-surface-hover border border-border-default transition-colors hover:bg-surface-elevated focus:outline-none focus:ring-2 focus:ring-primary/50">
                            <span id="theme-toggle-indicator" class="absolute left-1 top-1 w-6 h-6 rounded-full bg-primary shadow-md transition-transform flex items-center justify-center">
                                <span class="material-symbols-outlined text-white text-[17px]">light_mode</span>
                            </span>
                        </button>
                    </div>
                </div>

                <div class="text-center py-4">
                    <p class="text-[14px] text-text-secondary">AXIA v6.24 - Interactive Demo</p>
                </div>
            </main>
        </section>

        </main><!-- End main-content-area -->
    </div>

    <!-- Load modular JS files -->
    <script>
// ========== config.js ==========
// ==================== AXIA DEMO V5 CONFIGURATION ====================

// Tailwind configuration - LIGHT MODE DEFAULT
const tailwindConfig = {
    darkMode: "class",
    theme: {
        extend: {
            colors: {
                // Brand colors (unchanged)
                "primary": "#09434e",
                "primary-hover": "#0a5563",
                "accent-orange": "#B8540C",
                "accent-teal": "#22D3EE",

                // Severity colors (unchanged)
                "severity-critical": "#E74C3C",
                "severity-critical-bg": "rgba(231, 76, 60, 0.08)",
                "severity-high": "#F39C12",
                "severity-high-bg": "rgba(243, 156, 18, 0.08)",
                "severity-medium": "#3498DB",
                "severity-medium-bg": "rgba(52, 152, 219, 0.08)",
                "severity-low": "#6B7280",
                "severity-low-bg": "rgba(107, 114, 128, 0.08)",

                // Light mode surfaces
                "surface-dark": "#FFFFFF",
                "surface-card": "#F3F4F6",
                "surface-elevated": "#F9FAFB",
                "surface-hover": "#E5E7EB",

                // Light mode borders
                "border-default": "#E5E7EB",
                "border-subtle": "#D1D5DB",
                "border-strong": "#9CA3AF",

                // Light mode text
                "text-primary": "#111827",
                "text-secondary": "#6B7280",
                "text-muted": "#9CA3AF",

                // Status colors (unchanged)
                "status-success": "#22C55E",
                "status-blocked": "#EF4444",
                "status-warning": "#F59E0B",
            },
            fontFamily: {
                "display": ["Manrope", "system-ui", "sans-serif"],
                "mono": ["JetBrains Mono", "ui-monospace", "monospace"],
            },
            boxShadow: {
                "glow-critical": "0 0 12px rgba(231, 76, 60, 0.15)",
                "glow-primary": "0 0 12px rgba(9, 67, 78, 0.2)",
                "card": "0 1px 3px rgba(0, 0, 0, 0.08)",
            }
        },
    },
};

// OpenAI Assistant configuration
const ASSISTANT_ID = 'asst_FGu7DqyGPbRZQiN28mRRkZm4';
const DEFAULT_API_KEY = ''; // API key removed for public repo — enter your OpenAI key to enable Intel chat


// ========== default.js ==========
// ==================== AXIA DEMO V6.7 DATA - DEFAULT ====================
// V6.7: Improved Risk Score & MTTR time progression (1d best, 90d baseline)
// V6.4: Dramatic MTTR storytelling (4.2h->1.1h = 74% improvement), updated false alarm trends
// V5.17: Case data alignment - fixed timeframes, severity counts, added 4 new cases
// V5.16: Design polish - transitions, shadows, contrast, pressed states
// V5.14: Severity cards + case list by timeframe, Chart type persistence
// Purview: Microsoft ecosystem (Office 365, SharePoint, OneDrive, Teams)
// Netskope: Non-Microsoft (Gmail, Slack, other cloud apps)

const DEMO_DATA = {

    // ==================== BRANDING ====================
    branding: {
        productName: 'AXIA',
        tagline: "The CISO's Front-Line AI for Insider Risk",
        version: 'v6.4'
    },

    // ==================== OPERATIONAL STATUS ====================
    deployment: {
        status: 'active',
        startDate: 'Oct 15, 2025',
        connectionsActive: 4,
        demoStory: '3-month deployment showing AXIA impact'
    },

    // ==================== SECURITY POSTURE METRICS (by timeframe) ====================
    // V5.9: 3-month story - metrics showing declining risk as AXIA learns
    metricsByTimeframe: {
        "1d": {
            open: 3,
            closed: 5,
            axiaEngagements: 8,
            engagementsByType: { employee: 4, manager: 3, legal: 0, evidence: 2 },
            policyUpdates: 1,
            dlpEnforcement: 28,
            axiaJudgment: 15,
            falsePositives: 2,
            totalInteractions: 4521,
            // V6.9.1: MTTR shows dramatic improvement story - 1d is worst (pre-AXIA baseline), 90d shows learned efficiency
            meanTimeToResolution: { avg: 4.8, critical: 3.2, high: 5.2 }
        },
        "7d": {
            open: 8,
            closed: 22,
            axiaEngagements: 45,
            engagementsByType: { employee: 22, manager: 16, legal: 4, evidence: 10 },
            policyUpdates: 3,
            dlpEnforcement: 142,
            axiaJudgment: 78,
            falsePositives: 18,
            totalInteractions: 28456,
            meanTimeToResolution: { avg: 2.4, critical: 1.8, high: 2.8 }
        },
        "30d": {
            open: 18,
            closed: 87,
            axiaEngagements: 198,
            engagementsByType: { employee: 94, manager: 68, legal: 18, evidence: 42 },
            policyUpdates: 9,
            dlpEnforcement: 612,
            axiaJudgment: 342,
            falsePositives: 68,
            totalInteractions: 124789,
            meanTimeToResolution: { avg: 1.4, critical: 1.0, high: 1.6 }
        },
        "90d": {
            open: 42,
            closed: 298,
            axiaEngagements: 623,
            engagementsByType: { employee: 298, manager: 212, legal: 56, evidence: 128 },
            policyUpdates: 28,
            dlpEnforcement: 1847,
            axiaJudgment: 987,
            falsePositives: 189,
            totalInteractions: 389456,
            // V6.9.1: 90d MTTR shows AXIA has dramatically improved resolution times (4.8h→0.8h = 83% reduction)
            meanTimeToResolution: { avg: 0.8, critical: 0.5, high: 1.0 }
        }
    },

    // ==================== FALSE POSITIVES BY CONNECTION ====================
    // V5.9: Showing declining FP rate as AXIA learns
    falsePositivesByConnection: {
        "1d": {
            "Purview": 1,
            "Office 365": 1,
            "Gmail": 0,
            "Slack": 0
        },
        "7d": {
            "Purview": 8,
            "Office 365": 6,
            "Gmail": 3,
            "Slack": 1
        },
        "30d": {
            "Purview": 32,
            "Office 365": 24,
            "Gmail": 9,
            "Slack": 3
        },
        "90d": {
            "Purview": 89,
            "Office 365": 62,
            "Gmail": 28,
            "Slack": 10
        }
    },

    // ==================== V6.12: SEVERITY SUMMARY BY TIMEFRAME ====================
    // V6.12: ALIGNED to match metricsByTimeframe totals (open+closed)
    // 1d=8, 7d=30, 30d=105, 90d=340 - showing AXIA improvement story
    severityByTimeframe: {
        "1d": {
            // V6.12: 8 total cases (aligned with metricsByTimeframe: open=3, closed=5)
            critical: { open: 1, dlpAlerted: 0, total: 2 },
            high: { open: 1, dlpAlerted: 1, total: 3 },
            medium: { open: 1, dlpAlerted: 0, total: 2 },
            low: { open: 0, dlpAlerted: 0, total: 1 }
        },
        "7d": {
            // V6.12: 30 total cases (aligned with metricsByTimeframe: open=8, closed=22)
            critical: { open: 2, dlpAlerted: 3, total: 8 },
            high: { open: 3, dlpAlerted: 3, total: 9 },
            medium: { open: 2, dlpAlerted: 1, total: 8 },
            low: { open: 1, dlpAlerted: 0, total: 5 }
        },
        "30d": {
            // V6.12: 105 total cases (aligned with metricsByTimeframe: open=18, closed=87)
            critical: { open: 4, dlpAlerted: 8, total: 22 },
            high: { open: 5, dlpAlerted: 10, total: 28 },
            medium: { open: 6, dlpAlerted: 6, total: 33 },
            low: { open: 3, dlpAlerted: 2, total: 22 }
        },
        "90d": {
            // V6.12: 340 total cases (aligned with metricsByTimeframe: open=42, closed=298)
            critical: { open: 7, dlpAlerted: 22, total: 60 },
            high: { open: 10, dlpAlerted: 32, total: 85 },
            medium: { open: 16, dlpAlerted: 18, total: 127 },
            low: { open: 9, dlpAlerted: 6, total: 68 }
        }
    },

    // ==================== V5.17: CASES LIST BY TIMEFRAME ====================
    // V5.17: Updated to include new cases and fix timeframe alignment
    // 1d: Recent/urgent cases (within 24h)
    // 7d: Week view includes recent + resolved cases
    // 30d/90d: Full history
    casesByTimeframe: {
        "1d": ["CASE-2024-001", "CASE-2024-002", "CASE-2024-006", "CASE-2024-007", "CASE-2024-008", "CASE-2024-009"],
        "7d": ["CASE-2024-001", "CASE-2024-002", "CASE-2024-003", "CASE-2024-004", "CASE-2024-005", "CASE-2024-006", "CASE-2024-007", "CASE-2024-008", "CASE-2024-009", "CASE-2024-010", "CASE-2024-011", "CASE-2024-012", "CASE-2024-014", "CASE-2024-015"],
        "30d": ["CASE-2024-001", "CASE-2024-002", "CASE-2024-003", "CASE-2024-004", "CASE-2024-005", "CASE-2024-006", "CASE-2024-007", "CASE-2024-008", "CASE-2024-009", "CASE-2024-010", "CASE-2024-011", "CASE-2024-012", "CASE-2024-014", "CASE-2024-015"],
        "90d": ["CASE-2024-001", "CASE-2024-002", "CASE-2024-003", "CASE-2024-004", "CASE-2024-005", "CASE-2024-006", "CASE-2024-007", "CASE-2024-008", "CASE-2024-009", "CASE-2024-010", "CASE-2024-011", "CASE-2024-012", "CASE-2024-014", "CASE-2024-015"]
    },

    // ==================== V5.13: CONNECTION STATS BY TIMEFRAME ====================
    // Full stats for each connection based on timeframe, showing AXIA improvement story
    // 90d shows historical high-risk period, decreasing as AXIA learns
    // ==================== V6.9: ENHANCED CONNECTION STATS BY TIMEFRAME ====================
    // V6.9: Added engagementsBreakdown, blocked per severity, dlpAlerts, smartLeakageBlocks, policyAdjustments
    // For combined channel+DLP posture cards
    connectionStatsByTimeframe: {
        "1d": {
            "ms-purview": { interactions: 0, alerts: { critical: 0, high: 1, medium: 2, low: 1 }, totalAlerts: 4, dlpBlocked: 3, falsePositives: 0, policyUpdates: 1 },
            "netskope": { interactions: 0, alerts: { critical: 0, high: 0, medium: 1, low: 1 }, totalAlerts: 2, dlpBlocked: 2, falsePositives: 0, policyUpdates: 0 },
            "ms-365": { interactions: 41596, alerts: { critical: 0, high: 1, medium: 1, low: 1 }, blocked: { critical: 0, high: 1, medium: 0, low: 1 }, totalAlerts: 3, openCases: 1, closedCases: 2, engagementsBreakdown: { employee: 2, manager: 1, legal: 0, evidence: 1 }, dlpAlerts: 4, falsePositives: 0, smartLeakageBlocks: 2, policyAdjustments: 1 },
            "gmail": { interactions: 11405, alerts: { critical: 0, high: 0, medium: 1, low: 0 }, blocked: { critical: 0, high: 0, medium: 0, low: 0 }, totalAlerts: 1, openCases: 0, closedCases: 1, engagementsBreakdown: { employee: 1, manager: 0, legal: 0, evidence: 0 }, dlpAlerts: 2, falsePositives: 0, smartLeakageBlocks: 0, policyAdjustments: 0 },
            "slack": { interactions: 1608, alerts: { critical: 0, high: 0, medium: 0, low: 1 }, blocked: { critical: 0, high: 0, medium: 0, low: 0 }, totalAlerts: 1, openCases: 0, closedCases: 1, engagementsBreakdown: { employee: 1, manager: 0, legal: 0, evidence: 0 }, dlpAlerts: 0, falsePositives: 0, smartLeakageBlocks: 0, policyAdjustments: 0 }
        },
        "7d": {
            "ms-purview": { interactions: 0, alerts: { critical: 1, high: 3, medium: 5, low: 3 }, totalAlerts: 12, dlpBlocked: 10, falsePositives: 1, policyUpdates: 2 },
            "netskope": { interactions: 0, alerts: { critical: 0, high: 2, medium: 3, low: 1 }, totalAlerts: 6, dlpBlocked: 5, falsePositives: 1, policyUpdates: 1 },
            "ms-365": { interactions: 291174, alerts: { critical: 1, high: 2, medium: 3, low: 2 }, blocked: { critical: 1, high: 1, medium: 1, low: 1 }, totalAlerts: 8, openCases: 2, closedCases: 6, engagementsBreakdown: { employee: 5, manager: 3, legal: 1, evidence: 2 }, dlpAlerts: 12, falsePositives: 1, smartLeakageBlocks: 4, policyAdjustments: 2 },
            "gmail": { interactions: 79837, alerts: { critical: 0, high: 1, medium: 1, low: 1 }, blocked: { critical: 0, high: 0, medium: 1, low: 0 }, totalAlerts: 3, openCases: 1, closedCases: 2, engagementsBreakdown: { employee: 2, manager: 1, legal: 0, evidence: 1 }, dlpAlerts: 6, falsePositives: 1, smartLeakageBlocks: 1, policyAdjustments: 1 },
            "slack": { interactions: 11255, alerts: { critical: 0, high: 0, medium: 1, low: 1 }, blocked: { critical: 0, high: 0, medium: 0, low: 0 }, totalAlerts: 2, openCases: 1, closedCases: 1, engagementsBreakdown: { employee: 1, manager: 1, legal: 0, evidence: 0 }, dlpAlerts: 0, falsePositives: 0, smartLeakageBlocks: 0, policyAdjustments: 0 }
        },
        "30d": {
            "ms-purview": { interactions: 0, alerts: { critical: 4, high: 9, medium: 14, low: 5 }, totalAlerts: 32, dlpBlocked: 28, falsePositives: 3, policyUpdates: 5 },
            "netskope": { interactions: 0, alerts: { critical: 3, high: 6, medium: 9, low: 2 }, totalAlerts: 20, dlpBlocked: 18, falsePositives: 2, policyUpdates: 3 },
            "ms-365": { interactions: 1247892, alerts: { critical: 3, high: 6, medium: 10, low: 3 }, blocked: { critical: 2, high: 4, medium: 3, low: 1 }, totalAlerts: 22, openCases: 6, closedCases: 16, engagementsBreakdown: { employee: 14, manager: 10, legal: 2, evidence: 5 }, dlpAlerts: 32, falsePositives: 3, smartLeakageBlocks: 10, policyAdjustments: 5 },
            "gmail": { interactions: 342156, alerts: { critical: 1, high: 2, medium: 3, low: 2 }, blocked: { critical: 1, high: 1, medium: 1, low: 0 }, totalAlerts: 8, openCases: 2, closedCases: 6, engagementsBreakdown: { employee: 5, manager: 3, legal: 1, evidence: 2 }, dlpAlerts: 20, falsePositives: 2, smartLeakageBlocks: 3, policyAdjustments: 3 },
            "slack": { interactions: 48234, alerts: { critical: 1, high: 2, medium: 1, low: 1 }, blocked: { critical: 0, high: 0, medium: 0, low: 0 }, totalAlerts: 5, openCases: 1, closedCases: 4, engagementsBreakdown: { employee: 3, manager: 2, legal: 0, evidence: 1 }, dlpAlerts: 0, falsePositives: 0, smartLeakageBlocks: 0, policyAdjustments: 0 }
        },
        "90d": {
            "ms-purview": { interactions: 0, alerts: { critical: 12, high: 28, medium: 42, low: 18 }, totalAlerts: 100, dlpBlocked: 85, falsePositives: 12, policyUpdates: 14 },
            "netskope": { interactions: 0, alerts: { critical: 8, high: 18, medium: 26, low: 8 }, totalAlerts: 60, dlpBlocked: 52, falsePositives: 8, policyUpdates: 9 },
            "ms-365": { interactions: 3743676, alerts: { critical: 10, high: 22, medium: 35, low: 13 }, blocked: { critical: 8, high: 15, medium: 10, low: 5 }, totalAlerts: 80, openCases: 12, closedCases: 68, engagementsBreakdown: { employee: 48, manager: 32, legal: 8, evidence: 15 }, dlpAlerts: 100, falsePositives: 12, smartLeakageBlocks: 38, policyAdjustments: 14 },
            "gmail": { interactions: 1026468, alerts: { critical: 4, high: 9, medium: 12, low: 5 }, blocked: { critical: 3, high: 5, medium: 3, low: 1 }, totalAlerts: 30, openCases: 4, closedCases: 26, engagementsBreakdown: { employee: 19, manager: 12, legal: 4, evidence: 6 }, dlpAlerts: 60, falsePositives: 8, smartLeakageBlocks: 12, policyAdjustments: 9 },
            "slack": { interactions: 144702, alerts: { critical: 3, high: 6, medium: 8, low: 3 }, blocked: { critical: 1, high: 2, medium: 1, low: 1 }, totalAlerts: 20, openCases: 3, closedCases: 17, engagementsBreakdown: { employee: 11, manager: 7, legal: 2, evidence: 4 }, dlpAlerts: 0, falsePositives: 0, smartLeakageBlocks: 5, policyAdjustments: 0 }
        }
    },

    // ==================== WEEKLY IMPACT CALLOUT ====================
    // V5.9: Strong value demonstration
    weeklyImpact: {
        exfiltrationsStopped: 4,
        employeesCoached: 18,
        analystHoursSaved: 52,
        riskReductionPercent: 41
    },

    // ==================== V6.12: DEPARTMENT RISK (by timeframe) ====================
    // V6.12: ALIGNED to match metricsByTimeframe totals (1d=8, 7d=30, 30d=105, 90d=340)
    // Shows AXIA improvement story - higher cases in 90d (historical), lower in recent periods
    departmentRiskByTimeframe: {
        "1d": {
            // V6.12: Total = 8 cases
            "Engineering": { cases: 2, trend: "down", severity: "medium", percentage: 25, critical: 0, high: 1, medium: 1, low: 0, caseTypes: ['Code review'] },
            "Sales": { cases: 2, trend: "down", severity: "low", percentage: 25, critical: 0, high: 0, medium: 1, low: 1, caseTypes: ['CRM access'] },
            "Finance": { cases: 2, trend: "stable", severity: "medium", percentage: 25, critical: 1, high: 1, medium: 0, low: 0, caseTypes: ['Report export'] },
            "Product": { cases: 1, trend: "down", severity: "low", percentage: 12, critical: 0, high: 0, medium: 0, low: 1, caseTypes: ['Roadmap review'] },
            "Marketing": { cases: 1, trend: "stable", severity: "low", percentage: 13, critical: 0, high: 0, medium: 0, low: 0, caseTypes: ['Campaign data'] },
            "HR": { cases: 0, trend: "down", severity: "low", percentage: 0, critical: 0, high: 0, medium: 0, low: 0, caseTypes: [] },
            "Legal": { cases: 0, trend: "stable", severity: "low", percentage: 0, critical: 0, high: 0, medium: 0, low: 0, caseTypes: [] },
            "Executive": { cases: 0, trend: "stable", severity: "low", percentage: 0, critical: 0, high: 0, medium: 0, low: 0, caseTypes: [] }
        },
        "7d": {
            // V6.12: Total = 30 cases
            "Engineering": { cases: 7, trend: "down", severity: "medium", percentage: 23, critical: 2, high: 2, medium: 2, low: 1, caseTypes: ['Code review', 'API access'] },
            "Sales": { cases: 7, trend: "down", severity: "medium", percentage: 23, critical: 1, high: 2, medium: 2, low: 2, caseTypes: ['CRM export', 'Lead data'] },
            "Finance": { cases: 5, trend: "stable", severity: "medium", percentage: 17, critical: 2, high: 1, medium: 2, low: 0, caseTypes: ['Financial report'] },
            "Product": { cases: 5, trend: "down", severity: "low", percentage: 17, critical: 1, high: 1, medium: 2, low: 1, caseTypes: ['Roadmap access'] },
            "Marketing": { cases: 2, trend: "stable", severity: "low", percentage: 7, critical: 1, high: 0, medium: 0, low: 1, caseTypes: ['Campaign data'] },
            "HR": { cases: 2, trend: "down", severity: "low", percentage: 7, critical: 1, high: 0, medium: 1, low: 0, caseTypes: ['Employee record'] },
            "Legal": { cases: 2, trend: "stable", severity: "low", percentage: 7, critical: 0, high: 1, medium: 1, low: 0, caseTypes: ['Contract review'] },
            "Executive": { cases: 0, trend: "stable", severity: "low", percentage: 0, critical: 0, high: 0, medium: 0, low: 0, caseTypes: [] }
        },
        "30d": {
            // V6.12: Total = 105 cases
            "Engineering": { cases: 26, trend: "down", severity: "high", percentage: 25, critical: 5, high: 8, medium: 9, low: 4, caseTypes: ['Code exfil', 'Departure risk'] },
            "Sales": { cases: 19, trend: "down", severity: "medium", percentage: 18, critical: 3, high: 5, medium: 7, low: 4, caseTypes: ['CRM export', 'Customer data'] },
            "Finance": { cases: 16, trend: "stable", severity: "high", percentage: 15, critical: 4, high: 5, medium: 5, low: 2, caseTypes: ['Earnings data', 'Financial reports'] },
            "Product": { cases: 13, trend: "down", severity: "medium", percentage: 12, critical: 2, high: 3, medium: 5, low: 3, caseTypes: ['Roadmap leaks', 'Strategy docs'] },
            "Marketing": { cases: 10, trend: "stable", severity: "low", percentage: 10, critical: 2, high: 2, medium: 3, low: 3, caseTypes: ['Campaign data', 'Partner info'] },
            "HR": { cases: 10, trend: "down", severity: "medium", percentage: 10, critical: 2, high: 2, medium: 3, low: 3, caseTypes: ['Employee data', 'Comp info'] },
            "Legal": { cases: 6, trend: "stable", severity: "low", percentage: 6, critical: 2, high: 1, medium: 2, low: 1, caseTypes: ['Contract terms', 'NDA violations'] },
            "Executive": { cases: 5, trend: "stable", severity: "critical", percentage: 5, critical: 2, high: 2, medium: 1, low: 0, caseTypes: ['M&A data', 'Board materials'] }
        },
        "90d": {
            // V6.12: Total = 340 cases
            "Engineering": { cases: 74, trend: "down", severity: "high", percentage: 22, critical: 12, high: 22, medium: 28, low: 12, caseTypes: ['Code exfil', 'Departure risk', 'IP theft'] },
            "Sales": { cases: 68, trend: "down", severity: "high", percentage: 20, critical: 10, high: 18, medium: 26, low: 14, caseTypes: ['CRM export', 'Customer data', 'Lead theft'] },
            "Finance": { cases: 56, trend: "down", severity: "high", percentage: 16, critical: 10, high: 15, medium: 22, low: 9, caseTypes: ['Earnings data', 'Financial reports', 'M&A data'] },
            "Product": { cases: 43, trend: "down", severity: "medium", percentage: 13, critical: 7, high: 10, medium: 18, low: 8, caseTypes: ['Roadmap leaks', 'Strategy docs', 'Feature plans'] },
            "Marketing": { cases: 31, trend: "down", severity: "medium", percentage: 9, critical: 5, high: 7, medium: 12, low: 7, caseTypes: ['Campaign data', 'Partner info', 'Brand assets'] },
            "HR": { cases: 28, trend: "down", severity: "medium", percentage: 8, critical: 5, high: 7, medium: 10, low: 6, caseTypes: ['Employee data', 'Comp info', 'Performance reviews'] },
            "Legal": { cases: 22, trend: "down", severity: "medium", percentage: 6, critical: 4, high: 5, medium: 8, low: 5, caseTypes: ['Contract terms', 'NDA violations', 'Litigation docs'] },
            "Executive": { cases: 18, trend: "down", severity: "critical", percentage: 5, critical: 7, high: 6, medium: 4, low: 1, caseTypes: ['M&A data', 'Board materials', 'Strategic plans'] }
        }
    },

    // ==================== V6.12: COMMAND TOTALS BY TIMEFRAME ====================
    // V6.12: ALIGNED axiaCases with metricsByTimeframe totals
    commandTotalsByTimeframe: {
        "1d": { axiaCases: 8, dlpAlerted: 3, totalDlpAlarms: 42, validatedByAxia: 3 },
        "7d": { axiaCases: 30, dlpAlerted: 12, totalDlpAlarms: 98, validatedByAxia: 12 },
        "30d": { axiaCases: 105, dlpAlerted: 46, totalDlpAlarms: 247, validatedByAxia: 46 },
        "90d": { axiaCases: 340, dlpAlerted: 142, totalDlpAlarms: 812, validatedByAxia: 142 }
    },

    // ==================== RISK TREND DATA (90 days) - AXIA Improvement Story ====================
    // V5.11: Month 1 (days 1-30): High risk, learning phase
    //        Month 2 (days 31-60): Declining risk, AXIA adapting
    //        Month 3 (days 61-90): Low risk, AXIA effective
    riskTrend: [
        // Month 1 (Oct 15 - Nov 14): High baseline risk, AXIA learning
        { day: 1, critical: 3, high: 6, medium: 8, low: 5, total: 22 },
        { day: 2, critical: 2, high: 5, medium: 9, low: 6, total: 22 },
        { day: 3, critical: 4, high: 7, medium: 7, low: 4, total: 22 },
        { day: 4, critical: 3, high: 6, medium: 8, low: 5, total: 22 },
        { day: 5, critical: 2, high: 4, medium: 5, low: 3, total: 14 },
        { day: 6, critical: 1, high: 3, medium: 4, low: 3, total: 11 },
        { day: 7, critical: 3, high: 6, medium: 9, low: 6, total: 24 },
        { day: 8, critical: 2, high: 5, medium: 7, low: 4, total: 18 },
        { day: 9, critical: 1, high: 3, medium: 4, low: 2, total: 10 },
        { day: 10, critical: 3, high: 5, medium: 8, low: 5, total: 21 },
        { day: 11, critical: 4, high: 7, medium: 9, low: 6, total: 26 },
        { day: 12, critical: 2, high: 4, medium: 5, low: 3, total: 14 },
        { day: 13, critical: 1, high: 3, medium: 4, low: 3, total: 11 },
        { day: 14, critical: 3, high: 6, medium: 8, low: 5, total: 22 },
        { day: 15, critical: 2, high: 5, medium: 7, low: 4, total: 18 },
        { day: 16, critical: 1, high: 3, medium: 4, low: 2, total: 10 },
        { day: 17, critical: 3, high: 5, medium: 7, low: 5, total: 20 },
        { day: 18, critical: 4, high: 6, medium: 8, low: 5, total: 23 },
        { day: 19, critical: 2, high: 4, medium: 5, low: 3, total: 14 },
        { day: 20, critical: 1, high: 3, medium: 4, low: 3, total: 11 },
        { day: 21, critical: 2, high: 5, medium: 7, low: 4, total: 18 },
        { day: 22, critical: 3, high: 6, medium: 8, low: 5, total: 22 },
        { day: 23, critical: 3, high: 5, medium: 7, low: 4, total: 19 },
        { day: 24, critical: 2, high: 4, medium: 6, low: 4, total: 16 },
        { day: 25, critical: 2, high: 4, medium: 5, low: 3, total: 14 },
        { day: 26, critical: 1, high: 3, medium: 4, low: 2, total: 10 },
        { day: 27, critical: 2, high: 5, medium: 7, low: 4, total: 18 },
        { day: 28, critical: 3, high: 6, medium: 7, low: 5, total: 21 },
        { day: 29, critical: 3, high: 5, medium: 6, low: 4, total: 18 },
        { day: 30, critical: 2, high: 4, medium: 5, low: 3, total: 14 },
        // Month 2 (Nov 15 - Dec 14): Declining risk, AXIA adapting
        { day: 31, critical: 2, high: 4, medium: 6, low: 4, total: 16 },
        { day: 32, critical: 1, high: 4, medium: 6, low: 4, total: 15 },
        { day: 33, critical: 2, high: 5, medium: 5, low: 3, total: 15 },
        { day: 34, critical: 2, high: 4, medium: 5, low: 4, total: 15 },
        { day: 35, critical: 1, high: 3, medium: 4, low: 2, total: 10 },
        { day: 36, critical: 1, high: 2, medium: 3, low: 2, total: 8 },
        { day: 37, critical: 2, high: 4, medium: 6, low: 4, total: 16 },
        { day: 38, critical: 1, high: 4, medium: 5, low: 3, total: 13 },
        { day: 39, critical: 1, high: 2, medium: 3, low: 2, total: 8 },
        { day: 40, critical: 2, high: 4, medium: 5, low: 4, total: 15 },
        { day: 41, critical: 2, high: 5, medium: 6, low: 4, total: 17 },
        { day: 42, critical: 1, high: 3, medium: 4, low: 2, total: 10 },
        { day: 43, critical: 1, high: 2, medium: 3, low: 2, total: 8 },
        { day: 44, critical: 2, high: 4, medium: 5, low: 3, total: 14 },
        { day: 45, critical: 1, high: 3, medium: 5, low: 3, total: 12 },
        { day: 46, critical: 1, high: 2, medium: 3, low: 2, total: 8 },
        { day: 47, critical: 2, high: 4, medium: 5, low: 3, total: 14 },
        { day: 48, critical: 2, high: 4, medium: 5, low: 4, total: 15 },
        { day: 49, critical: 1, high: 3, medium: 4, low: 2, total: 10 },
        { day: 50, critical: 1, high: 2, medium: 3, low: 2, total: 8 },
        { day: 51, critical: 1, high: 4, medium: 5, low: 3, total: 13 },
        { day: 52, critical: 2, high: 4, medium: 5, low: 3, total: 14 },
        { day: 53, critical: 1, high: 3, medium: 4, low: 3, total: 11 },
        { day: 54, critical: 1, high: 3, medium: 4, low: 3, total: 11 },
        { day: 55, critical: 1, high: 3, medium: 4, low: 2, total: 10 },
        { day: 56, critical: 1, high: 2, medium: 3, low: 2, total: 8 },
        { day: 57, critical: 1, high: 3, medium: 5, low: 3, total: 12 },
        { day: 58, critical: 2, high: 4, medium: 5, low: 3, total: 14 },
        { day: 59, critical: 1, high: 3, medium: 4, low: 3, total: 11 },
        { day: 60, critical: 1, high: 3, medium: 4, low: 2, total: 10 },
        // Month 3 (Dec 15 - Jan 14): Low risk, AXIA effective
        { day: 61, critical: 1, high: 3, medium: 4, low: 3, total: 11 },
        { day: 62, critical: 1, high: 2, medium: 4, low: 3, total: 10 },
        { day: 63, critical: 1, high: 3, medium: 3, low: 2, total: 9 },
        { day: 64, critical: 1, high: 2, medium: 4, low: 3, total: 10 },
        { day: 65, critical: 0, high: 2, medium: 3, low: 2, total: 7 },
        { day: 66, critical: 0, high: 1, medium: 2, low: 2, total: 5 },
        { day: 67, critical: 1, high: 3, medium: 4, low: 3, total: 11 },
        { day: 68, critical: 1, high: 2, medium: 3, low: 2, total: 8 },
        { day: 69, critical: 0, high: 1, medium: 2, low: 1, total: 4 },
        { day: 70, critical: 1, high: 2, medium: 4, low: 3, total: 10 },
        { day: 71, critical: 1, high: 3, medium: 4, low: 3, total: 11 },
        { day: 72, critical: 0, high: 2, medium: 3, low: 2, total: 7 },
        { day: 73, critical: 0, high: 1, medium: 2, low: 2, total: 5 },
        { day: 74, critical: 1, high: 2, medium: 3, low: 3, total: 9 },
        { day: 75, critical: 0, high: 2, medium: 3, low: 2, total: 7 },
        { day: 76, critical: 0, high: 1, medium: 2, low: 1, total: 4 },
        { day: 77, critical: 1, high: 2, medium: 3, low: 2, total: 8 },
        { day: 78, critical: 1, high: 3, medium: 4, low: 3, total: 11 },
        { day: 79, critical: 0, high: 2, medium: 2, low: 2, total: 6 },
        { day: 80, critical: 0, high: 1, medium: 2, low: 2, total: 5 },
        { day: 81, critical: 1, high: 2, medium: 3, low: 2, total: 8 },
        { day: 82, critical: 1, high: 2, medium: 3, low: 3, total: 9 },
        { day: 83, critical: 1, high: 2, medium: 3, low: 2, total: 8 },
        { day: 84, critical: 0, high: 2, medium: 3, low: 2, total: 7 },
        { day: 85, critical: 0, high: 2, medium: 2, low: 2, total: 6 },
        { day: 86, critical: 0, high: 1, medium: 2, low: 1, total: 4 },
        { day: 87, critical: 1, high: 2, medium: 3, low: 2, total: 8 },
        { day: 88, critical: 1, high: 2, medium: 3, low: 2, total: 8 },
        { day: 89, critical: 0, high: 2, medium: 2, low: 2, total: 6 },
        { day: 90, critical: 0, high: 1, medium: 2, low: 2, total: 5 }
    ],

    // ==================== BEFORE/AFTER AXIA COMPARISON ====================
    // V5.9: 3-month story showing impact
    beforeAfterAxia: {
        meanTimeToResolution: { before: 4.2, after: 1.1, unit: "hours", improvement: 74 },
        falsePositiveRate: { before: 68, after: 18, unit: "%", improvement: 73 },
        analystCaseload: { before: 47, after: 14, unit: "cases/day", improvement: 70 },
        employeeCoaching: { before: 8, after: 42, unit: "engagements/week", improvement: 425 },
        policyAccuracy: { before: 72, after: 96, unit: "%", improvement: 33 }
    },

    // ==================== V6.2 DASHBOARD DATA ====================

    // V6.10: Risk Control Score - Shows AXIA improvement over time (1d = best, 90d = baseline/worst)
    // 90d represents the baseline before AXIA was fully tuned
    riskControlScore: {
        "1d": { closedRate: 94, fpReduction: 92, mttrPerformance: 96, composite: 94 },  // Today: excellent
        "7d": { closedRate: 88, fpReduction: 85, mttrPerformance: 89, composite: 87 },  // This week: great
        "30d": { closedRate: 76, fpReduction: 72, mttrPerformance: 78, composite: 75 }, // This month: good
        "90d": { closedRate: 62, fpReduction: 55, mttrPerformance: 58, composite: 58 }  // V6.10: 3mo baseline - lower score before AXIA tuning
    },

    // Extended AXIA Actions (adding HR, DLP Adjustment, Smart Leakage Control)
    axiaActionsByTimeframe: {
        "1d": { employee: 4, manager: 3, legal: 0, hr: 1, dlpAdjustment: 2, smartLeakageControl: 3 },
        "7d": { employee: 22, manager: 16, legal: 4, hr: 6, dlpAdjustment: 8, smartLeakageControl: 14 },
        "30d": { employee: 94, manager: 68, legal: 18, hr: 24, dlpAdjustment: 32, smartLeakageControl: 58 },
        "90d": { employee: 298, manager: 212, legal: 56, hr: 72, dlpAdjustment: 95, smartLeakageControl: 168 }
    },

    // True Alarms Comparison - AXIA vs DLP (VALUE PROOF)
    trueAlarmsComparison: {
        "1d": { axiaDiscovered: 8, dlpDiscovered: 2 },
        "7d": { axiaDiscovered: 30, dlpDiscovered: 8 },
        "30d": { axiaDiscovered: 105, dlpDiscovered: 28 },
        "90d": { axiaDiscovered: 340, dlpDiscovered: 85 }
    },

    // False Alarms Trend (Signal vs Noise) - DLP alerts vs AXIA true alerts
    // V6.4: DRAMATIC STORYTELLING - 90d shows FP reduction as AXIA learns
    // M1 = 85% FP rate (DLP noise), M2 = 59% FP rate, M3 = 74% FP rate improvement
    // V6.21: Real date labels (based on demo date ~Feb 2026)
    falseAlarmsTrend: {
        "1d": {
            labels: ['6h', '12h', '18h', '24h'],
            dlpAlerts: [38, 42, 35, 40],
            axiaTrueAlerts: [32, 36, 30, 34]
        },
        "7d": {
            labels: ['Sat', 'Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri'],
            dlpAlerts: [145, 138, 152, 141, 148, 139, 142],
            axiaTrueAlerts: [118, 112, 125, 115, 122, 114, 118]
        },
        "30d": {
            labels: ['Jan 10', 'Jan 17', 'Jan 24', 'Jan 31'],
            dlpAlerts: [612, 548, 492, 445],
            axiaTrueAlerts: [398, 415, 402, 378]
        },
        "90d": {
            labels: ['Nov', 'Dec', 'Jan'],
            dlpAlerts: [2847, 1923, 1412],
            axiaTrueAlerts: [425, 398, 364]
        }
    },

    interactionsTrend: {
        "1d": {
            labels: ['6h', '12h', '18h', '24h'],
            values: [1105, 1245, 1089, 1082]
        },
        "7d": {
            labels: ['Sat', 'Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri'],
            values: [38420, 41230, 39580, 42150, 40890, 41560, 38626]
        },
        "30d": {
            labels: ['Jan 10', 'Jan 17', 'Jan 24', 'Jan 31'],
            values: [278456, 312890, 298745, 358154]
        },
        "90d": {
            labels: ['Nov', 'Dec', 'Jan'],
            values: [1124567, 1289456, 1342689]
        }
    },

    mttrTrend: {
        slaTarget: 2.0,
        "1d": {
            labels: ['6h', '12h', '18h', '24h'],
            values: [0.5, 0.6, 0.5, 0.5]
        },
        "7d": {
            labels: ['Sat', 'Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri'],
            values: [0.9, 0.8, 0.7, 0.7, 0.6, 0.5, 0.5]
        },
        "30d": {
            labels: ['Jan 10', 'Jan 17', 'Jan 24', 'Jan 31'],
            values: [8.5, 4.2, 1.8, 0.7]
        },
        "90d": {
            labels: ['Nov', 'Dec', 'Jan'],
            values: [48, 18, 4.2]
        }
    },

    // V6.24: Cases by Status - ALIGNED with metricsByTimeframe (1d=8, 7d=30, 30d=105, 90d=340)
    casesByStatus: {
        "1d": { open: 2, assigned: 1, unassigned: 0, closed: 5 },
        "7d": { open: 4, assigned: 2, unassigned: 2, closed: 22 },
        "30d": { open: 8, assigned: 5, unassigned: 5, closed: 87 },
        "90d": { open: 18, assigned: 12, unassigned: 12, closed: 298 }
    },

    // V6.21: Top Case Types by timeframe
    caseTypesByTimeframe: {
        "1d": [
            { type: 'Code Exfiltration', count: 2, icon: 'code' },
            { type: 'Unauthorized Sharing', count: 2, icon: 'share' },
            { type: 'Departure Risk', count: 1, icon: 'exit_to_app' },
            { type: 'Policy Violation', count: 1, icon: 'gavel' },
            { type: 'Data Hoarding', count: 1, icon: 'inventory_2' },
            { type: 'Anomalous Access', count: 1, icon: 'vpn_key' }
        ],
        "7d": [
            { type: 'Code Exfiltration', count: 8, icon: 'code' },
            { type: 'Unauthorized Sharing', count: 6, icon: 'share' },
            { type: 'Departure Risk', count: 5, icon: 'exit_to_app' },
            { type: 'Policy Violation', count: 4, icon: 'gavel' },
            { type: 'Data Hoarding', count: 4, icon: 'inventory_2' },
            { type: 'Anomalous Access', count: 3, icon: 'vpn_key' }
        ],
        "30d": [
            { type: 'Code Exfiltration', count: 28, icon: 'code' },
            { type: 'Unauthorized Sharing', count: 22, icon: 'share' },
            { type: 'Departure Risk', count: 18, icon: 'exit_to_app' },
            { type: 'Policy Violation', count: 14, icon: 'gavel' },
            { type: 'Data Hoarding', count: 12, icon: 'inventory_2' },
            { type: 'Anomalous Access', count: 11, icon: 'vpn_key' }
        ],
        "90d": [
            { type: 'Code Exfiltration', count: 82, icon: 'code' },
            { type: 'Unauthorized Sharing', count: 64, icon: 'share' },
            { type: 'Departure Risk', count: 58, icon: 'exit_to_app' },
            { type: 'Policy Violation', count: 48, icon: 'gavel' },
            { type: 'Data Hoarding', count: 45, icon: 'inventory_2' },
            { type: 'Anomalous Access', count: 43, icon: 'vpn_key' }
        ]
    },

    // V6.24: Cases Timeline - per-period NEW cases (not cumulative)
    // Story: cases DECLINE over time as AXIA eliminates medium/low noise
    // Aligned with severityByTimeframe totals: 1d=8, 7d=30, 30d=105, 90d=340
    casesTimeline: {
        "1d": {
            // 8 total: declining new cases through the day
            labels: ['6h', '12h', '18h', '24h'],
            closed: [2, 2, 1, 0],
            open: [1, 0, 1, 1],
            critical: [1, 1, 0, 0],
            high: [1, 1, 1, 0],
            medium: [1, 0, 1, 0],
            low: [0, 0, 0, 1],
            interactions: [1105, 1245, 1089, 1082]
        },
        "7d": {
            // 30 total: early week = more cases (med/low noise), end = fewer (AXIA learned)
            labels: ['Sat', 'Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri'],
            closed: [6, 5, 4, 3, 2, 1, 1],
            open: [1, 1, 1, 1, 2, 2, 0],
            critical: [1, 1, 1, 1, 2, 1, 1],
            high: [2, 2, 2, 1, 1, 1, 0],
            medium: [2, 2, 1, 1, 1, 1, 0],
            low: [2, 1, 1, 1, 0, 0, 0],
            interactions: [38420, 41230, 39580, 42150, 40890, 41560, 38626]
        },
        "30d": {
            // 105 total: dramatic decline from week to week, med/low vanish
            labels: ['Jan 10', 'Jan 17', 'Jan 24', 'Jan 31'],
            closed: [38, 23, 16, 10],
            open: [2, 5, 5, 6],
            critical: [8, 6, 5, 3],
            high: [10, 8, 6, 4],
            medium: [13, 9, 7, 4],
            low: [9, 5, 3, 5],
            interactions: [278456, 312890, 298745, 358154]
        },
        "90d": {
            // 340 total: Nov=142 (noisy baseline), Dec=112, Jan=86 (AXIA tuned)
            labels: ['Nov', 'Dec', 'Jan'],
            closed: [137, 100, 61],
            open: [5, 12, 25],
            critical: [15, 22, 23],
            high: [25, 30, 30],
            medium: [60, 42, 25],
            low: [42, 18, 8],
            interactions: [1124567, 1289456, 1342689]
        }
    },

    // ==================== DASHBOARD STATISTICS (Legacy - kept for compatibility) ====================
    dashboard: {
        critical: { open: 2, dlpAlerted: 1 },
        high: { open: 3, dlpAlerted: 1 },
        medium: { open: 4, dlpAlerted: 1 },
        low: { closed: 4, dlpAlerted: 0 }
    },

    // ==================== VALUE METRICS ====================
    valueMetrics: {
        employeeEngagements: 42,
        managerNotifications: 18,
        legalEscalations: 4,
        evidencePreserved: 22,
        avgTimePerFalsePositive: 45, // minutes saved
        keyInsight: "After 3 months, AXIA's behavioral analysis has reduced false positives by 73% while catching 4 exfiltration attempts that traditional DLP missed. Pre-departure monitoring alone has prevented estimated $2.4M in IP loss."
    },

    // ==================== CONNECTIONS & ENFORCEMENT (V5.9: Proper DLP mapping) ====================
    connections: [
        // ===== DLP SYSTEMS =====
        {
            id: 'ms-purview',
            name: 'Microsoft Purview DLP',
            shortName: 'Purview',
            icon: 'shield',
            color: 'purple-500',
            type: 'dlp',
            category: 'system',
            status: 'connected',
            connectedSince: 'Oct 15, 2025',
            // V5.9: Purview covers Microsoft ecosystem
            coversChannels: ['ms-365', 'sharepoint', 'onedrive', 'teams'],
            stats: {
                dataProcessed: '142 alerts ingested',
                coverage: '96% of endpoints',
                integration: 'Real-time API',
                interactions: 0,
                alerts: { critical: 4, high: 9, medium: 14, low: 5 },
                totalAlerts: 32,
                dlpBlocked: 28,
                falsePositives: 3,
                policyUpdates: 5,
                lastSync: '1 min ago'
            },
            policies: [
                {
                    id: 'purview-pii',
                    name: 'PII Data Protection',
                    enabled: true,
                    triggerCount: 142,
                    scenarios: [
                        {
                            when: 'Employee sends email containing SSN, credit card, or passport numbers',
                            does: 'Flags for review and notifies employee of policy',
                            through: 'Email notification with coaching message',
                            to: 'Employee and their direct manager'
                        },
                        {
                            when: 'File with PII is uploaded to external cloud storage',
                            does: 'Blocks transfer and creates case for review',
                            through: 'Real-time interception',
                            to: 'Security team and data owner'
                        }
                    ]
                },
                {
                    id: 'purview-financial',
                    name: 'Financial Data Controls',
                    enabled: true,
                    triggerCount: 78,
                    scenarios: [
                        {
                            when: 'Spreadsheet with revenue data shared externally',
                            does: 'Requires manager approval before sharing',
                            through: 'Approval workflow via Teams',
                            to: 'Requestor\'s manager and Finance leadership'
                        }
                    ]
                },
                {
                    id: 'purview-source',
                    name: 'Source Code Protection',
                    enabled: true,
                    triggerCount: 38,
                    scenarios: [
                        {
                            when: 'Code files detected leaving the organization',
                            does: 'Blocks and escalates to security',
                            through: 'Immediate block with case creation',
                            to: 'Security team and Engineering leadership'
                        }
                    ]
                }
            ]
        },
        {
            id: 'netskope',
            name: 'Netskope DLP',
            shortName: 'Netskope',
            icon: 'shield',
            color: 'teal-500',
            type: 'dlp',
            category: 'system',
            status: 'connected',
            connectedSince: 'Oct 18, 2025',
            // V5.9: Netskope covers non-Microsoft cloud apps
            coversChannels: ['gmail', 'slack', 'dropbox', 'box', 'google-drive'],
            stats: {
                dataProcessed: '78 alerts ingested',
                coverage: '91% of cloud apps',
                integration: 'REST API',
                interactions: 67890,
                alerts: { critical: 3, high: 6, medium: 9, low: 2 },
                totalAlerts: 20,
                dlpBlocked: 18,
                falsePositives: 2,
                policyUpdates: 3,
                lastSync: '3 min ago'
            },
            policies: [
                {
                    id: 'netskope-cloud',
                    name: 'Cloud App Protection',
                    enabled: true,
                    triggerCount: 68,
                    scenarios: [
                        {
                            when: 'User uploads sensitive file to unsanctioned cloud app',
                            does: 'Blocks upload and creates alert',
                            through: 'CASB inline inspection',
                            to: 'Security team'
                        }
                    ]
                },
                {
                    id: 'netskope-exfil',
                    name: 'Data Exfiltration Prevention',
                    enabled: true,
                    triggerCount: 42,
                    scenarios: [
                        {
                            when: 'Bulk download from sanctioned app detected',
                            does: 'Alerts and logs for investigation',
                            through: 'API monitoring',
                            to: 'AXIA for behavioral analysis'
                        }
                    ]
                }
            ]
        },

        // ===== CHANNELS - Microsoft Ecosystem (covered by Purview) =====
        {
            id: 'ms-365',
            name: 'Microsoft 365 Email',
            shortName: 'Office 365',
            icon: 'mail',
            color: 'blue-500',
            type: 'email',
            category: 'channel',
            channelType: 'email',
            status: 'connected',
            connectedSince: 'Oct 15, 2025',
            dlpSystem: 'Purview', // V5.9: Explicit DLP mapping
            stats: {
                dataProcessed: '1.2M emails scanned',
                coverage: '100% of mailboxes',
                integration: 'Graph API + Transport Rules',
                interactions: 1247892,
                alerts: { critical: 3, high: 6, medium: 10, low: 3 },
                totalAlerts: 22,
                openCases: 6,
                closedCases: 16,
                engagements: 28,
                dlpBlocked: 10,
                falsePositives: 4,
                lastSync: '1 min ago'
            },
            policies: [] // V6.9: Email channels don't have policies (just DLPs)
        },

        // ===== CHANNELS - Non-Microsoft (covered by Netskope) =====
        {
            id: 'gmail',
            name: 'Google Workspace',
            shortName: 'Gmail',
            icon: 'mail',
            color: 'red-500',
            type: 'email',
            category: 'channel',
            channelType: 'email',
            status: 'connected',
            connectedSince: 'Oct 16, 2025',
            dlpSystem: 'Netskope', // V5.9: Explicit DLP mapping
            stats: {
                dataProcessed: '340K emails scanned',
                coverage: '100% of workspace',
                integration: 'Gmail API + Drive API',
                interactions: 342156,
                alerts: { critical: 1, high: 2, medium: 3, low: 2 },
                totalAlerts: 8,
                openCases: 2,
                closedCases: 6,
                engagements: 10,
                dlpBlocked: 3,
                falsePositives: 2,
                lastSync: '2 min ago'
            },
            policies: [] // V6.9: Email channels don't have policies (just DLPs)
        },
        {
            id: 'slack',
            name: 'Slack',
            shortName: 'Slack',
            icon: 'forum',
            color: 'purple-500',
            type: 'saas',
            category: 'channel',
            channelType: 'saas',
            status: 'connected',
            connectedSince: 'Oct 17, 2025',
            dlpSystem: 'Netskope', // V5.9: Explicit DLP mapping
            stats: {
                dataProcessed: '48K messages monitored',
                coverage: '100% of workspace',
                integration: 'Slack Events API',
                interactions: 48234,
                alerts: { critical: 1, high: 2, medium: 1, low: 1 },
                totalAlerts: 5,
                openCases: 1,
                closedCases: 4,
                engagements: 6,
                dlpBlocked: 0,
                falsePositives: 1,
                lastSync: '4 min ago'
            },
            policies: [
                {
                    id: 'slack-sensitive-share',
                    name: 'Sensitive Data in Messages',
                    enabled: true,
                    triggerCount: 12,
                    scenarios: [
                        {
                            when: 'User shares sensitive files or data in channels',
                            does: 'Creates case and alerts manager',
                            through: 'API monitoring',
                            to: 'Security team'
                        }
                    ]
                }
            ]
        },

        // ===== CONTEXT SOURCES =====
        {
            id: 'okta',
            name: 'Okta Identity',
            shortName: 'Okta',
            icon: 'badge',
            color: 'indigo-500',
            type: 'identity',
            category: 'context',
            status: 'connected',
            connectedSince: 'Oct 15, 2025',
            stats: {
                dataProcessed: '4,200 users synced',
                coverage: '100% of SSO users',
                integration: 'System Log API',
                interactions: 0,
                alerts: { critical: 0, high: 0, medium: 0, low: 0 },
                totalAlerts: 0,
                dlpBlocked: 0,
                falsePositives: 0,
                lastSync: '5 min ago'
            },
            isContextSource: true,
            policies: [
                {
                    id: 'okta-anomaly',
                    name: 'Login Anomaly Detection',
                    enabled: true,
                    triggerCount: 28,
                    scenarios: [
                        {
                            when: 'Login from new location or device',
                            does: 'Adds context to AXIA risk scoring',
                            through: 'Identity signal enrichment',
                            to: 'AXIA analysis engine'
                        }
                    ]
                }
            ]
        },
        {
            id: 'workday',
            name: 'Workday HR',
            shortName: 'Workday',
            icon: 'people',
            color: 'green-500',
            type: 'hr',
            category: 'context',
            status: 'connected',
            connectedSince: 'Oct 15, 2025',
            stats: {
                dataProcessed: '4,200 profiles synced',
                coverage: '100% of employees',
                integration: 'REST API + Webhooks',
                interactions: 0,
                alerts: { critical: 0, high: 0, medium: 0, low: 0 },
                totalAlerts: 0,
                dlpBlocked: 0,
                falsePositives: 0,
                lastSync: '1 hour ago'
            },
            isContextSource: true,
            policies: [
                {
                    id: 'workday-departure',
                    name: 'Departure Risk Signals',
                    enabled: true,
                    triggerCount: 6,
                    scenarios: [
                        {
                            when: 'Employee submits resignation',
                            does: 'Flags for enhanced monitoring',
                            through: 'HR event webhook',
                            to: 'AXIA for risk adjustment'
                        }
                    ]
                }
            ]
        },

        // ===== COMING SOON =====
        {
            id: 'slack',
            name: 'Slack Enterprise',
            shortName: 'Slack',
            icon: 'chat',
            color: 'emerald-500',
            type: 'messaging',
            category: 'channel',
            channelType: 'saas',
            status: 'coming-soon',
            stats: {
                dataProcessed: '—',
                interactions: 0,
                alerts: { critical: 0, high: 0, medium: 0, low: 0 },
                totalAlerts: 0,
                dlpBlocked: 0,
                falsePositives: 0,
                lastSync: 'Pending'
            },
            policies: []
        },
        {
            id: 'github',
            name: 'GitHub Enterprise',
            shortName: 'GitHub',
            icon: 'code',
            color: 'gray-500',
            type: 'code',
            category: 'channel',
            channelType: 'saas',
            status: 'coming-soon',
            stats: {
                dataProcessed: '—',
                interactions: 0,
                alerts: { critical: 0, high: 0, medium: 0, low: 0 },
                totalAlerts: 0,
                dlpBlocked: 0,
                falsePositives: 0,
                lastSync: 'Pending'
            },
            policies: []
        }
    ],

    // ==================== ENFORCEMENT RULES ====================
    enforcementRules: [
        {
            id: 'rule-001',
            name: 'Pre-departure data collection',
            description: 'When resigning employee downloads >50 files in 7 days',
            scenario: {
                when: 'Any employee with resignation submitted',
                does: 'Downloads more than 50 files',
                through: 'Any channel',
                to: 'Any destination'
            },
            channels: ['ms-purview', 'netskope'],  // V6.14: Only DLPs
            action: 'Alert + Silent monitoring',
            triggerCount: 9,
            lastTriggered: '1 day ago',
            status: 'active',
            sourceCase: 'CASE-2024-001'
        },
        {
            id: 'rule-002',
            name: 'Encrypted file to unknown domain',
            description: 'When any user sends encrypted archive to unrecognized domain',
            scenario: {
                when: 'Any user',
                does: 'Sends encrypted/password-protected file',
                through: 'Email',
                to: 'Domain not in approved list'
            },
            channels: ['ms-purview'],  // V6.14: Only DLPs
            action: 'Block + Manager notification',
            triggerCount: 6,
            lastTriggered: '3 hours ago',
            status: 'active',
            sourceCase: 'CASE-2024-002'
        },
        {
            id: 'rule-003',
            name: 'Financial data before earnings',
            description: 'Block sharing of financial documents during quiet period',
            scenario: {
                when: 'During earnings quiet period',
                does: 'Shares documents tagged Financial/Earnings',
                through: 'Any channel',
                to: 'External recipients'
            },
            channels: ['ms-purview'],  // V6.14: Only DLPs
            action: 'Block + Legal alert',
            triggerCount: 2,
            lastTriggered: '2 weeks ago',
            status: 'active',
            sourceCase: 'CASE-2024-004'
        },
        {
            id: 'rule-004',
            name: 'CRM bulk export alert',
            description: 'Alert when >500 customer records exported',
            scenario: {
                when: 'Any sales role',
                does: 'Exports more than 500 customer records',
                through: 'CRM export',
                to: 'Any destination'
            },
            channels: ['slack'],
            action: 'Alert + Manager notification',
            triggerCount: 4,
            lastTriggered: '5 days ago',
            status: 'active',
            sourceCase: 'CASE-2024-005'
        },
        {
            id: 'rule-005',
            name: 'Competitor communication detection',
            description: 'Monitor communications with known competitor domains',
            scenario: {
                when: 'Any employee',
                does: 'Sends or receives email to competitor domain',
                through: 'Email',
                to: 'Known competitor list'
            },
            channels: ['ms-purview'],  // V6.14: Only DLPs
            action: 'Log + Monthly report',
            triggerCount: 23,
            lastTriggered: '2 hours ago',
            status: 'active',
            sourceCase: null
        },
        {
            id: 'rule-006',
            name: 'After-hours sensitive access',
            description: 'Alert on sensitive data access outside business hours',
            scenario: {
                when: 'Any user outside 7AM-7PM local time',
                does: 'Accesses confidential/restricted documents',
                through: 'Any channel',
                to: 'Any destination'
            },
            channels: ['ms-purview', 'slack'],  // V6.14: DLPs + direct APIs
            action: 'Alert + Log for review',
            triggerCount: 12,
            lastTriggered: '1 day ago',
            status: 'active',
            sourceCase: null
        },
        {
            id: 'rule-007',
            name: 'Personal cloud upload pattern',
            description: 'Detect patterns of uploading work files to personal storage',
            scenario: {
                when: 'Any employee',
                does: 'Uploads >10 work files to personal cloud in 24h',
                through: 'Cloud sync apps',
                to: 'Personal Dropbox, Google Drive, iCloud'
            },
            channels: ['netskope'],  // V6.14: Only DLPs
            action: 'Block + Manager notification',
            triggerCount: 3,
            lastTriggered: '1 week ago',
            status: 'active',
            sourceCase: 'CASE-2024-008'
        }
    ],

    // ==================== DASHBOARD WIDGETS CONFIG ====================
    dashboardWidgets: {
        available: [
            { id: 'dept-heatmap', name: 'Department Heatmap', enabled: true, size: 'large' },
            { id: 'before-after', name: 'Before/After AXIA', enabled: true, size: 'medium' },
            { id: 'weekly-impact', name: 'This Week\'s Impact', enabled: true, size: 'small' },
            { id: 'false-positives', name: 'False Positives by Source', enabled: true, size: 'medium' },
            { id: 'response-times', name: 'Response Times', enabled: false, size: 'small' }
        ]
    },

    // ==================== TOUR STEPS (V5.9 Updated) ====================
    tourSteps: [
        { title: 'Welcome to AXIA', content: "This guided tour shows how AXIA transforms security operations with contextual intelligence and judgment - understanding why something is risky, not just what happened.", screen: 'dashboard', position: 'center' },
        { title: 'Security Posture', content: 'The Security Posture widget shows your risk status at a glance: open/closed cases, AXIA engagements by type, and per-channel metrics with single DLP attribution.', screen: 'dashboard', position: 'top' },
        { title: 'Performance Dashboard', content: 'The Dashboard shows AXIA value through department risk heatmaps with case type breakdowns. Click any department to drill into cases.', screen: 'dashboard-view', position: 'center' },
        { title: 'Critical Cases', content: 'Expand accordions to see recent cases. Each shows the risk score, entity involved, DLP status, and actions taken.', screen: 'dashboard', position: 'bottom' },
        { title: 'Case Investigation', content: "The Cases screen is your investigation workbench. Use filters to narrow down cases by severity, status, actions taken, or DLP status.", screen: 'cases', position: 'top' },
        { title: 'Connections', content: "See all connected data sources with their coverage, integration details, and policies. Email and SaaS channels show their DLP coverage.", screen: 'connections', position: 'center' },
        { title: 'Connection Policies', content: "Each connection shows collapsible policy scenarios: When this happens / AXIA does this / Through this channel / To these recipients. Policies are born from resolved cases.", screen: 'connections', position: 'bottom' },
        { title: 'Structured Analysis', content: 'Each case provides structured analysis: What happened, Why it matters, and Why it is unusual. This context helps you make informed decisions.', screen: 'case-details', position: 'center', caseId: 'CASE-2024-001' },
        { title: 'From Case to Prevention', content: 'Resolved cases can become enforcement rules with one click. Define scenarios in natural language to prevent similar incidents.', screen: 'case-details', position: 'bottom' },
        { title: 'Intel Advisor', content: 'Ask AXIA questions about risk patterns, upload documents for analysis, or simulate scenarios before they happen.', screen: 'intel', position: 'center' },
        { title: 'AI Boundaries', content: "Critical for trust: AXIA clearly defines what it may suggest vs. what it may NEVER do autonomously. Humans remain in control.", screen: 'settings', position: 'top' },
        { title: 'Tour Complete!', content: "You've seen the core of AXIA - contextual intelligence protecting your organization with judgment, not just enforcement.", screen: 'dashboard', position: 'center' }
    ],

    // ==================== CASES DATA ====================
    // V5.17: Cases demonstrate AXIA's context-aware analysis
    //
    // BEHAVIORAL CONTEXT (WHO + WHAT + TO WHOM):
    //    001: Pre-departure pattern - resignation context
    //    002: Encrypted file - behavioral signals
    //    005: CRM bulk export - departure timing
    //    007: API automation - volume anomaly
    //    009: Team pattern - cross-user correlation
    //
    // CONTEXT REVEALS LEGITIMATE ACTIVITY:
    //    006: Customer share - verified opportunity
    //    012: OSS contribution - pre-approved
    //    015: Consultant share - approved vendor
    //
    // DLP + AXIA TOGETHER:
    //    003: M&A docs - added timing context
    //    004: Earnings data - quiet period context
    //    008: Cloud sync - detected and resolved
    //
    // ENGAGEMENT-DRIVEN RESOLUTION:
    //    010: Wrong Teams channel - coached user
    //    011: Comp data export - approval workflow
    //    014: Wrong email - confirmed deletion
    //
    cases: [

        // ========== CRITICAL CASES (2 open, 2 closed) ==========

        {
            id: 'CASE-2024-001',
            title: 'Pre-departure data exfiltration pattern',
            severity: 'critical',
            status: 'open',
            score: 98,
            time: '23m ago',
            description: 'Resigning employee showing 340% volume increase across cloud storage, CRM exports, and source code access.',
            entity: {
                name: 'Marcus Chen',
                initials: 'MC',
                role: 'Senior Software Engineer',
                department: 'Engineering',
                location: 'San Francisco',
                joined: 'Jan 2020',
                riskFactors: ['Resignation submitted 2 weeks ago', 'Accepted offer at competitor', 'Key project contributor']
            },
            dlpAlerted: false,
            dlpSystem: 'Purview', // V5.9: Which DLP flagged this
            assignee: { name: 'Alex Rivera', initials: 'AR', role: 'Security Analyst' }, // V6.2: Managed case
            actions: ['Silent evidence collection', 'HR notified', 'Manager notified'],
            completedActions: ['contact-manager', 'contact-hr'], // V6.10: Track completed action IDs for grey-out
            analysis: {
                what: 'Marcus Chen (Senior Software Engineer, departing in 2 weeks) has exhibited a 340% increase in data access volume over the past 5 days. Activity includes: 847 source code file downloads from GitHub, export of 2,340 customer records from the CRM, and 12 proprietary algorithm documents accessed from SharePoint.',
                whyMatters: 'Marcus has accepted a position at DirectCompete Inc., a direct competitor. The accessed materials include trade secrets, customer relationships, and proprietary algorithms that represent significant competitive advantage.',
                whyUnusual: "AXIA connected the context: WHO (departing engineer joining competitor) + WHAT (source code, customer data, algorithms) + TO WHOM (personal devices). Individual downloads looked normal — only behavioral context reveals 27x volume spike as systematic pre-departure collection."
            },
            timeline: [
                { time: '10:47 AM', event: 'Evidence packet prepared for legal', source: 'AXIA analysis engine', color: 'primary' },
                { time: '10:30 AM', event: 'HR team notified of risk pattern', source: 'AXIA engagement', color: 'accent-teal' },
                { time: '10:15 AM', event: 'Silent monitoring enabled', source: 'AXIA orchestration', color: 'primary' },
                { time: '10:12 AM', event: 'Manager Sarah Kim notified', source: 'AXIA engagement', color: 'accent-teal' },
                { time: '10:00 AM', event: 'Behavioral anomaly detected: 340% volume spike', source: 'AXIA analysis engine', color: 'severity-critical' },
                { time: '9:45 AM', event: 'CRM bulk export detected (2,340 records)', source: 'CRM API', color: 'text-secondary' },
                { time: '8:30 AM', event: 'GitHub mass clone detected (847 files)', source: 'GitHub Enterprise', color: 'text-secondary' }
            ],
            canEnforce: true,
            // V6.12: Enforcement type - behavioral pattern requiring contextual understanding
            enforcementType: 'activate-smart-block',
            enforcementReason: 'Departure timing + competitor context requires behavioral analysis that DLP rules cannot capture',
            enforcementSuggestion: {
                when: 'Any employee with resignation submitted',
                does: 'Downloads more than 50 files in 7 days',
                through: 'Any channel',
                to: 'Any destination'
            }
        },

        {
            id: 'CASE-2024-002',
            title: 'Encrypted archive bypassed DLP detection',
            severity: 'critical',
            status: 'open',
            score: 95,
            time: '1h ago',
            description: 'Password-protected ZIP containing product roadmap sent externally. DLP could not scan contents but behavioral signals triggered alert.',
            entity: {
                name: 'David Park',
                initials: 'DP',
                role: 'Product Manager',
                department: 'Product',
                location: 'Seattle',
                joined: 'Aug 2021',
                riskFactors: ['First external encrypted file share', 'Recipient domain not in CRM']
            },
            dlpAlerted: false,
            dlpSystem: 'Purview',
            assignee: null, // V6.2: Unassigned case - needs triage
            actions: ['Employee engaged'],
            completedActions: ['contact-employee'], // V6.10: Track completed action IDs for grey-out
            analysis: {
                what: 'David Park sent a password-protected ZIP file (product-roadmap-2026.zip, 4.2MB) to jennifer.wu@techventures-capital.com. DLP was unable to scan the encrypted contents, but the filename and behavioral context triggered AXIA analysis.',
                whyMatters: 'Product roadmaps contain strategic plans, feature timelines, and competitive positioning that could significantly benefit competitors or impact stock price if leaked before announcements.',
                whyUnusual: "Encrypted content bypassed content scanning. AXIA analyzed context: WHO (Product Manager with roadmap access) + WHAT (filename suggests strategic content) + TO WHOM (VC firm not on approved list). First encrypted external file from David — behavioral signal that triggered investigation."
            },
            timeline: [
                { time: '9:42 AM', event: 'Employee coaching message sent via Slack', source: 'AXIA engagement', color: 'accent-teal' },
                { time: '9:40 AM', event: 'Case created - behavioral analysis', source: 'AXIA analysis engine', color: 'primary' },
                { time: '9:38 AM', event: 'DLP scan bypassed - encrypted content', source: 'Microsoft Purview DLP', color: 'severity-medium' },
                { time: '9:35 AM', event: 'Email sent to external recipient', source: 'Email Gateway (Microsoft 365)', color: 'text-secondary' }
            ],
            canEnforce: true,
            // V6.12: Simple pattern - block encrypted files to unapproved domains
            enforcementType: 'create-dlp-rule',
            enforcementReason: 'Simple content pattern (encrypted files) can be detected by DLP - no existing rule covers this',
            enforcementSuggestion: {
                when: 'Any user',
                does: 'Sends encrypted/password-protected file',
                through: 'Email',
                to: 'Domain not in approved list'
            }
        },

        {
            id: 'CASE-2024-003',
            title: 'M&A due diligence documents shared prematurely',
            severity: 'critical',
            status: 'closed',
            score: 94,
            time: '2d ago',
            description: 'Confidential acquisition target analysis sent to external advisor before board approval. Regulatory and material non-public information concerns.',
            entity: {
                name: 'Jonathan Burke',
                initials: 'JB',
                role: 'VP Corporate Development',
                department: 'Finance',
                location: 'New York',
                joined: 'Sep 2019',
                riskFactors: ['Pre-board approval sharing', 'M&A confidential data', 'Material non-public information']
            },
            dlpAlerted: true,
            dlpSystem: 'Purview',
            actions: ['Legal notified', 'Executive escalation', 'Rule created'],
            completedActions: ['contact-legal'], // V6.15: Track completed action IDs for grey-out
            analysis: {
                what: 'Jonathan Burke shared comprehensive acquisition analysis documents for Project Falcon (target valuation: $340M) to an external M&A advisor (Stevens & Partners) before the board formally approved engagement of outside counsel.',
                whyMatters: 'M&A due diligence contains material non-public information. Premature disclosure could trigger SEC disclosure requirements, affect stock prices, or alert the acquisition target to our interest.',
                whyUnusual: "Purview flagged the M&A classification. AXIA added timing context: WHO (VP Corp Dev, authorized for M&A) + WHAT (Project Falcon docs) + WHEN (before board approval date). Combined signals triggered executive escalation and new enforcement rule for pre-board M&A communications."
            },
            timeline: [
                { time: '2 days ago 4:00 PM', event: 'Case closed - enforcement rule created', source: 'Security Admin', color: 'status-success' },
                { time: '2 days ago 2:00 PM', event: 'CEO and General Counsel briefed', source: 'AXIA escalation', color: 'primary' },
                { time: '2 days ago 1:30 PM', event: 'Legal counsel engaged', source: 'AXIA engagement', color: 'accent-teal' },
                { time: '2 days ago 1:00 PM', event: 'DLP alerted on M&A classification', source: 'Microsoft Purview DLP', color: 'status-blocked' },
                { time: '2 days ago 12:50 PM', event: 'Document sent to external advisor', source: 'Email Gateway (Microsoft 365)', color: 'text-secondary' }
            ],
            canEnforce: true,
            hasEnforcementRule: 'rule-005',
            // V6.12: Existing DLP rule caught this - needs adjustment for timing
            enforcementType: 'adjust-dlp-rule',
            enforcementReason: 'DLP rule exists for M&A classification - adjust to add pre-board timing restriction'
        },

        {
            id: 'CASE-2024-004',
            title: 'Quarterly financials shared before earnings call',
            severity: 'critical',
            status: 'closed',
            score: 92,
            time: '2d ago',
            description: 'Pre-release Q4 earnings shared with external investment contact. Potential insider trading concern.',
            entity: {
                name: 'Fiona Mitchell',
                initials: 'FM',
                role: 'Finance Manager',
                department: 'Finance',
                location: 'New York',
                joined: 'Jun 2020',
                riskFactors: ['Pre-release financial data', 'External recipient', 'Before quiet period ends']
            },
            dlpAlerted: true,
            dlpSystem: 'Purview',
            actions: ['Legal notified', 'Case closed'],
            completedActions: ['contact-legal'], // V6.15: Track completed action IDs for grey-out
            analysis: {
                what: 'Fiona Mitchell attempted to send Q4 earnings preview document to robert.hayes@alphahedge-partners.com, a contact at an investment firm, 3 days before the scheduled earnings call.',
                whyMatters: 'Pre-release financial data is regulated under SEC Regulation FD (Fair Disclosure). Selective disclosure to investment professionals could constitute insider trading facilitation and expose the company to significant regulatory penalties.',
                whyUnusual: "Purview blocked based on financial classification. AXIA added context: WHO (Finance Manager, no external authority) + TO WHOM (investment firm not on IR list) + WHEN (quiet period). Combined analysis enabled Legal escalation and new quiet period enforcement rule."
            },
            timeline: [
                { time: '8:00 AM', event: 'Case closed - rule created', source: 'Security Admin', color: 'status-success' },
                { time: '7:30 AM', event: 'Legal counsel engaged', source: 'AXIA escalation', color: 'primary' },
                { time: '7:25 AM', event: 'Case escalated to critical', source: 'AXIA analysis engine', color: 'severity-critical' },
                { time: '7:22 AM', event: 'DLP blocked outbound email', source: 'Microsoft Purview DLP', color: 'status-blocked' },
                { time: '7:20 AM', event: 'Email attempted to external recipient', source: 'Email Gateway (Microsoft 365)', color: 'text-secondary' }
            ],
            canEnforce: true,
            hasEnforcementRule: 'rule-003',
            // V6.12: Existing DLP rule blocked this - needs adjustment for quiet period
            enforcementType: 'adjust-dlp-rule',
            enforcementReason: 'DLP rule exists for financial classification - adjust to add quiet period timing restriction'
        },

        // ========== HIGH CASES (3 open) ==========

        {
            id: 'CASE-2024-005',
            title: 'CRM bulk export by departing sales rep',
            severity: 'high',
            status: 'closed',
            score: 86,
            time: '3d ago',
            description: 'Sales representative exported full customer list (4,200 accounts) one week before departure to competitor.',
            entity: {
                name: 'Ryan Torres',
                initials: 'RT',
                role: 'Senior Sales Representative',
                department: 'Sales',
                location: 'Chicago',
                joined: 'Feb 2021',
                riskFactors: ['Resignation effective next Friday', 'Moving to competitor', 'Full account list export']
            },
            dlpAlerted: false,
            dlpSystem: 'Netskope',
            actions: ['Manager notified', 'HR notified', 'Rule created'],
            completedActions: ['contact-manager', 'contact-hr'], // V6.15: Track completed action IDs for grey-out
            analysis: {
                what: 'Ryan Torres exported complete customer account list (4,200 records including contact details, contract values, and renewal dates) from the CRM. Ryan submitted resignation last week and is joining CompetitorCorp.',
                whyMatters: 'Customer lists with contract details are trade secrets. This data would give competitor immediate insight into pricing, relationships, and renewal vulnerabilities.',
                whyUnusual: "Native CRM exports don't trigger file-based monitoring. AXIA detected: WHO (departing rep, joining competitor) + WHAT (4,200 accounts, 140x normal, outside territory) + WHEN (one week before departure). Behavioral context enabled early intervention and new enforcement rule."
            },
            timeline: [
                { time: '7:00 AM', event: 'Enforcement rule created', source: 'Security Admin', color: 'status-success' },
                { time: '6:45 AM', event: 'HR notified of flight risk behavior', source: 'AXIA engagement', color: 'accent-teal' },
                { time: '6:40 AM', event: 'Manager notified', source: 'AXIA engagement', color: 'accent-teal' },
                { time: '6:35 AM', event: 'Case created', source: 'AXIA analysis engine', color: 'primary' },
                { time: '6:30 AM', event: 'Bulk CRM export detected (4,200 accounts)', source: 'CRM API', color: 'severity-high' }
            ],
            canEnforce: true,
            hasEnforcementRule: 'rule-004',
            // V6.12: Behavioral pattern - departure timing + competitor context
            enforcementType: 'activate-smart-block',
            enforcementReason: 'Departure timing + volume anomaly requires contextual understanding - CRM exports alone are legitimate'
        },

        {
            id: 'CASE-2024-006',
            title: 'Context-validated customer share - verified legitimate',
            severity: 'high',
            status: 'open',
            score: 75,
            time: '5h ago',
            description: 'AXIA analyzed product specifications sent to verified customer. Context confirmed legitimate business activity.',
            entity: {
                name: 'Jennifer Walsh',
                initials: 'JW',
                role: 'Solutions Architect',
                department: 'Sales Engineering',
                location: 'Boston',
                joined: 'Apr 2022',
                riskFactors: ['None identified']
            },
            dlpAlerted: true,
            dlpSystem: 'Purview',
            actions: ['User verified', 'Pending approval'],
            completedActions: [], // V6.15: No engagement actions taken yet
            analysis: {
                what: 'Jennifer Walsh sent product technical specifications to a verified customer (Acme Corp) during active sales engagement. DLP alerted due to "Confidential" classification, but this is standard practice for enterprise sales.',
                whyMatters: 'While the document contains proprietary information, sharing technical specs with serious prospects is normal sales process. Flagging legitimate business could delay deals worth $2.4M.',
                whyUnusual: "Classification triggered an alert, but context shows legitimate activity: WHO (Solutions Architect, role-appropriate) + WHAT (technical specs, standard sales material) + TO WHOM (verified customer with $2.4M opportunity). AXIA identified as likely false positive and engaged user to verify."
            },
            timeline: [
                { time: '5:30 AM', event: 'Awaiting manager approval to confirm', source: 'AXIA workflow', color: 'primary' },
                { time: '5:25 AM', event: 'User verified legitimate business purpose', source: 'AXIA engagement', color: 'status-success' },
                { time: '5:20 AM', event: 'AXIA identified as potential false positive', source: 'AXIA analysis engine', color: 'primary' },
                { time: '5:15 AM', event: 'DLP alerted on outbound email', source: 'Microsoft Purview DLP', color: 'status-blocked' }
            ],
            canEnforce: false
        },

        {
            id: 'CASE-2024-007',
            title: 'Customer PII exported via API automation',
            severity: 'high',
            status: 'open',
            score: 82,
            time: '6h ago',
            description: 'Automated script exported 8,400 customer records. Volume 420% above normal daily operations.',
            entity: {
                name: 'Dana Anderson',
                initials: 'DA',
                role: 'Data Engineer',
                department: 'Analytics',
                location: 'Austin',
                joined: 'Feb 2023',
                riskFactors: ['Automated extraction', 'PII data', 'Volume anomaly']
            },
            dlpAlerted: false,
            dlpSystem: 'Netskope',
            actions: ['Manager notified'],
            completedActions: ['contact-manager'], // V6.15: Track completed action IDs for grey-out
            analysis: {
                what: 'Dana Anderson ran an automated script that exported 8,400 customer records including names, emails, phone numbers, and purchase history. The script used service account credentials with broad access.',
                whyMatters: 'Bulk PII export creates data breach risk and potential regulatory violations under GDPR and CCPA. If this data leaves the organization, notification obligations could be triggered.',
                whyUnusual: "API-level data extraction bypasses file-based monitoring. AXIA detected: WHO (Data Engineer using service account) + WHAT (8,400 PII records, 42x normal volume) + HOW (direct API, not standard analytics workflow). Behavioral analysis triggered manager notification."
            },
            timeline: [
                { time: '4:45 AM', event: 'Manager notification sent', source: 'AXIA engagement', color: 'accent-teal' },
                { time: '4:40 AM', event: 'Case created', source: 'AXIA analysis engine', color: 'primary' },
                { time: '4:35 AM', event: 'Bulk PII export detected (8,400 records)', source: 'Database monitoring', color: 'severity-high' }
            ],
            canEnforce: false
        },

        {
            id: 'CASE-2024-008',
            title: 'CRM data synced to personal cloud storage',
            severity: 'high',
            status: 'open',
            score: 79,
            time: '8h ago',
            description: 'Sales account manager configured unauthorized CRM-to-Dropbox sync capturing deal pipeline and customer contacts.',
            entity: {
                name: 'Kevin Martinez',
                initials: 'KM',
                role: 'Account Manager',
                department: 'Sales',
                location: 'Los Angeles',
                joined: 'May 2022',
                riskFactors: ['Unauthorized cloud sync', 'Personal Dropbox account', 'CRM data extraction']
            },
            dlpAlerted: true,
            dlpSystem: 'Netskope',
            actions: ['Sync disabled', 'Manager notified', 'Investigation ongoing'],
            completedActions: ['contact-manager'], // V6.15: Track completed action IDs for grey-out
            analysis: {
                what: 'Kevin Martinez configured a third-party integration (Zapier) to automatically sync CRM opportunity data and contact records to his personal Dropbox account. Netskope CASB detected the unauthorized cloud-to-cloud data flow.',
                whyMatters: 'CRM data including deal sizes, customer contacts, and pipeline information being copied to unmanaged personal storage creates data loss risk and violates data handling policies.',
                whyUnusual: "Netskope detected the unauthorized cloud-to-cloud sync. AXIA took action: Disabled the Zapier integration, notified manager, and is creating enforcement rule to prevent similar unauthorized syncs. Case actively being resolved."
            },
            timeline: [
                { time: '2:15 AM', event: 'Manager notified of policy violation', source: 'AXIA engagement', color: 'accent-teal' },
                { time: '2:10 AM', event: 'Zapier integration disabled by IT', source: 'Admin action', color: 'status-success' },
                { time: '2:05 AM', event: 'Case created', source: 'AXIA analysis engine', color: 'primary' },
                { time: '2:00 AM', event: 'Netskope detected CRM→Dropbox sync', source: 'Netskope CASB', color: 'status-blocked' }
            ],
            canEnforce: true,
            // V6.12: Simple pattern - block unauthorized cloud syncs
            enforcementType: 'create-dlp-rule',
            enforcementReason: 'Simple pattern (cloud-to-personal-storage sync) can be blocked by DLP CASB policy - no existing rule',
            enforcementSuggestion: {
                when: 'Any user',
                does: 'Configures cloud-to-cloud sync',
                through: 'CRM',
                to: 'Personal cloud storage'
            }
        },

        // ========== MEDIUM CASES ==========

        {
            id: 'CASE-2024-009',
            title: 'Oversharing pattern detected - Engineering team',
            severity: 'medium',
            status: 'open',
            score: 68,
            time: '10h ago',
            description: 'Aggregate pattern: 6 engineers sharing technical docs to external domains not in approved vendor list.',
            entity: {
                name: 'Engineering Team',
                initials: 'ET',
                role: '6 users identified',
                department: 'Engineering',
                location: 'Multiple',
                joined: 'N/A',
                isGroup: true,
                riskFactors: ['Team-wide pattern', 'External sharing', 'Possible process gap']
            },
            dlpAlerted: false,
            dlpSystem: 'Purview',
            actions: ['Team lead notified', 'Training scheduled'],
            completedActions: ['contact-manager'], // V6.15: Track completed action IDs for grey-out (team lead = manager)
            analysis: {
                what: 'Six engineers across three teams have shared technical documentation (API specs, architecture diagrams, integration guides) to external domains not on the approved vendor or partner list over the past week.',
                whyMatters: 'Technical documentation reveals system architecture and integration points. If shared with malicious actors, this information could be used to identify attack vectors.',
                whyUnusual: "Individual shares were low severity. AXIA connected the pattern: WHO (6 engineers across 3 teams) + WHAT (API specs, architecture docs) + TO WHOM (same unapproved domains). Pattern suggests process gap — either new project not onboarded or shared policy misunderstanding. Team training scheduled."
            },
            timeline: [
                { time: 'Yesterday 2:00 PM', event: 'Security awareness training scheduled', source: 'AXIA recommendation', color: 'primary' },
                { time: 'Yesterday 1:30 PM', event: 'Engineering director notified', source: 'AXIA engagement', color: 'accent-teal' },
                { time: 'Yesterday 1:00 PM', event: 'Pattern detected across 6 users', source: 'AXIA analysis engine', color: 'severity-medium' }
            ],
            canEnforce: false
        },

        {
            id: 'CASE-2024-010',
            title: 'Product roadmap shared in public Teams channel',
            severity: 'medium',
            status: 'closed',
            score: 65,
            time: '12h ago',
            description: 'Confidential 2026 roadmap posted in Teams channel with 340 members including external guests.',
            entity: {
                name: 'Priya Desai',
                initials: 'PD',
                role: 'Product Manager',
                department: 'Product',
                location: 'Seattle',
                joined: 'Nov 2022',
                riskFactors: ['External guests in channel', 'Confidential document', 'Wide distribution']
            },
            dlpAlerted: false,
            dlpSystem: 'Purview',
            actions: ['Document removed', 'Employee coached'],
            completedActions: ['contact-employee'], // V6.15: Track completed action IDs for grey-out
            analysis: {
                what: 'Priya Desai uploaded the 2026 Product Roadmap (marked Confidential) to the "Product-Updates" Teams channel which includes 340 members, 12 of whom are external guest accounts from partner organizations.',
                whyMatters: 'Product roadmaps contain strategic timing, competitive features, and pricing direction. External partners should only see roadmap sections relevant to their integration.',
                whyUnusual: "Confidential doc detected in channel with external guests. AXIA understood context: WHO (Product Manager, likely accidental) + WHERE (similar channel names caused confusion). Document removed within 5 minutes, Priya coached on channel selection. Simple human error resolved quickly."
            },
            timeline: [
                { time: 'Yesterday 12:30 PM', event: 'Employee acknowledged and coached', source: 'AXIA engagement', color: 'accent-teal' },
                { time: 'Yesterday 12:15 PM', event: 'Document removed from channel', source: 'Teams admin action', color: 'status-success' },
                { time: 'Yesterday 12:10 PM', event: 'Case created', source: 'AXIA analysis engine', color: 'primary' },
                { time: 'Yesterday 12:05 PM', event: 'Confidential document detected in external-facing channel', source: 'Teams DLP integration', color: 'severity-medium' }
            ],
            canEnforce: false
        },

        {
            id: 'CASE-2024-011',
            title: 'Employee compensation data exported for analysis',
            severity: 'medium',
            status: 'closed',
            score: 62,
            time: '4d ago',
            description: 'HR analyst exported company-wide compensation data for market analysis. Legitimate purpose but required approval workflow.',
            entity: {
                name: 'Rachel Green',
                initials: 'RG',
                role: 'HR Analyst',
                department: 'HR',
                location: 'Denver',
                joined: 'Aug 2021',
                riskFactors: ['Sensitive employee data', 'Bulk export', 'External benchmarking purpose']
            },
            dlpAlerted: false,
            dlpSystem: 'Netskope',
            actions: ['Manager notified', 'Approval obtained', 'Case closed'],
            completedActions: ['contact-manager'], // V6.15: Track completed action IDs for grey-out
            analysis: {
                what: 'Rachel Green exported compensation data for 842 employees including salary bands, bonus structures, and equity grants for market competitiveness analysis with external consulting firm.',
                whyMatters: 'Compensation data is highly sensitive employee information. Unauthorized disclosure could create legal liability, employee relations issues, and competitive disadvantage in recruiting.',
                whyUnusual: "Bulk export of sensitive HR data requires approval. AXIA understood context: WHO (HR Analyst, role-appropriate) + WHAT (comp data for legitimate benchmarking) + WHY (external consulting engagement). Coached Rachel on approval workflow, routed to VP HR, approval obtained, case closed successfully."
            },
            timeline: [
                { time: '4 days ago 3:00 PM', event: 'Case closed - approval obtained', source: 'HR Director', color: 'status-success' },
                { time: '4 days ago 1:00 PM', event: 'VP HR approved external sharing', source: 'Approval workflow', color: 'status-success' },
                { time: '4 days ago 11:30 AM', event: 'Rachel coached on approval process', source: 'AXIA engagement', color: 'accent-teal' },
                { time: '4 days ago 11:00 AM', event: 'Manager notified', source: 'AXIA engagement', color: 'accent-teal' },
                { time: '4 days ago 10:30 AM', event: 'Case created', source: 'AXIA analysis engine', color: 'primary' },
                { time: '4 days ago 10:15 AM', event: 'Bulk compensation export detected', source: 'Workday integration', color: 'severity-medium' }
            ],
            canEnforce: false
        },

        // ========== LOW CASES ==========

        {
            id: 'CASE-2024-012',
            title: 'Open source code contribution - verified legitimate',
            severity: 'low',
            status: 'closed',
            score: 38,
            time: '5d ago',
            description: 'Engineer pushed internal utility code to public GitHub. Verified as pre-approved open source contribution.',
            entity: {
                name: 'Alex Thompson',
                initials: 'AT',
                role: 'Staff Engineer',
                department: 'Engineering',
                location: 'Seattle',
                joined: 'Mar 2020',
                riskFactors: ['None - approved OSS contribution']
            },
            dlpAlerted: false,
            dlpSystem: 'Purview',
            actions: ['OSS approval verified', 'Auto-resolved'],
            completedActions: [], // V6.15: Auto-resolved case, no manual engagement actions
            analysis: {
                what: 'Alex Thompson pushed code to public GitHub repository (company-utils/logging-framework). The code is a logging utility that was pre-approved for open source release under Apache 2.0 license.',
                whyMatters: 'Code pushed to public repositories is immediately accessible worldwide. Without proper review, proprietary algorithms or sensitive business logic could be exposed.',
                whyUnusual: "Public repo push flagged for verification. AXIA analyzed context: WHO (Staff Engineer, listed OSS maintainer) + WHAT (logging utility) + WHERE (pre-approved project, Legal cleared 3 months ago). Verified legitimate and auto-resolved in 15 minutes."
            },
            timeline: [
                { time: '5 days ago 4:00 PM', event: 'Case auto-closed - legitimate OSS contribution', source: 'AXIA resolution engine', color: 'status-success' },
                { time: '5 days ago 3:50 PM', event: 'OSS approval verified in registry', source: 'AXIA analysis engine', color: 'status-success' },
                { time: '5 days ago 3:45 PM', event: 'Case created for verification', source: 'AXIA analysis engine', color: 'primary' },
                { time: '5 days ago 3:40 PM', event: 'Public repository push detected', source: 'GitHub Enterprise', color: 'text-secondary' }
            ],
            canEnforce: false
        },

        {
            id: 'CASE-2024-014',
            title: 'NDA sent to wrong email address',
            severity: 'low',
            status: 'closed',
            score: 42,
            time: '5d ago',
            description: 'Legal assistant sent vendor NDA to similar-looking but incorrect email. Recipient confirmed deletion.',
            entity: {
                name: 'Maria Santos',
                initials: 'MS',
                role: 'Legal Assistant',
                department: 'Legal',
                location: 'Chicago',
                joined: 'Mar 2022',
                riskFactors: ['Email typo', 'Human error']
            },
            dlpAlerted: false,
            dlpSystem: 'Purview',
            actions: ['Recipient contacted', 'Deletion confirmed', 'Auto-resolved'],
            completedActions: [], // V6.15: Auto-resolved case, no manual engagement actions
            analysis: {
                what: 'Maria Santos sent standard vendor NDA to john.smith@acme-corp.net instead of john.smith@acme-corp.com. Email autocomplete selected the wrong cached address.',
                whyMatters: 'NDAs contain mutual confidentiality terms. While not highly sensitive individually, misdirected legal documents could create confusion or minor disclosure.',
                whyUnusual: "Email autocomplete selected wrong cached address (.net vs .com). AXIA detected mismatch, contacted recipient directly, confirmed immediate deletion. Simple human error resolved quickly through engagement."
            },
            timeline: [
                { time: '2 days ago 3:00 PM', event: 'Case auto-closed', source: 'AXIA resolution engine', color: 'status-success' },
                { time: '2 days ago 2:30 PM', event: 'Recipient confirmed deletion', source: 'Email confirmation', color: 'status-success' },
                { time: '2 days ago 11:30 AM', event: 'AXIA sent deletion request to recipient', source: 'AXIA engagement', color: 'accent-teal' },
                { time: '2 days ago 11:00 AM', event: 'Case created', source: 'AXIA analysis engine', color: 'primary' }
            ],
            canEnforce: false
        },

        {
            id: 'CASE-2024-015',
            title: 'Meeting recording shared with approved consultant',
            severity: 'low',
            status: 'closed',
            score: 35,
            time: '6d ago',
            description: 'Project manager shared internal meeting recording with external consultant. Verified as authorized.',
            entity: {
                name: 'James Wilson',
                initials: 'JW',
                role: 'Project Manager',
                department: 'Operations',
                location: 'Boston',
                joined: 'Jul 2020',
                riskFactors: ['None - authorized sharing']
            },
            dlpAlerted: false,
            dlpSystem: 'Purview',
            actions: ['Verified legitimate', 'Auto-resolved'],
            completedActions: [], // V6.15: Auto-resolved case, no manual engagement actions
            analysis: {
                what: 'James Wilson shared Teams meeting recording with external consultant (Sarah Chen at ConsultingFirm LLC) who is actively working on the digital transformation project.',
                whyMatters: 'Meeting recordings may contain strategic discussions. However, sharing with engaged consultants under NDA is standard practice.',
                whyUnusual: "External share flagged for review. AXIA analyzed context: WHO (Project Manager, normal role) + TO WHOM (consultant on approved vendor list, NDA signed, assigned to project) + WHAT (relevant meeting recording). Verified legitimate and auto-resolved."
            },
            timeline: [
                { time: '3 days ago 2:00 PM', event: 'Case auto-closed - legitimate sharing', source: 'AXIA resolution engine', color: 'status-success' },
                { time: '3 days ago 1:55 PM', event: 'AXIA verified consultant authorization', source: 'AXIA analysis engine', color: 'status-success' },
                { time: '3 days ago 1:50 PM', event: 'Case created for review', source: 'AXIA analysis engine', color: 'primary' }
            ],
            canEnforce: false
        },

        // ========== V6.16: RESOLUTION TIMELINE CASE ==========
        // Demonstrates rapid resolution lifecycle - "cases resolve, not just close"
        {
            id: 'CASE-2024-016',
            title: 'Customer list shared to personal email - resolved through coaching',
            severity: 'high',
            status: 'closed',
            score: 78,
            time: 'Tuesday',
            description: 'Sales coordinator sent customer contact list to personal email for remote work. Resolved through employee coaching within 5 hours.',
            entity: {
                name: 'Sarah Chen',
                initials: 'SC',
                role: 'Sales Coordinator',
                department: 'Sales',
                location: 'Chicago',
                joined: 'Mar 2023',
                riskFactors: ['Personal email destination', 'Customer PII', 'First-time incident']
            },
            dlpAlerted: true,
            dlpSystem: 'Purview',
            actions: ['Employee coached', 'Personal copy deleted', 'Case resolved'],
            completedActions: ['contact-employee'],
            analysis: {
                what: 'Sarah Chen sent a customer contact spreadsheet (1,247 records with names, emails, phone numbers) to her personal Gmail account (sarah.chen.personal@gmail.com). DLP flagged the PII pattern.',
                whyMatters: 'Customer PII requires protection under privacy regulations. Personal email accounts lack enterprise security controls and audit trails.',
                whyUnusual: "AXIA understood context: WHO (Sales Coordinator, 2 years tenure, no prior incidents) + WHAT (customer contacts, not full account data) + WHY (working remotely, needed offline access). Low malicious intent - coaching appropriate. Resolution: 5 hours from detection to confirmed deletion."
            },
            timeline: [
                { time: 'Tuesday 2:17 PM', event: 'Case resolved - personal copy confirmed deleted', source: 'AXIA resolution engine', color: 'status-success' },
                { time: 'Tuesday 2:17 PM', event: 'Employee acknowledged coaching and confirmed deletion', source: 'Employee response', color: 'accent-teal' },
                { time: 'Tuesday 12:03 PM', event: 'Employee coaching sent - explained data handling policy', source: 'AXIA engagement', color: 'accent-teal' },
                { time: 'Tuesday 9:45 AM', event: 'Case created for review', source: 'AXIA analysis engine', color: 'primary' },
                { time: 'Tuesday 9:15 AM', event: 'Customer PII detected in outbound email', source: 'Microsoft Purview DLP', color: 'severity-high' }
            ],
            canEnforce: false,
            // V6.16: Resolution metrics for demo
            resolutionMetrics: {
                totalTime: '5 hours 2 minutes',
                detectionToAction: '2 hours 48 minutes',
                actionToResolution: '2 hours 14 minutes'
            }
        },

        // ========== V6.16: WHO/WHAT/WHO CONTEXT CASE ==========
        // Demonstrates full context framework - sender, content, recipient
        {
            id: 'CASE-2024-017',
            title: 'Source code sent to personal email by Marketing Director',
            severity: 'critical',
            status: 'open',
            score: 96,
            time: '45m ago',
            description: 'Marketing Director with no engineering access sent authentication source code to personal Gmail. LinkedIn updated 3 days ago.',
            entity: {
                name: 'Alex Chen',
                initials: 'AC',
                role: 'Marketing Director',
                department: 'Marketing',
                location: 'Austin',
                joined: 'Feb 2021',
                riskFactors: ['No prior access to engineering repos', 'LinkedIn updated 3 days ago', 'Personal email matches employee name pattern']
            },
            dlpAlerted: true,
            dlpSystem: 'Purview',
            actions: ['Manager notified', 'HR notified', 'Evidence preserved'],
            completedActions: ['contact-manager', 'contact-hr'],
            analysis: {
                // V6.16: WHO/WHAT/WHO framework prominently displayed
                what: 'Alex Chen sent a ZIP archive containing 47 source code files (12,000+ lines) including authentication modules, API keys, and credential handling logic to alexchen.personal@gmail.com.',
                whyMatters: 'Authentication code contains security-critical logic and embedded credentials. Exposure could enable unauthorized access to production systems.',
                whyUnusual: "FULL CONTEXT ANALYSIS:\n\n**WHO SENT**: Alex Chen, Marketing Director\n• Role has no legitimate need for source code access\n• No prior access to engineering repositories\n• LinkedIn profile updated 3 days ago (potential departure signal)\n\n**WHAT**: Source code - authentication modules\n• 47 files, 12,000+ lines of code\n• Contains API keys and credentials\n• Core security infrastructure\n\n**WHO RECEIVED**: External Gmail (alexchen.personal@gmail.com)\n• No prior contact with organization\n• Personal email pattern matches employee name\n• Not a known vendor or partner domain\n\nDLP saw: 'Code pattern detected'\nAXIA sees: Marketing Director with no code access, updated LinkedIn, sending auth code to personal email. This is the difference between a pattern match and a judgment."
            },
            timeline: [
                { time: '10:30 AM', event: 'Evidence packet prepared for legal review', source: 'AXIA analysis engine', color: 'primary' },
                { time: '10:15 AM', event: 'HR team notified of risk pattern', source: 'AXIA engagement', color: 'accent-teal' },
                { time: '10:05 AM', event: 'Manager notified - awaiting response', source: 'AXIA engagement', color: 'accent-teal' },
                { time: '9:50 AM', event: 'Case escalated to Critical - context analysis complete', source: 'AXIA analysis engine', color: 'severity-critical' },
                { time: '9:45 AM', event: 'Source code with credentials detected', source: 'Microsoft Purview DLP', color: 'severity-high' }
            ],
            canEnforce: true,
            enforcementType: 'activate-smart-block',
            enforcementReason: 'Cross-department code access + departure signals requires behavioral analysis that DLP rules cannot capture',
            enforcementSuggestion: {
                when: 'Non-engineering employee',
                does: 'Accesses or shares source code files',
                through: 'Any channel',
                to: 'Personal email domains'
            }
        }
    ],

    // ==================== INTEL SUGGESTED PROMPTS ====================
    intelPrompts: {
        welcome: [
            { label: 'Top risk users', prompt: 'Who are the top 5 users with the most high-severity cases this month?' },
            { label: 'Data type patterns', prompt: 'What data types are most commonly involved in DLP alerts?' },
            { label: 'Department risk', prompt: 'Which departments have the highest risk scores?' },
            { label: 'Unusual access', prompt: 'Show me unusual access patterns in the last 7 days' },
            { label: 'Incident trends', prompt: "What's the trend of true incidents vs false alarms over time?" }
        ],
        caseContext: [
            { label: 'Similar past cases', prompt: 'Show me similar cases from the past and how they were resolved' },
            { label: 'Entity risk history', prompt: 'What is this person\'s complete risk history?' },
            { label: 'Recommended response', prompt: 'What response do you recommend for this case and why?' }
        ]
    },

    // ==================== V5.11: TIME SERIES DATA (90 days - AXIA Improvement Story) ====================
    // Month 1: Higher volumes, more issues; Month 2: Improving; Month 3: Optimized
    timeSeriesData: {
        // 90-day daily interactions (consistent volume, showing coverage)
        interactions: [
            // Month 1: Establishing baseline
            41200, 43500, 39800, 45100, 42300, 44700, 40900, 46200, 43800, 41500, 44300, 47100, 42900, 45600, 43200, 46800, 44100, 41800, 45300, 47500, 43700, 46100, 44500, 42100, 45800, 47900, 44200, 46500, 43900, 48200,
            // Month 2: Increasing as more channels onboarded
            48500, 49200, 45800, 50100, 47300, 49700, 46900, 51200, 48800, 46500, 49300, 52100, 47900, 50600, 48200, 51800, 49100, 46800, 50300, 52500, 48700, 51100, 49500, 47100, 50800, 52900, 49200, 51500, 48900, 53200,
            // Month 3: Full coverage, consistent volume
            52800, 53500, 49800, 54100, 51300, 53700, 50900, 55200, 52800, 50500, 53300, 56100, 51900, 54600, 52200, 55800, 53100, 50800, 54300, 56500, 52700, 55100, 53500, 51100, 54800, 56900, 53200, 55500, 52900, 57200
        ],
        cases: {
            // Month 1: More cases, lower close rate; Month 2: Improving; Month 3: Fewer cases, higher close rate
            open: [6, 7, 5, 8, 6, 7, 9, 6, 8, 5, 7, 9, 6, 8, 7, 6, 8, 5, 9, 7, 6, 8, 7, 5, 9, 6, 8, 7, 6, 8,
                   5, 6, 4, 7, 5, 6, 7, 5, 6, 4, 5, 7, 5, 6, 5, 5, 6, 4, 7, 5, 5, 6, 5, 4, 7, 5, 6, 5, 5, 6,
                   3, 4, 2, 5, 3, 4, 5, 3, 4, 2, 3, 5, 3, 4, 3, 3, 4, 2, 5, 3, 3, 4, 3, 2, 5, 3, 4, 3, 3, 4],
            closed: [2, 3, 2, 3, 2, 3, 3, 2, 3, 2, 3, 3, 2, 3, 3, 3, 3, 2, 3, 3, 3, 3, 3, 2, 3, 3, 3, 3, 3, 3,
                     4, 4, 3, 5, 4, 4, 5, 4, 5, 3, 4, 5, 4, 5, 4, 4, 5, 3, 5, 4, 4, 5, 4, 3, 5, 4, 5, 4, 4, 5,
                     5, 6, 5, 7, 5, 6, 7, 5, 6, 5, 5, 7, 5, 6, 5, 5, 6, 5, 7, 5, 5, 6, 5, 5, 7, 5, 6, 5, 5, 6]
        },
        engagements: {
            // Month 1: More manual engagement; Month 2/3: More automated, fewer needed overall
            employee: [8, 10, 7, 12, 9, 10, 13, 8, 11, 7, 9, 13, 8, 10, 9, 8, 11, 7, 13, 10, 8, 11, 9, 7, 13, 8, 11, 9, 8, 11,
                       7, 9, 6, 10, 8, 9, 11, 7, 9, 6, 8, 11, 7, 9, 8, 7, 9, 6, 11, 8, 7, 9, 8, 6, 11, 7, 9, 8, 7, 9,
                       5, 7, 4, 8, 6, 7, 9, 5, 8, 4, 6, 9, 5, 7, 6, 5, 8, 4, 9, 7, 5, 8, 6, 4, 9, 5, 8, 6, 5, 8],
            manager: [4, 5, 3, 5, 4, 5, 6, 4, 5, 3, 4, 6, 4, 5, 4, 4, 5, 3, 6, 5, 4, 5, 4, 3, 6, 4, 5, 4, 4, 5,
                      3, 4, 2, 4, 3, 4, 5, 3, 4, 2, 3, 5, 3, 4, 3, 3, 4, 2, 5, 4, 3, 4, 3, 2, 5, 3, 4, 3, 3, 4,
                      2, 3, 1, 3, 2, 3, 4, 2, 3, 1, 2, 4, 2, 3, 2, 2, 3, 1, 4, 3, 2, 3, 2, 1, 4, 2, 3, 2, 2, 3],
            legal: [1, 2, 1, 2, 1, 1, 2, 1, 2, 1, 1, 2, 1, 2, 1, 1, 2, 1, 2, 1, 1, 2, 1, 1, 2, 1, 2, 1, 1, 2,
                    1, 1, 0, 1, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1,
                    0, 1, 0, 1, 0, 0, 1, 0, 1, 0, 0, 1, 0, 1, 0, 0, 1, 0, 1, 0, 0, 1, 0, 0, 1, 0, 1, 0, 0, 1]
        },
        dlpAlerts: {
            // Month 1: High alerts, high false positives; Month 2/3: Declining as policies tuned
            critical: [3, 4, 2, 4, 3, 3, 5, 3, 4, 2, 3, 5, 3, 4, 3, 3, 4, 2, 5, 3, 3, 4, 3, 2, 5, 3, 4, 3, 3, 4,
                       2, 3, 1, 3, 2, 2, 4, 2, 3, 1, 2, 4, 2, 3, 2, 2, 3, 1, 4, 2, 2, 3, 2, 1, 4, 2, 3, 2, 2, 3,
                       1, 2, 0, 2, 1, 1, 3, 1, 2, 0, 1, 3, 1, 2, 1, 1, 2, 0, 3, 1, 1, 2, 1, 0, 3, 1, 2, 1, 1, 2],
            medium: [6, 7, 5, 8, 6, 7, 8, 6, 7, 5, 6, 8, 6, 7, 6, 6, 7, 5, 8, 6, 6, 7, 6, 5, 8, 6, 7, 6, 6, 7,
                     4, 5, 3, 6, 4, 5, 6, 4, 5, 3, 4, 6, 4, 5, 4, 4, 5, 3, 6, 4, 4, 5, 4, 3, 6, 4, 5, 4, 4, 5,
                     3, 4, 2, 5, 3, 4, 5, 3, 4, 2, 3, 5, 3, 4, 3, 3, 4, 2, 5, 3, 3, 4, 3, 2, 5, 3, 4, 3, 3, 4],
            low: [4, 3, 5, 4, 4, 3, 4, 5, 3, 4, 4, 3, 5, 4, 4, 3, 4, 5, 3, 4, 4, 3, 5, 4, 3, 4, 4, 5, 4, 3,
                  3, 2, 4, 3, 3, 2, 3, 4, 2, 3, 3, 2, 4, 3, 3, 2, 3, 4, 2, 3, 3, 2, 4, 3, 2, 3, 3, 4, 3, 2,
                  2, 1, 3, 2, 2, 1, 2, 3, 1, 2, 2, 1, 3, 2, 2, 1, 2, 3, 1, 2, 2, 1, 3, 2, 1, 2, 2, 3, 2, 1],
            falsePositives: [4, 5, 4, 4, 5, 4, 4, 5, 4, 4, 5, 4, 4, 5, 4, 4, 5, 4, 4, 5, 4, 4, 5, 4, 4, 5, 4, 4, 5, 4,
                             3, 3, 2, 3, 3, 2, 3, 3, 2, 3, 3, 2, 3, 3, 2, 3, 3, 2, 3, 3, 2, 3, 3, 2, 3, 3, 2, 3, 3, 2,
                             1, 2, 1, 1, 2, 1, 1, 2, 1, 1, 2, 1, 1, 2, 1, 1, 2, 1, 1, 2, 1, 1, 2, 1, 1, 2, 1, 1, 2, 1]
        },
        // Month 1: High MTTR ~2.5h; Month 2: Improving ~1.5h; Month 3: Optimized ~1h
        mttr: [2.8, 2.6, 3.1, 2.4, 2.5, 2.3, 2.7, 2.2, 2.6, 2.9, 2.4, 2.1, 2.5, 2.3, 2.4, 2.2, 2.6, 2.8, 2.1, 2.3, 2.4, 2.2, 2.5, 2.7, 2.1, 2.3, 2.2, 2.4, 2.3, 2.2,
               1.8, 1.6, 2.1, 1.4, 1.5, 1.3, 1.7, 1.2, 1.6, 1.9, 1.4, 1.1, 1.5, 1.3, 1.4, 1.2, 1.6, 1.8, 1.1, 1.3, 1.4, 1.2, 1.5, 1.7, 1.1, 1.3, 1.2, 1.4, 1.3, 1.2,
               1.1, 0.9, 1.2, 0.8, 0.9, 0.7, 1.0, 0.8, 1.0, 1.2, 0.8, 0.6, 0.9, 0.8, 0.9, 0.7, 1.0, 1.1, 0.6, 0.8, 0.9, 0.7, 0.9, 1.0, 0.6, 0.8, 0.7, 0.9, 0.8, 0.7]
    },

    // ==================== V5.5: ADDITIONAL CONNECTIONS ====================
    // V6.20: Removed Slack, added 'in-environment' status for available connections
    additionalConnections: {
        text: [
            { name: 'Microsoft Teams Chat', icon: 'forum', status: 'in-environment' },
            { name: 'Zoom Chat', icon: 'videocam', status: 'coming-soon' }
        ],
        saas: [
            { name: 'Dropbox Business', icon: 'cloud', status: 'in-environment' },
            { name: 'Box Enterprise', icon: 'folder', status: 'available' },
            { name: 'OneDrive', icon: 'cloud_upload', status: 'in-environment' },
            { name: 'AWS S3', icon: 'database', status: 'coming-soon' }
        ],
        // V6.14: Expanded DLP list
        dlp: [
            { name: 'Symantec DLP', icon: 'shield', status: 'in-environment' },
            { name: 'Forcepoint DLP', icon: 'security', status: 'available' },
            { name: 'Digital Guardian', icon: 'verified_user', status: 'available' },
            { name: 'Trellix DLP', icon: 'lock', status: 'available' },
            { name: 'Proofpoint DLP', icon: 'mail_lock', status: 'available' },
            { name: 'Code42 Incydr', icon: 'code', status: 'available' },
            { name: 'Zscaler DLP', icon: 'cloud_sync', status: 'available' },
            { name: 'Palo Alto DSPM', icon: 'dns', status: 'available' }
        ],
        context: [
            { name: 'ServiceNow ITSM', icon: 'support_agent', status: 'in-environment' },
            { name: 'Jira', icon: 'task', status: 'in-environment' },
            { name: 'Active Directory', icon: 'group', status: 'in-environment' },
            { name: 'Splunk', icon: 'analytics', status: 'coming-soon' }
        ]
    },

    // ==================== V6.10: CASE ACTION OPTIONS ====================
    // V6.10: Renamed policy actions to enforcement, removed Save Evidence (automatic)
    caseActionOptions: [
        { id: 'contact-employee', label: 'Contact Employee', icon: 'person', enabled: true, category: 'engagement' },
        { id: 'contact-manager', label: 'Contact Manager', icon: 'supervisor_account', enabled: true, category: 'engagement' },
        { id: 'contact-legal', label: 'Contact Legal', icon: 'gavel', enabled: true, category: 'escalation' },
        { id: 'contact-hr', label: 'Contact HR', icon: 'badge', enabled: true, category: 'escalation' },
        { id: 'create-dlp-rule', label: 'Create new DLP Rule', icon: 'add_circle', enabled: true, category: 'enforcement' },
        { id: 'adjust-dlp-rule', label: 'Adjust related DLP Rule', icon: 'tune', enabled: true, category: 'enforcement' },
        { id: 'activate-smart-block', label: 'Activate Smart Block', icon: 'security', enabled: true, category: 'enforcement' }
    ]
};

// Helper to get cases data (for compatibility)
const casesData = DEMO_DATA.cases;
const tourSteps = DEMO_DATA.tourSteps;
const connectionsData = DEMO_DATA.connections;
const channelsData = DEMO_DATA.connections; // Alias for backward compatibility
const enforcementRulesData = DEMO_DATA.enforcementRules;


// ========== chat.js ==========
// ==================== CHAT / INTEL FUNCTIONS ====================

let currentThreadId = null;
let chatMessages = [];
let isLoading = false;
let attachedFile = null;

// ==================== DEMO MODE RESPONSES ====================
// Simulated responses for demo mode (when no API key is configured)
const DEMO_RESPONSES = {
    'marcus chen': `## Risk Profile: Marcus Chen

**Role:** Senior Software Engineer | **Department:** Engineering | **Location:** San Francisco

### Current Risk Assessment: **CRITICAL** (Score: 98)

Marcus Chen submitted his resignation 2 weeks ago and has accepted a position at **DirectCompete Inc.**, a direct competitor.

### Behavioral Anomalies Detected

Over the past 5 days, Marcus has exhibited a **340% increase** in data access volume:

| Activity | Volume | Baseline | Deviation |
|----------|--------|----------|-----------|
| GitHub file downloads | 847 files | 15-20/day | **27x normal** |
| CRM record exports | 2,340 records | 0/day | **New behavior** |
| SharePoint document access | 12 proprietary docs | 2-3/day | **4x normal** |

### Accessed Sensitive Materials
- Core authentication service repository
- Proprietary algorithm documentation
- Customer relationship data from CRM

### Actions Taken
- ✅ Silent evidence collection enabled
- ✅ HR team notified
- ✅ Manager Sarah Kim notified
- ⏳ Legal evidence packet prepared

### Recommendation
**Immediate escalation to Legal recommended.** The breadth of access (code + CRM + documents) combined with departure to competitor suggests systematic data collection. Consider expedited exit with garden leave.`,

    'flight risk': `## Flight Risk Summary

Based on current monitoring, I've identified **2 high-priority departing employees** requiring attention:

### 🔴 Critical: Marcus Chen
- **Status:** Resignation submitted, departing in 2 weeks
- **Destination:** DirectCompete Inc. (direct competitor)
- **Risk Score:** 98
- **Concern:** 340% volume spike across GitHub, CRM, and SharePoint
- **Action:** Silent evidence collection active, legal packet prepared

### 🟠 High: Ryan Torres
- **Status:** Resignation effective next Friday
- **Destination:** CompetitorCorp
- **Risk Score:** 86
- **Concern:** Exported 4,200 CRM accounts (140x normal volume)
- **Action:** Manager and HR notified, recommend restricting CRM access

### Recommendations

1. **Marcus Chen:** Escalate to Legal immediately. Evidence suggests systematic IP collection.

2. **Ryan Torres:** Restrict CRM to view-only access. Prepare reminder letter regarding non-compete obligations.

3. **General:** Review all employees with resignation notices in past 30 days for anomalous access patterns.

*Would you like me to generate a detailed evidence packet for either employee?*`,

    'risk patterns': `## Weekly Risk Patterns Analysis

### Top Risk Patterns This Week

#### 1. **Pre-Departure Data Collection** (2 cases)
- Marcus Chen (Engineering) - Score: 98
- Ryan Torres (Sales) - Score: 86
- *Pattern: Bulk exports + competitor destinations*

#### 2. **Engineering Oversharing** (8 users affected)
- Team-wide pattern detected
- Technical docs shared to non-approved external domains
- *Likely cause: New project with external collaboration not properly onboarded*

#### 3. **Shadow Channel Usage** (2 cases)
- WhatsApp contract sharing (Sales)
- Personal email for board materials (Executive)
- *Pattern: Convenience over security*

### Department Risk Distribution

| Department | Open Cases | Highest Severity |
|------------|------------|------------------|
| Engineering | 4 | Critical |
| Sales | 2 | High |
| Product | 2 | Critical |
| Finance | 1 | Critical |
| Executive | 1 | High |

### Recommended Actions

1. **Immediate:** Address Marcus Chen and Ryan Torres flight risks
2. **This Week:** Onboard external vendors for Engineering collaboration
3. **Ongoing:** Reinforce approved channel policies for Sales

*Want me to drill down into any specific pattern?*`,

    'enforcement': `## Enforcement Opportunities

Based on closed cases with recurring patterns, I've identified **3 opportunities** for automated enforcement rules:

### 1. Source Code Sharing Alert
**Pattern detected in:** CASE-8940, CASE-8756, CASE-8632
**Scenario:**
- **When:** Engineering department
- **Does:** Share code repositories externally
- **Through:** Email or cloud storage
- **To:** Unrecognized domains

**Recommended action:** Block + Manager notification
**Estimated impact:** Prevent ~4 incidents/month

### 2. Financial Data Pre-Filing
**Pattern detected in:** CASE-8938, CASE-8821
**Scenario:**
- **When:** Finance department
- **Does:** Share earnings or financial documents
- **Through:** Any channel
- **To:** External recipients before filing dates

**Recommended action:** Block + Legal alert
**Estimated impact:** Critical compliance protection

### 3. Bulk PII Export
**Pattern detected in:** CASE-8930, CASE-8847
**Scenario:**
- **When:** Any employee
- **Does:** Export >500 customer records
- **Through:** API or database export
- **To:** Any destination

**Recommended action:** Require approval + Audit log
**Estimated impact:** Reduce unauthorized exports by ~80%

*Would you like me to create any of these enforcement rules?*`,

    'default': `I can help you analyze risk patterns, investigate specific employees, create enforcement rules, or provide strategic recommendations.

Here are some things you can ask me:

- **"Tell me about Marcus Chen"** - Get a complete risk profile
- **"Which departing employees should I watch?"** - Flight risk summary
- **"What are this week's risk patterns?"** - Pattern analysis
- **"What enforcement rules should I create?"** - Automated protection opportunities
- **"Summarize the critical cases"** - Current critical incidents
- **"What should I prioritize today?"** - Recommended actions

I have access to all case data, behavioral baselines, and organizational context. How can I assist?`
};

function getDemoResponse(message) {
    const lowerMessage = message.toLowerCase();

    if (lowerMessage.includes('marcus chen') || lowerMessage.includes('marcus')) {
        return DEMO_RESPONSES['marcus chen'];
    }
    if (lowerMessage.includes('flight risk') || lowerMessage.includes('departing') || lowerMessage.includes('departure') || lowerMessage.includes('leaving') || lowerMessage.includes('resign')) {
        return DEMO_RESPONSES['flight risk'];
    }
    if (lowerMessage.includes('risk pattern') || lowerMessage.includes('patterns') || lowerMessage.includes('this week') || lowerMessage.includes('summary') || lowerMessage.includes('summarize')) {
        return DEMO_RESPONSES['risk patterns'];
    }
    if (lowerMessage.includes('enforcement') || lowerMessage.includes('enforce') || lowerMessage.includes('rule') || lowerMessage.includes('policy') || lowerMessage.includes('automate')) {
        return DEMO_RESPONSES['enforcement'];
    }

    return DEMO_RESPONSES['default'];
}

// ==================== API KEY FUNCTIONS ====================
function getApiKey() {
    return localStorage.getItem('axia_api_key') || (typeof DEFAULT_API_KEY !== 'undefined' ? DEFAULT_API_KEY : null);
}

function saveApiKey() {
    const input = document.getElementById('api-key-input');
    const key = input.value.trim();
    if (key && key.startsWith('sk-')) {
        localStorage.setItem('axia_api_key', key);
        document.getElementById('api-modal').classList.add('hidden');
        updateApiStatus();
    } else {
        document.getElementById('api-error').textContent = 'Please enter a valid OpenAI API key';
        document.getElementById('api-error').classList.remove('hidden');
    }
}

function showApiModal() {
    document.getElementById('api-modal').classList.remove('hidden');
    const key = getApiKey();
    if (key) {
        document.getElementById('api-key-input').value = key;
    }
}

function updateApiStatus() {
    const key = getApiKey();
    const statusText = document.getElementById('api-status-text');
    const statusBadge = document.getElementById('api-status-badge');
    if (statusText && statusBadge) {
        if (key) {
            statusText.textContent = 'Connected';
            statusBadge.textContent = 'Live';
            statusBadge.className = 'text-[11px] font-bold px-2 py-1 rounded bg-status-success/20 text-status-success';
        } else {
            statusText.textContent = 'Demo mode';
            statusBadge.textContent = 'Demo';
            statusBadge.className = 'text-[11px] font-bold px-2 py-1 rounded bg-primary/20 text-primary';
        }
    }
}

// ==================== CHAT RENDERING ====================
function getCurrentTime() {
    return new Date().toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit', hour12: true });
}

function escapeHtml(text) {
    const div = document.createElement('div');
    div.textContent = text;
    return div.innerHTML;
}

function formatFileSize(bytes) {
    if (bytes < 1024) return bytes + ' B';
    if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';
    return (bytes / (1024 * 1024)).toFixed(1) + ' MB';
}

function renderChatMessage(role, content, file = null) {
    if (role === 'user') {
        const fileHtml = file ? `
            <div class="mt-3 flex items-center gap-3 bg-white/10 rounded-lg p-2 border border-white/20">
                <div class="w-8 h-8 rounded-lg bg-white/10 flex items-center justify-center">
                    <span class="material-symbols-outlined text-white text-[18px]">description</span>
                </div>
                <div class="flex flex-col min-w-0">
                    <span class="text-xs font-bold text-white truncate">${escapeHtml(file.name)}</span>
                    <span class="text-[11px] text-white/60">${formatFileSize(file.size)}</span>
                </div>
            </div>
        ` : '';
        return `
            <div class="flex flex-col items-end gap-2 max-w-[90%] ml-auto">
                <div class="chat-bubble-user bg-primary p-4 text-white shadow-lg shadow-primary/10 border border-primary/30">
                    <p class="text-sm leading-relaxed">${escapeHtml(content)}</p>
                    ${fileHtml}
                </div>
                <span class="text-[11px] text-text-secondary font-medium pr-1">You · ${getCurrentTime()}</span>
            </div>
        `;
    } else {
        const parsedContent = marked.parse(content || '');
        return `
            <div class="flex flex-col items-start gap-2 max-w-[95%]">
                <div class="flex items-center gap-2 mb-1 px-1">
                    <div class="w-5 h-5 rounded-full bg-status-success/20 border border-status-success/30 flex items-center justify-center">
                        <span class="material-symbols-outlined text-[12px] text-status-success">smart_toy</span>
                    </div>
                    <span class="text-[11px] font-bold text-status-success">AXIA Intelligence</span>
                </div>
                <div class="chat-bubble-ai bg-surface-card p-4 shadow-lg border border-border-default">
                    <div class="chat-content text-sm leading-relaxed text-text-primary">${parsedContent}</div>
                </div>
            </div>
        `;
    }
}

function renderTypingIndicator() {
    return `
        <div id="typing-indicator" class="flex flex-col items-start gap-2 max-w-[95%]">
            <div class="flex items-center gap-2 mb-1 px-1">
                <div class="w-5 h-5 rounded-full bg-status-success/20 border border-status-success/30 flex items-center justify-center">
                    <span class="material-symbols-outlined text-[12px] text-status-success">smart_toy</span>
                </div>
                <span class="text-[11px] font-bold text-status-success">Thinking...</span>
            </div>
        </div>
    `;
}

function renderFullChat() {
    const chat = document.getElementById('intel-chat');
    if (!chat) return;

    let html = '';
    if (chatMessages.length === 0) {
        const prompts = typeof DEMO_DATA !== 'undefined' ? DEMO_DATA.intelPrompts : null;
        html = `
            <div class="flex justify-center pt-8 pb-4">
                <div class="text-center max-w-sm">
                    <div class="w-14 h-14 rounded-2xl bg-primary/20 flex items-center justify-center mx-auto mb-4">
                        <span class="material-symbols-outlined text-primary text-3xl">psychology</span>
                    </div>
                    <h2 class="text-lg font-bold text-text-primary mb-2">How can I help?</h2>
                    <p class="text-sm text-text-secondary">Ask me about risk patterns, analyze documents, create enforcement rules, or get strategic recommendations.</p>
                </div>
            </div>
            <div class="flex flex-wrap justify-center gap-2 pb-4">
                ${prompts && prompts.welcome ? prompts.welcome.map(p => `
                    <button onclick="sendSuggestedPrompt('${p.prompt.replace(/'/g, "\\'")}')" class="px-4 py-2 rounded-full bg-surface-card border border-border-subtle text-text-secondary hover:text-text-primary hover:border-primary transition-colors text-sm">
                        ${p.label}
                    </button>
                `).join('') : `
                    <button onclick="sendSuggestedPrompt('What are the top risk patterns in Engineering this quarter?')" class="px-4 py-2 rounded-full bg-surface-card border border-border-subtle text-text-secondary hover:text-text-primary hover:border-primary transition-colors text-sm">
                        Risk patterns in Engineering
                    </button>
                    <button onclick="sendSuggestedPrompt('Tell me about Marcus Chen')" class="px-4 py-2 rounded-full bg-surface-card border border-border-subtle text-text-secondary hover:text-text-primary hover:border-primary transition-colors text-sm">
                        Analyze Marcus Chen
                    </button>
                    <button onclick="sendSuggestedPrompt('What enforcement rules should I create?')" class="px-4 py-2 rounded-full bg-surface-card border border-border-subtle text-text-secondary hover:text-text-primary hover:border-primary transition-colors text-sm">
                        Enforcement opportunities
                    </button>
                `}
            </div>
        `;
    } else {
        html = `<div class="flex justify-center"><span class="text-[11px] font-bold text-text-secondary uppercase tracking-widest bg-surface-card/50 px-3 py-1 rounded-full border border-border-default">Today</span></div>`;
        chatMessages.forEach(msg => {
            html += renderChatMessage(msg.role, msg.content, msg.file);
        });
    }
    chat.innerHTML = html;
    chat.scrollTop = chat.scrollHeight;
}

// ==================== SEND MESSAGE ====================
async function sendMessage() {
    const input = document.getElementById('intel-input');
    const message = input.value.trim();
    if ((!message && !attachedFile) || isLoading) return;

    const apiKey = getApiKey();
    const isDemoMode = !apiKey;

    const fileToSend = attachedFile;
    const displayMessage = message || `Analyze this file: ${fileToSend?.file.name}`;

    chatMessages.push({
        role: 'user',
        content: displayMessage,
        file: fileToSend ? { name: fileToSend.file.name, size: fileToSend.file.size } : null
    });
    input.value = '';
    removeAttachedFile();
    renderFullChat();

    const chat = document.getElementById('intel-chat');
    chat.innerHTML += renderTypingIndicator();
    chat.scrollTop = chat.scrollHeight;

    isLoading = true;
    document.getElementById('intel-send-btn').disabled = true;
    document.getElementById('intel-status-text').textContent = isDemoMode ? 'Analyzing...' : (fileToSend ? 'Uploading file...' : 'Thinking...');

    // Demo mode - use simulated responses
    if (isDemoMode) {
        await new Promise(r => setTimeout(r, 1000 + Math.random() * 1000)); // Simulate thinking time

        const demoResponse = getDemoResponse(displayMessage);
        chatMessages.push({ role: 'assistant', content: demoResponse });
        renderFullChat();

        isLoading = false;
        document.getElementById('intel-send-btn').disabled = false;
        document.getElementById('intel-status-text').textContent = 'Demo mode';
        chat.scrollTop = chat.scrollHeight;
        return;
    }

    // Live mode - use OpenAI API
    try {
        const headers = {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${apiKey}`,
            'OpenAI-Beta': 'assistants=v2'
        };

        let fileId = null;
        if (fileToSend) {
            document.getElementById('intel-status-text').textContent = 'Uploading file...';
            fileId = await uploadFileToOpenAI(fileToSend.file);
            document.getElementById('intel-status-text').textContent = 'Analyzing...';
        }

        if (!currentThreadId) {
            const threadRes = await fetch('https://api.openai.com/v1/threads', {
                method: 'POST',
                headers
            });
            if (!threadRes.ok) throw new Error('Failed to create thread');
            const threadData = await threadRes.json();
            currentThreadId = threadData.id;
        }

        const messageBody = {
            role: 'user',
            content: message || `Please analyze this file: ${fileToSend.file.name}`
        };

        if (fileId) {
            messageBody.attachments = [{
                file_id: fileId,
                tools: [{ type: 'file_search' }]
            }];
        }

        const msgRes = await fetch(`https://api.openai.com/v1/threads/${currentThreadId}/messages`, {
            method: 'POST',
            headers,
            body: JSON.stringify(messageBody)
        });
        if (!msgRes.ok) {
            const errData = await msgRes.json();
            throw new Error(errData.error?.message || 'Failed to add message');
        }

        const runRes = await fetch(`https://api.openai.com/v1/threads/${currentThreadId}/runs`, {
            method: 'POST',
            headers,
            body: JSON.stringify({ assistant_id: ASSISTANT_ID })
        });
        if (!runRes.ok) throw new Error('Failed to create run');
        const runData = await runRes.json();
        const runId = runData.id;

        let run;
        let attempts = 0;
        const maxAttempts = 120;
        do {
            await new Promise(r => setTimeout(r, 1000));
            const pollRes = await fetch(`https://api.openai.com/v1/threads/${currentThreadId}/runs/${runId}`, { headers });
            run = await pollRes.json();
            attempts++;
        } while ((run.status === 'queued' || run.status === 'in_progress') && attempts < maxAttempts);

        if (run.status !== 'completed') {
            throw new Error(`Run ended with status: ${run.status}`);
        }

        const messagesRes = await fetch(`https://api.openai.com/v1/threads/${currentThreadId}/messages?limit=1&order=desc`, { headers });
        const messagesData = await messagesRes.json();
        const assistantMessage = messagesData.data[0]?.content[0]?.text?.value || 'No response';

        chatMessages.push({ role: 'assistant', content: assistantMessage });
        renderFullChat();

    } catch (error) {
        console.error('Error:', error);
        const indicator = document.getElementById('typing-indicator');
        if (indicator) indicator.remove();

        chat.innerHTML += `
            <div class="flex flex-col items-start gap-2 max-w-[95%]">
                <div class="chat-bubble-ai bg-severity-critical-bg p-4 shadow-lg border border-severity-critical/30">
                    <p class="text-sm text-severity-critical"><strong>Error:</strong> ${escapeHtml(error.message)}</p>
                    <p class="text-xs text-text-secondary mt-2">Check your API key in Settings.</p>
                </div>
            </div>
        `;
    } finally {
        isLoading = false;
        document.getElementById('intel-send-btn').disabled = false;
        document.getElementById('intel-status-text').textContent = 'Strategic Advisor';
        chat.scrollTop = chat.scrollHeight;
    }
}

function sendSuggestedPrompt(prompt) {
    document.getElementById('intel-input').value = prompt;
    sendMessage();
}

function clearChat() {
    chatMessages = [];
    currentThreadId = null;
    renderFullChat();
}

function handleInputKeydown(event) {
    if (event.key === 'Enter' && !event.shiftKey) {
        event.preventDefault();
        sendMessage();
    }
}

// ==================== FILE HANDLING ====================
function handleFileSelect(event) {
    const file = event.target.files[0];
    if (!file) return;

    if (file.size > 20 * 1024 * 1024) {
        alert('File too large. Maximum size is 20MB.');
        event.target.value = '';
        return;
    }

    attachedFile = { file: file, id: null };
    document.getElementById('file-preview').classList.remove('hidden');
    document.getElementById('file-name').textContent = file.name;
    document.getElementById('file-size').textContent = formatFileSize(file.size);
}

function removeAttachedFile() {
    attachedFile = null;
    const fileInput = document.getElementById('file-input');
    const filePreview = document.getElementById('file-preview');
    if (fileInput) fileInput.value = '';
    if (filePreview) filePreview.classList.add('hidden');
}

async function uploadFileToOpenAI(file) {
    const formData = new FormData();
    formData.append('file', file);
    formData.append('purpose', 'assistants');

    const response = await fetch('https://api.openai.com/v1/files', {
        method: 'POST',
        headers: {
            'Authorization': `Bearer ${getApiKey()}`
        },
        body: formData
    });

    if (!response.ok) {
        const error = await response.json();
        throw new Error(error.error?.message || 'File upload failed');
    }

    const data = await response.json();
    return data.id;
}


// ========== app.js ==========
// ==================== AXIA DEMO V6.7 - APP STATE ====================
// V6.7: Text-only sidebar nav, improved Risk Score & MTTR time progression
// V6.6: Command totals, Dashboard reorder with export, AXIA Actions numbers, consistent number+timeline
// V6.5: Insight Cube logo integration
// V6.4: Scrollable dashboard, 10 widgets with Departments, dramatic MTTR storytelling (4.2h->1.1h)
// V6.3: Draggable widgets, Before/After value proof, consistent time picker, prioritized layout
// V6.2: New Value Dashboard with 3x3 grid of fixed widgets (Risk, Volume, Effectiveness)
let currentScreen = 'posture';
let previousScreen = 'posture';
let currentCaseId = null;
let tourStep = 0;
let tourActive = false;
let activeFilters = { severity: [], status: [], actions: [], dlp: [] };
let currentTimeframe = '1d'; // V5.4: Default to 1 day for Command/Cases
let dashboardTimeframe = '7d'; // V6.20: Dashboard defaults to 7d; 1d restored for tactical view
let dashboardEditMode = false; // V6.3: Draggable widget edit mode

// V5.5: Configurable case action options - synced from DEMO_DATA
let caseActionOptions = null; // Initialized from DEMO_DATA on load

// ==================== V6.6: WIDGET EXPORT FUNCTIONALITY ====================
function renderExportButton(widgetName) {
    return `
        <div class="relative export-dropdown">
            <button onclick="toggleExportMenu(event, '${widgetName}')" class="w-6 h-6 flex items-center justify-center rounded hover:bg-surface-hover transition-colors text-text-secondary hover:text-text-primary" title="Export data">
                <span class="material-symbols-outlined text-[14px]">download</span>
            </button>
            <div id="export-menu-${widgetName}" class="hidden absolute right-0 top-6 z-50 bg-white rounded-lg shadow-lg border border-border-default py-1 min-w-[100px]">
                <button onclick="handleExport('${widgetName}', 'excel')" class="w-full px-3 py-1.5 text-left text-xs hover:bg-surface-hover flex items-center gap-2">
                    <span class="material-symbols-outlined text-[14px] text-green-600">table</span> Excel
                </button>
                <button onclick="handleExport('${widgetName}', 'csv')" class="w-full px-3 py-1.5 text-left text-xs hover:bg-surface-hover flex items-center gap-2">
                    <span class="material-symbols-outlined text-[14px] text-blue-600">csv</span> CSV
                </button>
                <button onclick="handleExport('${widgetName}', 'pdf')" class="w-full px-3 py-1.5 text-left text-xs hover:bg-surface-hover flex items-center gap-2">
                    <span class="material-symbols-outlined text-[14px] text-red-600">picture_as_pdf</span> PDF
                </button>
            </div>
        </div>
    `;
}

function toggleExportMenu(event, widgetName) {
    event.stopPropagation();
    // Close all other menus first
    document.querySelectorAll('[id^="export-menu-"]').forEach(menu => {
        if (menu.id !== `export-menu-${widgetName}`) menu.classList.add('hidden');
    });
    const menu = document.getElementById(`export-menu-${widgetName}`);
    if (menu) menu.classList.toggle('hidden');
}

function handleExport(widgetName, format) {
    // Demo: Show toast notification
    showToast(`Exporting ${widgetName.replace(/-/g, ' ')} as ${format.toUpperCase()}...`, 'info');
    // Close menu
    document.querySelectorAll('[id^="export-menu-"]').forEach(menu => menu.classList.add('hidden'));
    // Simulate export delay
    setTimeout(() => {
        showToast(`${widgetName.replace(/-/g, ' ')} exported successfully!`, 'success');
    }, 800);
}

// Close export menus when clicking outside
document.addEventListener('click', () => {
    document.querySelectorAll('[id^="export-menu-"]').forEach(menu => menu.classList.add('hidden'));
});

// ==================== NAVIGATION ====================
function navigateTo(screen) {
    previousScreen = currentScreen;
    currentScreen = screen;

    document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
    document.getElementById(`screen-${screen}`).classList.add('active');

    // V6.0: Update sidebar navigation buttons
    document.querySelectorAll('.sidebar-nav-btn').forEach(btn => {
        const isActive = btn.dataset.screen === screen;
        btn.classList.toggle('active', isActive);
        const icon = btn.querySelector('.material-symbols-outlined');
        if (icon) icon.style.fontVariationSettings = isActive ? "'FILL' 1" : "'FILL' 0";
        const label = btn.querySelector('.sidebar-nav-label');
        if (label) {
            label.classList.toggle('font-bold', isActive);
            label.classList.toggle('font-medium', !isActive);
        }
    });

    if (screen === 'cases') renderCaseList();
    if (screen === 'posture') { renderSecurityPosture(); }
    if (screen === 'dashboard') { renderSeverityCards(); updateAccordionHeaders(); renderDashboardCases(); }
    if (screen === 'dashboard-view') renderDashboardViewScreen();
    if (screen === 'connections') renderConnectionsScreen();
    // V6.20: Render Connect screen
    if (screen === 'connect') renderConnectScreen();
    // V6.12: Render Settings section
    if (screen === 'settings') { renderActionToggles(); }
    closeAllFilters();
}

function goBack() {
    if (currentScreen === 'case-details') {
        navigateTo(previousScreen === 'case-details' ? 'cases' : previousScreen);
    }
}

function viewCase(caseId) {
    currentCaseId = caseId;
    previousScreen = currentScreen;
    navigateTo('case-details');
    renderCaseDetails(caseId);
}

function drillDownUser(userName) {
    navigateTo('intel');
    const query = `Show me the full activity history for ${userName}`;
    const input = document.getElementById('intel-input');
    if (input) {
        input.value = query;
        input.focus();
    }
}

// ==================== FILTER FUNCTIONS ====================
function toggleFilter(filterName) {
    const dropdown = document.getElementById(`${filterName}-dropdown`);
    const button = dropdown.previousElementSibling;
    const isOpen = dropdown.classList.contains('open');
    closeAllFilters();
    if (!isOpen) {
        const rect = button.getBoundingClientRect();
        dropdown.style.top = (rect.bottom + 4) + 'px';
        dropdown.style.left = rect.left + 'px';
        dropdown.classList.add('open');
    }
}

function closeAllFilters() {
    document.querySelectorAll('.filter-dropdown').forEach(d => d.classList.remove('open'));
}

function updateFilters() {
    ['severity', 'status', 'actions', 'dlp'].forEach(filterType => {
        const dropdown = document.getElementById(`${filterType}-dropdown`);
        const checked = dropdown.querySelectorAll('input:checked');
        activeFilters[filterType] = Array.from(checked).map(c => c.value);

        const badge = document.getElementById(`${filterType}-badge`);
        const btn = dropdown.previousElementSibling;
        if (checked.length > 0) {
            badge.textContent = checked.length;
            badge.classList.remove('hidden');
            btn.classList.add('filter-active');
        } else {
            badge.classList.add('hidden');
            btn.classList.remove('filter-active');
        }
    });

    renderActiveFilterTags();
    renderCaseList();
}

function renderActiveFilterTags() {
    const container = document.getElementById('active-filters');
    const tags = [];

    if (activeFilters.severity.length) {
        activeFilters.severity.forEach(s => {
            const colors = { critical: 'severity-critical', high: 'severity-high', medium: 'severity-medium', low: 'severity-low' };
            tags.push(`<span class="inline-flex items-center gap-1 px-2 py-1 rounded-lg text-[11px] font-medium bg-${colors[s]}-bg text-${colors[s]} border border-${colors[s]}/30">${s.charAt(0).toUpperCase() + s.slice(1)}<button onclick="removeFilter('severity','${s}')" class="ml-1 hover:text-text-primary"><span class="material-symbols-outlined text-[14px]">close</span></button></span>`);
        });
    }
    if (activeFilters.status.length) {
        activeFilters.status.forEach(s => {
            tags.push(`<span class="inline-flex items-center gap-1 px-2 py-1 rounded-lg text-[11px] font-medium bg-surface-hover text-text-primary border border-border-default">${s.charAt(0).toUpperCase() + s.slice(1)}<button onclick="removeFilter('status','${s}')" class="ml-1 hover:text-text-primary"><span class="material-symbols-outlined text-[14px]">close</span></button></span>`);
        });
    }

    if (tags.length > 0) {
        container.innerHTML = tags.join('');
        container.classList.remove('hidden');
    } else {
        container.classList.add('hidden');
    }
}

function removeFilter(type, value) {
    const dropdown = document.getElementById(`${type}-dropdown`);
    const checkbox = dropdown.querySelector(`input[value="${value}"]`);
    if (checkbox) checkbox.checked = false;
    updateFilters();
}

function clearFilters() {
    document.querySelectorAll('.filter-dropdown input').forEach(c => c.checked = false);
    updateFilters();
}

// ==================== RENDER FUNCTIONS ====================
function renderCaseCard(c, compact = false) {
    const severityColors = { critical: 'severity-critical', high: 'severity-high', medium: 'severity-medium', low: 'severity-low' };
    const severityIcons = { critical: 'error', high: 'warning', medium: 'info', low: 'check_circle' };
    const color = severityColors[c.severity];
    const icon = severityIcons[c.severity];
    const isOpen = c.status === 'open';

    return `
        <div class="flex items-start gap-3 p-4 ${compact ? 'border-b border-border-default' : 'bg-surface-card rounded-lg border border-border-default shadow-card'} hover:bg-surface-hover/50 transition-colors cursor-pointer relative ${!isOpen ? 'opacity-75 hover:opacity-100' : ''}" onclick="viewCase('${c.id}')">
            ${isOpen ? `<div class="absolute left-0 top-0 bottom-0 w-1 bg-${color} rounded-l-lg"></div>` : ''}
            <div class="shrink-0">
                <div class="w-10 h-10 rounded-lg border-2 border-${color}${isOpen ? '' : '/60'} bg-${color}-bg flex items-center justify-center">
                    <span class="text-xs font-bold text-${color}">${c.score}</span>
                </div>
            </div>
            <div class="flex flex-col flex-1 gap-1 min-w-0">
                <div class="flex justify-between items-start">
                    <h3 class="text-sm font-bold text-text-primary truncate pr-2">${c.title}</h3>
                    <span class="text-[11px] font-medium text-text-secondary shrink-0">${c.time}</span>
                </div>
                <p class="text-sm text-text-secondary leading-relaxed line-clamp-2">${c.description}</p>
                <div class="flex items-center gap-2 pt-2 mt-2 border-t border-border-default">
                    <div class="w-6 h-6 rounded-full bg-surface-hover flex items-center justify-center text-[10px] font-bold text-text-primary">${c.entity.initials}</div>
                    <span class="text-xs font-medium text-text-primary cursor-pointer hover:text-primary" onclick="event.stopPropagation(); drillDownUser('${c.entity.name}')">${c.entity.name}</span>
                    <span class="text-[11px] text-text-secondary">${c.entity.role}</span>
                </div>
                <div class="flex items-center gap-2 mt-2 flex-wrap">
                    ${isOpen ? `<span class="inline-flex items-center gap-1 px-2.5 py-1 rounded text-[11px] font-bold bg-status-success/10 text-status-success border border-status-success/20 min-h-[28px]"><span class="w-1.5 h-1.5 rounded-full bg-status-success animate-pulse"></span>Open</span>` : `<span class="inline-flex items-center gap-1 px-2.5 py-1 rounded text-[11px] font-medium bg-surface-hover text-text-secondary border border-border-default min-h-[28px]"><span class="material-symbols-outlined text-[14px]">check_circle</span>Closed</span>`}
                    ${c.actions.map(a => `<span class="inline-flex items-center gap-1 px-2.5 py-1 rounded text-[11px] font-bold bg-primary/10 text-primary border border-primary/30 min-h-[28px]">${a}</span>`).join('')}
                    ${c.dlpAlerted ? `<span class="inline-flex items-center gap-1 px-2.5 py-1 rounded text-[11px] font-medium bg-surface-hover text-text-secondary border border-border-default min-h-[28px]"><span class="material-symbols-outlined text-[14px]">shield</span>${c.dlpSystem || 'DLP'}</span>` : ''}
                </div>
            </div>
        </div>
    `;
}

// ==================== V5.15: SEVERITY CARDS BY TIMEFRAME (V5.13 STYLE) ====================
function renderSeverityCards() {
    const severityData = DEMO_DATA.severityByTimeframe?.[currentTimeframe] || DEMO_DATA.severityByTimeframe?.['30d'] || {};
    const container = document.getElementById('severity-cards');
    if (!container) return;

    const severities = [
        { key: 'critical', label: 'Critical', icon: 'error', color: 'severity-critical' },
        { key: 'high', label: 'High', icon: 'warning', color: 'severity-high' },
        { key: 'medium', label: 'Medium', icon: 'info', color: 'severity-medium' },
        { key: 'low', label: 'Low', icon: 'check_circle', color: 'severity-low' }
    ];

    // Calculate total for percentage bars (open cases as percentage of all open)
    const totalOpen = Object.values(severityData).reduce((sum, s) => sum + (s.open || 0), 0) || 1;

    container.innerHTML = severities.map(sev => {
        const data = severityData[sev.key] || { open: 0, dlpAlerted: 0, total: 0 };
        const closed = data.total - data.open;
        const openPercentage = Math.round((data.open / totalOpen) * 100);
        return `
            <div class="severity-card bg-surface-card p-3 rounded-lg border border-border-default relative overflow-hidden group hover:border-${sev.color}/30 transition-colors cursor-pointer card-shadow" data-severity="${sev.key}" onclick="filterBySeverity('${sev.key}')">
                <div class="flex justify-between items-start mb-1.5">
                    <div class="flex items-center gap-1">
                        <span class="material-symbols-outlined text-${sev.color} text-[19px]">${sev.icon}</span>
                        <p class="text-[14px] font-bold text-${sev.color} uppercase tracking-wider">${sev.label}</p>
                    </div>
                    <span class="text-2xl font-bold text-text-primary tracking-tight leading-none">${data.total}</span>
                </div>
                <div class="text-[14px] font-medium text-text-secondary leading-tight">
                    <span class="text-text-primary font-bold">Open: ${data.open}</span> · Closed: ${closed}
                </div>
                <div class="text-[14px] text-text-secondary flex items-center gap-1 mt-0.5">
                    <span class="material-symbols-outlined text-[15px] text-status-blocked">shield</span>
                    <span>DLP: <span class="text-text-primary font-bold">${data.dlpAlerted}</span></span>
                </div>
                <div class="h-1 w-full bg-surface-hover mt-2 rounded-full overflow-hidden">
                    <div class="h-full bg-${sev.color} w-[${openPercentage}%] rounded-full"></div>
                </div>
            </div>
        `;
    }).join('');
}

// V6.0: Posture screen severity cards (same data as Command, for alignment)
function renderPostureSeverityCards() {
    const severityData = DEMO_DATA.severityByTimeframe?.[currentTimeframe] || DEMO_DATA.severityByTimeframe?.['30d'] || {};
    const container = document.getElementById('posture-severity-cards');
    if (!container) return;

    const severities = [
        { key: 'critical', label: 'Critical', icon: 'error', color: 'severity-critical' },
        { key: 'high', label: 'High', icon: 'warning', color: 'severity-high' },
        { key: 'medium', label: 'Medium', icon: 'info', color: 'severity-medium' },
        { key: 'low', label: 'Low', icon: 'check_circle', color: 'severity-low' }
    ];

    // Calculate total for percentage bars (open cases as percentage of all open)
    const totalOpen = Object.values(severityData).reduce((sum, s) => sum + (s.open || 0), 0) || 1;

    container.innerHTML = severities.map(sev => {
        const data = severityData[sev.key] || { open: 0, dlpAlerted: 0, total: 0 };
        const closed = data.total - data.open;
        const openPercentage = Math.round((data.open / totalOpen) * 100);
        return `
            <div class="severity-card bg-surface-card p-3 rounded-lg border border-border-default relative overflow-hidden group hover:border-${sev.color}/30 transition-colors cursor-pointer card-shadow" data-severity="${sev.key}" onclick="navigateTo('dashboard'); filterBySeverity('${sev.key}');">
                <div class="flex justify-between items-start mb-1.5">
                    <div class="flex items-center gap-1">
                        <span class="material-symbols-outlined text-${sev.color} text-[19px]">${sev.icon}</span>
                        <p class="text-[14px] font-bold text-${sev.color} uppercase tracking-wider">${sev.label}</p>
                    </div>
                    <span class="text-2xl font-bold text-text-primary tracking-tight leading-none">${data.total}</span>
                </div>
                <div class="text-[14px] font-medium text-text-secondary leading-tight">
                    <span class="text-text-primary font-bold">Open: ${data.open}</span> · Closed: ${closed}
                </div>
                <div class="text-[14px] text-text-secondary flex items-center gap-1 mt-0.5">
                    <span class="material-symbols-outlined text-[15px] text-status-blocked">shield</span>
                    <span>DLP: <span class="text-text-primary font-bold">${data.dlpAlerted}</span></span>
                </div>
                <div class="h-1 w-full bg-surface-hover mt-2 rounded-full overflow-hidden">
                    <div class="h-full bg-${sev.color} w-[${openPercentage}%] rounded-full"></div>
                </div>
            </div>
        `;
    }).join('');
}

// V5.15: Update accordion headers with dynamic counts
function updateAccordionHeaders() {
    const severityData = DEMO_DATA.severityByTimeframe?.[currentTimeframe] || DEMO_DATA.severityByTimeframe?.['30d'] || {};

    const severities = ['critical', 'high', 'medium', 'low'];
    const accordion = document.getElementById('critical-accordion');
    if (!accordion) return;

    const details = accordion.querySelectorAll('details');
    details.forEach((detail, index) => {
        const sev = severities[index];
        const data = severityData[sev] || { open: 0, dlpAlerted: 0, total: 0 };
        const closed = data.total - data.open;

        // Update the title count
        const titleSpan = detail.querySelector('summary .text-base.font-bold');
        if (titleSpan) {
            const label = sev.charAt(0).toUpperCase() + sev.slice(1);
            titleSpan.textContent = `${label} (${data.total})`;
        }

        // Update the subtitle counts
        const subtitleDiv = detail.querySelector('summary .text-\\[14px\\].font-medium');
        if (subtitleDiv) {
            subtitleDiv.textContent = `Open: ${data.open} · Closed: ${closed} · DLP Alerted: ${data.dlpAlerted}`;
        }
    });
}

function renderDashboardCases() {
    // V5.15: Filter cases by timeframe
    // V6.9: Also filter to show only OPEN cases (hide closed from operational list)
    const caseIds = DEMO_DATA.casesByTimeframe?.[currentTimeframe] || [];
    const timeframeCases = caseIds.length > 0
        ? casesData.filter(c => caseIds.includes(c.id))
        : casesData;

    // V6.9: Only show open cases in the operational Command screen
    const openCases = timeframeCases.filter(c => c.status === 'open');

    const criticalCases = openCases.filter(c => c.severity === 'critical').sort((a, b) => b.score - a.score).slice(0, 4);
    const highCases = openCases.filter(c => c.severity === 'high').sort((a, b) => b.score - a.score).slice(0, 3);
    const mediumCases = openCases.filter(c => c.severity === 'medium').slice(0, 3);
    const lowCases = openCases.filter(c => c.severity === 'low').slice(0, 2);

    document.getElementById('critical-cases-list').innerHTML = criticalCases.map(c => renderCaseCard(c, true)).join('') + `
        <div class="p-3 flex justify-center border-t border-border-default bg-surface-card/50">
            <button onclick="filterBySeverity('critical')" class="text-xs font-bold text-primary hover:text-primary-hover transition-colors px-4 py-2 rounded-lg hover:bg-surface-hover w-full flex items-center justify-center gap-2">
                <span>View all critical cases</span>
                <span class="material-symbols-outlined text-[16px]">arrow_forward</span>
            </button>
        </div>
    `;

    document.getElementById('high-cases-list').innerHTML = highCases.map(c => renderCaseCard(c, true)).join('') + `
        <div class="p-3 flex justify-center border-t border-border-default bg-surface-card/50">
            <button onclick="filterBySeverity('high')" class="text-xs font-bold text-primary hover:text-primary-hover transition-colors px-4 py-2 rounded-lg hover:bg-surface-hover w-full flex items-center justify-center gap-2">
                <span>View all high cases</span>
                <span class="material-symbols-outlined text-[16px]">arrow_forward</span>
            </button>
        </div>
    `;

    document.getElementById('medium-cases-list').innerHTML = mediumCases.map(c => renderCaseCard(c, true)).join('') + `
        <div class="p-3 flex justify-center border-t border-border-default bg-surface-card/50">
            <button onclick="filterBySeverity('medium')" class="text-xs font-bold text-primary hover:text-primary-hover transition-colors px-4 py-2 rounded-lg hover:bg-surface-hover w-full flex items-center justify-center gap-2">
                <span>View all medium cases</span>
                <span class="material-symbols-outlined text-[16px]">arrow_forward</span>
            </button>
        </div>
    `;

    document.getElementById('low-cases-list').innerHTML = lowCases.map(c => renderCaseCard(c, true)).join('') + `
        <div class="p-3 flex justify-center border-t border-border-default bg-surface-card/50">
            <button onclick="filterBySeverity('low')" class="text-xs font-bold text-primary hover:text-primary-hover transition-colors px-4 py-2 rounded-lg hover:bg-surface-hover w-full flex items-center justify-center gap-2">
                <span>View all low cases</span>
                <span class="material-symbols-outlined text-[16px]">arrow_forward</span>
            </button>
        </div>
    `;
}

function renderCaseList() {
    let filtered = casesData;

    if (activeFilters.severity.length) filtered = filtered.filter(c => activeFilters.severity.includes(c.severity));
    if (activeFilters.status.length) filtered = filtered.filter(c => activeFilters.status.includes(c.status));
    if (activeFilters.dlp.length) {
        filtered = filtered.filter(c => {
            if (activeFilters.dlp.includes('alerted') && c.dlpAlerted) return true;
            if (activeFilters.dlp.includes('not-alerted') && !c.dlpAlerted) return true;
            return false;
        });
    }

    const list = document.getElementById('case-list');
    list.innerHTML = filtered.map(c => renderCaseCard(c)).join('');

    const open = filtered.filter(c => c.status === 'open').length;
    const closed = filtered.filter(c => c.status === 'closed').length;
    document.getElementById('stats-open').textContent = open;
    document.getElementById('stats-closed').textContent = closed;
    document.getElementById('stats-showing').textContent = filtered.length;
}

function renderCaseDetails(caseId) {
    const c = casesData.find(c => c.id === caseId);
    if (!c) return;

    document.getElementById('detail-case-id').textContent = c.id;
    document.getElementById('detail-title').textContent = c.title;

    const severityColors = { critical: 'severity-critical', high: 'severity-high', medium: 'severity-medium', low: 'severity-low' };
    const color = severityColors[c.severity];
    const isOpen = c.status === 'open';
    const isClosed = c.status === 'closed';

    // V6.11: Redesigned case details with cleaner, more compact layout
    document.getElementById('case-detail-content').innerHTML = `
        <!-- V6.11: Compact header with status, severity, and entity -->
        <div class="bg-surface-card rounded-xl border border-border-default p-4 shadow-card">
            <div class="flex items-start gap-4">
                <!-- Entity avatar -->
                <div class="w-14 h-14 rounded-full bg-gradient-to-br from-primary/20 to-primary/5 flex items-center justify-center text-lg font-bold text-primary border-2 border-primary/30">${c.entity.initials}</div>
                <!-- Entity info + badges -->
                <div class="flex-1 min-w-0">
                    <div class="flex items-center gap-2 flex-wrap mb-1">
                        <h3 class="text-lg font-bold text-text-primary">${c.entity.name}</h3>
                        <!-- Status badge -->
                        <span class="inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-xs font-bold ${isOpen ? 'bg-status-success/20 text-status-success' : 'bg-surface-hover text-text-muted'}">
                            ${isOpen ? '<span class="w-1.5 h-1.5 rounded-full bg-status-success animate-pulse"></span>' : ''}
                            ${isOpen ? 'Open' : 'Closed'}
                        </span>
                        <!-- Severity badge -->
                        <span class="inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-xs font-bold bg-${color}/20 text-${color}">
                            <span class="material-symbols-outlined text-[12px]">${c.severity === 'critical' ? 'error' : c.severity === 'high' ? 'warning' : 'info'}</span>
                            ${c.severity.charAt(0).toUpperCase() + c.severity.slice(1)}
                        </span>
                        ${c.dlpAlerted ? `<span class="inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-xs font-medium bg-surface-hover text-text-secondary border border-border-default"><span class="material-symbols-outlined text-[12px]">shield</span>${c.dlpSystem || 'DLP'}</span>` : ''}
                    </div>
                    <p class="text-sm text-text-secondary">${c.entity.role}</p>
                    <p class="text-xs text-text-muted">${c.entity.department} · ${c.entity.location}</p>
                </div>
            </div>
        </div>

        <!-- V6.11: AI Analysis - More compact cards -->
        <div class="bg-surface-card rounded-xl border border-border-default overflow-hidden shadow-card">
            <div class="px-4 py-3 bg-surface-elevated border-b border-border-default flex items-center gap-2">
                <span class="material-symbols-outlined text-primary text-lg">psychology</span>
                <span class="font-bold text-text-primary">AI Analysis</span>
            </div>
            <div class="divide-y divide-border-subtle">
                <div class="p-4 flex gap-3">
                    <span class="material-symbols-outlined text-text-secondary text-lg shrink-0">visibility</span>
                    <div>
                        <p class="text-xs font-bold uppercase text-text-muted tracking-wider mb-1">What</p>
                        <p class="text-sm text-text-primary leading-relaxed">${c.analysis.what}</p>
                    </div>
                </div>
                <div class="p-4 flex gap-3">
                    <span class="material-symbols-outlined text-severity-high text-lg shrink-0">warning</span>
                    <div>
                        <p class="text-xs font-bold uppercase text-text-muted tracking-wider mb-1">Why It Matters</p>
                        <p class="text-sm text-text-primary leading-relaxed">${c.analysis.whyMatters}</p>
                    </div>
                </div>
                <div class="p-4 flex gap-3">
                    <span class="material-symbols-outlined text-text-secondary text-lg shrink-0">trending_up</span>
                    <div>
                        <p class="text-xs font-bold uppercase text-text-muted tracking-wider mb-1">Why Unusual</p>
                        <p class="text-sm text-text-primary leading-relaxed">${c.analysis.whyUnusual}</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- V6.11: Source Content - Collapsible -->
        <details class="group bg-surface-card rounded-xl border border-border-default overflow-hidden shadow-card">
            <summary class="flex items-center justify-between px-4 py-3 cursor-pointer select-none hover:bg-surface-hover transition-colors">
                <div class="flex items-center gap-3">
                    <span class="material-symbols-outlined text-severity-high">mail</span>
                    <div>
                        <span class="text-sm font-bold text-text-primary">Source: Email</span>
                        <span class="text-xs text-text-muted ml-2">${c.time}</span>
                    </div>
                </div>
                <span class="material-symbols-outlined text-text-secondary transition-transform duration-300 group-open:rotate-180">expand_more</span>
            </summary>
            <div class="border-t border-border-default bg-surface-elevated p-4 space-y-3">
                <div class="grid grid-cols-[60px_1fr] gap-y-1.5 text-sm">
                    <span class="text-text-muted">From:</span>
                    <span class="text-text-primary">${c.entity.name}</span>
                    <span class="text-text-muted">To:</span>
                    <span class="text-text-primary">external-contact@external-domain.com</span>
                    <span class="text-text-muted">Subject:</span>
                    <span class="text-text-primary">${c.title}</span>
                </div>
                <div class="flex items-center gap-3 p-3 bg-surface-card rounded-lg border ${c.dlpAlerted ? 'border-status-blocked/30' : 'border-border-subtle'} cursor-pointer hover:bg-surface-hover/50 transition-colors" ondblclick="openDocViewer('${c.id}')" title="Double-click to preview document">
                    <span class="material-symbols-outlined ${c.dlpAlerted ? 'text-status-blocked' : 'text-text-secondary'}">attachment</span>
                    <div class="flex-1 min-w-0">
                        <span class="text-sm font-medium text-text-primary">${documentContent[c.id] ? documentContent[c.id].filename : 'confidential_document.zip'}</span>
                        <span class="text-xs text-text-muted ml-2">2.4 MB</span>
                    </div>
                    <span class="text-[10px] text-text-muted flex items-center gap-1"><span class="material-symbols-outlined text-[12px]">mouse</span>Double-click to preview</span>
                    ${c.dlpAlerted ? '<span class="text-[10px] font-bold text-status-blocked bg-status-blocked/20 px-1.5 py-0.5 rounded">BLOCKED</span>' : ''}
                </div>
            </div>
        </details>

        ${isOpen ? `
        <!-- V6.11: Actions Panel - Redesigned with grid layout -->
        <div class="bg-surface-card rounded-xl border border-border-default overflow-hidden shadow-card">
            <div class="px-4 py-3 bg-surface-elevated border-b border-border-default flex items-center justify-between">
                <div class="flex items-center gap-2">
                    <span class="material-symbols-outlined text-primary text-lg">checklist</span>
                    <span class="font-bold text-text-primary">Actions</span>
                </div>
                <span class="text-xs text-text-muted"><span id="selected-action-count" class="font-bold text-primary">0</span> selected</span>
            </div>

            <!-- V6.12: Engagement Actions - Show ALL options, crossed out if already used -->
            <div class="p-3">
                <div class="text-xs font-bold text-ops-teal uppercase tracking-wider mb-2 flex items-center gap-1.5">
                    <span class="material-symbols-outlined text-sm">forum</span>
                    Engagement
                </div>
                <div class="grid grid-cols-2 gap-2">
                    ${caseActionOptions.filter(a => a.category === 'engagement' || a.category === 'escalation').map(action => {
                        const isCompleted = c.completedActions?.includes(action.id);
                        return `
                        <label class="flex items-center gap-2 p-2.5 rounded-lg border ${isCompleted ? 'border-status-success/30 bg-status-success/5' : 'border-border-subtle hover:border-ops-teal/50 hover:bg-ops-teal/5 cursor-pointer'} transition-all">
                            <input class="custom-checkbox h-4 w-4 rounded border-border-strong bg-surface-dark text-ops-teal focus:ring-ops-teal case-action-check" type="checkbox" data-action="${action.id}" ${isCompleted ? 'checked disabled' : ''}/>
                            <span class="material-symbols-outlined ${isCompleted ? 'text-status-success' : 'text-ops-teal'} text-base">${isCompleted ? 'check_circle' : action.icon}</span>
                            <span class="text-sm ${isCompleted ? 'text-text-muted line-through' : 'text-text-primary'}">${action.label}</span>
                        </label>`;
                    }).join('')}
                </div>
            </div>

            <!-- Divider -->
            <div class="border-t border-border-subtle mx-3"></div>

            <!-- V6.12: Enforcement Actions - Show ALL 3 options, only ONE enabled per case -->
            <div class="p-3">
                <div class="text-xs font-bold text-status-blocked uppercase tracking-wider mb-2 flex items-center gap-1.5">
                    <span class="material-symbols-outlined text-sm">security</span>
                    Enforcement
                </div>
                <div class="grid grid-cols-3 gap-2">
                    ${(() => {
                        // V6.12: Each case has an enforcementType that determines which option is enabled
                        const caseEnforcementType = c.enforcementType || null;
                        const enforcementReason = c.enforcementReason || 'Not applicable for this case';

                        return caseActionOptions.filter(a => a.category === 'enforcement').map(action => {
                            const isCompleted = c.completedActions?.includes(action.id);
                            const isEnabled = caseEnforcementType === action.id;
                            const isDisabled = !isEnabled && !isCompleted;

                            // Generate tooltip text for disabled options
                            let tooltipText = '';
                            if (isDisabled) {
                                // If case has no enforcement type at all (canEnforce: false cases)
                                if (!caseEnforcementType) {
                                    tooltipText = c.canEnforce === false
                                        ? 'Case is closed or resolved - no enforcement needed'
                                        : 'No enforcement action available for this case';
                                } else if (action.id === 'create-dlp-rule') {
                                    tooltipText = caseEnforcementType === 'adjust-dlp-rule'
                                        ? 'DLP rule already exists for this pattern'
                                        : caseEnforcementType === 'activate-smart-block'
                                        ? 'Pattern requires contextual understanding beyond DLP'
                                        : 'Not recommended for this case';
                                } else if (action.id === 'adjust-dlp-rule') {
                                    tooltipText = caseEnforcementType === 'create-dlp-rule'
                                        ? 'No existing DLP rule to adjust'
                                        : caseEnforcementType === 'activate-smart-block'
                                        ? 'Pattern requires contextual understanding beyond DLP'
                                        : 'Not recommended for this case';
                                } else if (action.id === 'activate-smart-block') {
                                    tooltipText = caseEnforcementType === 'create-dlp-rule' || caseEnforcementType === 'adjust-dlp-rule'
                                        ? 'Simple pattern can be handled by DLP rule'
                                        : 'Not recommended for this case';
                                }
                            }

                            return `
                            <label class="relative flex items-center gap-2 p-2.5 rounded-lg border ${
                                isCompleted
                                    ? 'border-status-success/30 bg-status-success/5'
                                    : isDisabled
                                    ? 'border-border-subtle/50 bg-surface-dark/50 opacity-50 cursor-not-allowed'
                                    : 'border-border-subtle hover:border-status-blocked/50 hover:bg-status-blocked/5 cursor-pointer'
                            } transition-all group" ${isDisabled ? 'title="' + tooltipText + '"' : ''}>
                                <input class="custom-checkbox h-4 w-4 rounded border-border-strong bg-surface-dark text-status-blocked focus:ring-status-blocked case-action-check" type="checkbox" data-action="${action.id}" ${isCompleted ? 'checked disabled' : ''} ${isDisabled ? 'disabled' : ''}/>
                                <span class="material-symbols-outlined ${
                                    isCompleted
                                        ? 'text-status-success'
                                        : isDisabled
                                        ? 'text-text-muted'
                                        : 'text-status-blocked'
                                } text-base">${isCompleted ? 'check_circle' : action.icon}</span>
                                <span class="text-xs ${
                                    isCompleted
                                        ? 'text-text-muted line-through'
                                        : isDisabled
                                        ? 'text-text-muted'
                                        : 'text-text-primary'
                                }">${action.label}</span>
                                ${isDisabled ? `
                                <div class="absolute bottom-full left-1/2 -translate-x-1/2 mb-2 px-2 py-1 bg-surface-elevated rounded text-xs text-text-secondary whitespace-nowrap opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none z-10 shadow-lg border border-border-subtle">
                                    ${tooltipText}
                                </div>` : ''}
                            </label>`;
                        }).join('');
                    })()}
                </div>
            </div>

            <!-- Confirm Button -->
            <div class="p-3 pt-0">
                <button class="w-full flex items-center justify-center gap-2 h-11 px-4 rounded-lg bg-primary text-white shadow-lg shadow-primary/25 hover:bg-primary-hover transition-all font-bold text-sm" onclick="confirmCaseActions()">
                    <span class="material-symbols-outlined">check_circle</span>
                    Confirm Actions
                </button>
            </div>
        </div>
        ` : ''}

        <!-- V6.11: Timeline - More compact -->
        <details class="group bg-surface-card rounded-xl border border-border-default overflow-hidden shadow-card" open>
            <summary class="flex items-center justify-between px-4 py-3 cursor-pointer select-none hover:bg-surface-hover transition-colors">
                <div class="flex items-center gap-2">
                    <span class="material-symbols-outlined text-text-secondary">history</span>
                    <span class="font-bold text-text-primary">Timeline</span>
                </div>
                <span class="material-symbols-outlined text-text-secondary transition-transform duration-300 group-open:rotate-180">expand_more</span>
            </summary>
            <div class="border-t border-border-default p-4">
                <div class="relative pl-4">
                    <div class="absolute left-[7px] top-1 bottom-1 w-px bg-border-default"></div>
                    ${c.timeline.map((t, i) => `
                        <div class="relative flex gap-3 ${i < c.timeline.length - 1 ? 'pb-4' : ''}">
                            <div class="absolute -left-[1px] mt-1 h-4 w-4 rounded-full border-2 border-surface-dark bg-${t.color} z-10"></div>
                            <div class="pl-4">
                                <p class="text-sm font-medium text-text-primary">${t.event}</p>
                                <p class="text-xs text-text-muted">${t.time} · ${t.source}</p>
                            </div>
                        </div>
                    `).join('')}
                </div>
            </div>
        </details>
    `;
}

// Placeholder for old function signature - removed timeline section
function renderCaseDetailsTimeline() {
    // V6.11: Timeline is now integrated into main renderCaseDetails
}

// ==================== CONNECTIONS OVERVIEW (Dashboard) ====================
function renderConnectionsOverview() {
    const container = document.getElementById('connections-badges');
    if (!container) return;

    const connections = connectionsData.filter(c => c.status === 'connected');

    // Alert-generating connections as compact badges
    const alertConnections = connections.filter(c => !c.isContextSource && c.stats.totalAlerts > 0);
    const contextSources = connections.filter(c => c.isContextSource);

    let html = alertConnections.map(conn => `
        <div class="flex items-center gap-1.5 px-2.5 py-1.5 bg-surface-elevated rounded-lg border border-border-subtle cursor-pointer hover:border-primary/30 transition-colors" onclick="navigateTo('connections')">
            <span class="w-1.5 h-1.5 rounded-full bg-status-success"></span>
            <span class="text-xs font-medium text-text-primary">${conn.shortName || conn.name}</span>
            <span class="text-[11px] text-severity-high font-semibold">${conn.stats.totalAlerts}</span>
        </div>
    `).join('');

    // Add context sources as a single badge
    if (contextSources.length > 0) {
        html += `
            <div class="flex items-center gap-1.5 px-2.5 py-1.5 bg-surface-elevated/50 rounded-lg border border-border-subtle">
                <span class="w-1.5 h-1.5 rounded-full bg-accent-teal"></span>
                <span class="text-xs text-text-secondary">+${contextSources.length} context</span>
            </div>
        `;
    }

    container.innerHTML = html;
}

// ==================== V5.9: Helper to get DLP system for a channel ====================
function getDLPForChannel(channelId) {
    // V5.9: Purview covers Microsoft ecosystem, Netskope covers non-Microsoft
    const purviewChannels = ['ms-365', 'ms-purview', 'sharepoint', 'onedrive', 'teams'];
    const netskopeChannels = ['gmail', 'slack', 'dropbox', 'box', 'google-drive'];

    if (purviewChannels.includes(channelId)) return 'Purview';
    if (netskopeChannels.includes(channelId)) return 'Netskope';

    // Default based on connection data
    return 'Purview';
}

// ==================== SECURITY POSTURE WIDGET (V6.9 - Combined Channel+DLP cards) ====================
// V6.9: Redesigned to combine channel and DLP info in one card per channel
// Format: Channel name + Interactions | AXIA Cases (by severity + blocked) | Engagements (Emp/Mgr/Legal/Evid) | DLP info
function renderSecurityPosture() {
    const container = document.getElementById('security-posture');
    if (!container) return;

    const metrics = DEMO_DATA.metricsByTimeframe[currentTimeframe] || DEMO_DATA.metricsByTimeframe['30d'];
    // V5.13: Get timeframe-aware connection stats
    const tfStats = DEMO_DATA.connectionStatsByTimeframe?.[currentTimeframe] || {};

    const channels = connectionsData.filter(c => c.status === 'connected' && c.category === 'channel');

    // V5.13: Calculate totals from timeframe-aware stats
    const totalInteractions = channels.reduce((sum, c) => {
        const connStats = tfStats[c.id] || c.stats;
        return sum + (connStats.interactions || 0);
    }, 0);
    const totalCases = metrics.open + metrics.closed;

    // Engagements: Employee + Manager + Legal (Evidence shown but NOT counted)
    const engagements = metrics.engagementsByType || { employee: 0, manager: 0, legal: 0, evidence: 0 };
    const totalEngagements = engagements.employee + engagements.manager + engagements.legal;

    // V6.10: Redesigned channel+DLP card format
    // - Smart Blocks only for Critical, shown in AXIA section
    // - Removed Policy Adjustments
    // - Slack has no DLP section (AXIA monitors directly via API)
    const renderPostureCard = (conn) => {
        // V5.13: Use timeframe-aware stats if available, otherwise fall back to static stats
        const stats = { ...conn.stats, ...(tfStats[conn.id] || {}) };
        const alerts = stats.alerts || {};
        const blocked = stats.blocked || {};
        const engBreakdown = stats.engagementsBreakdown || { employee: 0, manager: 0, legal: 0, evidence: 0 };

        // V5.9: Single DLP name based on channel mapping
        const dlpName = conn.dlpSystem || getDLPForChannel(conn.id);

        // Calculate total engagements for this channel
        const channelEngagements = engBreakdown.employee + engBreakdown.manager + engBreakdown.legal;

        // V6.10: Check if this is Slack (monitored directly, no DLP intermediary)
        const isSlack = conn.id === 'slack' || conn.name?.toLowerCase().includes('slack');

        // V6.11: Increased font sizes throughout for better readability
        return `
        <div class="bg-surface-elevated rounded-xl p-4 sm:p-5 border border-border-subtle">
            <!-- Header: Channel name + status -->
            <div class="flex items-center gap-2 mb-3">
                <span class="w-2.5 h-2.5 rounded-full bg-status-success"></span>
                <span class="text-base sm:text-lg font-bold text-text-primary">${conn.shortName || conn.name}</span>
                <span class="text-xs text-text-muted ml-auto">${(stats.interactions || 0).toLocaleString()} interactions</span>
            </div>

            <!-- Section 1: AXIA Cases by severity - V6.11: Larger fonts -->
            <div class="text-xs font-bold text-primary uppercase tracking-wider mb-1.5">AXIA Cases</div>
            <div class="flex flex-wrap gap-x-3 gap-y-1 text-sm mb-3">
                <span>
                    <span class="text-text-secondary">Crit:</span>
                    <span class="font-bold text-severity-critical">${alerts.critical || 0}</span>
                    ${(blocked.critical || 0) > 0 ? `<span class="text-status-blocked text-xs ml-1">(${blocked.critical} Smart Blocks)</span>` : ''}
                </span>
                <span><span class="text-text-secondary">High:</span> <span class="font-bold text-severity-high">${alerts.high || 0}</span></span>
                <span><span class="text-text-secondary">Med:</span> <span class="font-bold text-severity-medium">${alerts.medium || 0}</span></span>
                <span><span class="text-text-secondary">Low:</span> <span class="font-bold text-severity-low">${alerts.low || 0}</span></span>
            </div>

            <!-- Section 2: Engagements breakdown -->
            <div class="text-xs font-bold text-ops-teal uppercase tracking-wider mb-1.5">Engagements <span class="text-text-primary">(${channelEngagements})</span></div>
            <div class="flex flex-wrap gap-x-3 gap-y-1 text-sm ${isSlack ? '' : 'mb-3'}">
                <span><span class="text-text-secondary">Emp:</span> <span class="font-bold">${engBreakdown.employee}</span></span>
                <span><span class="text-text-secondary">Mgr:</span> <span class="font-bold">${engBreakdown.manager}</span></span>
                <span><span class="text-text-secondary">Legal:</span> <span class="font-bold">${engBreakdown.legal}</span></span>
                <span><span class="text-text-secondary">Evid:</span> <span class="font-bold">${engBreakdown.evidence}</span></span>
            </div>

            ${!isSlack ? `
            <!-- Section 3: DLP Info -->
            <div class="pt-2.5 mt-2.5 border-t border-border-subtle">
                <div class="text-xs font-bold text-purple-500 uppercase tracking-wider mb-1.5">${dlpName}</div>
                <div class="flex flex-wrap gap-x-4 gap-y-1 text-sm">
                    <span><span class="text-text-secondary">DLP Alerts:</span> <span class="font-bold">${stats.dlpAlerts || 0}</span></span>
                    <span><span class="text-text-secondary">False Positives:</span> <span class="font-bold">${stats.falsePositives || 0}</span></span>
                </div>
            </div>
            ` : `
            <!-- V6.10: Slack - AXIA monitors directly via API -->
            <div class="pt-2.5 mt-2.5 border-t border-border-subtle">
                <div class="text-sm text-text-muted italic">Direct API monitoring</div>
            </div>
            `}
        </div>
        `;
    };

    container.innerHTML = `
        <!-- V5.10: Totals Summary Row — consistent font sizes -->
        <div class="bg-surface-card rounded-xl border border-border-default p-4 mb-4">
            <div class="flex items-center justify-between flex-wrap gap-4 text-sm">
                <div>
                    <span class="text-text-secondary">Interactions:</span>
                    <span class="font-bold text-text-primary ml-1">${totalInteractions.toLocaleString()}</span>
                </div>
                <div class="h-5 w-px bg-border-default"></div>
                <div>
                    <span class="text-text-secondary">Cases:</span>
                    <span class="font-bold text-primary ml-1">${totalCases}</span>
                    <span class="text-text-secondary ml-1">· Open: <span class="font-bold">${metrics.open}</span> · Closed: <span class="font-bold">${metrics.closed}</span></span>
                </div>
                <div class="h-5 w-px bg-border-default"></div>
                <div>
                    <span class="text-text-secondary">Engagements:</span>
                    <span class="font-bold text-accent-teal ml-1">${totalEngagements}</span>
                    <span class="text-text-secondary ml-1">(Emp: <span class="font-bold">${engagements.employee}</span> · Mgr: <span class="font-bold">${engagements.manager}</span> · Legal: <span class="font-bold">${engagements.legal}</span> · Evid: <span class="font-bold">${engagements.evidence}</span>)</span>
                </div>
            </div>
        </div>

        <!-- V6.9: Channel cards only (3 cards for 3 channels) -->
        <div class="grid grid-cols-1 sm:grid-cols-3 gap-3 mb-2">
            ${channels.map(c => renderPostureCard(c)).join('')}
        </div>
    `;
}

// ==================== V6.9: COMMAND TOTALS (Dynamic based on timeframe) ====================
function renderCommandTotals() {
    const container = document.getElementById('command-totals-bar');
    if (!container) return;

    const totals = DEMO_DATA.commandTotalsByTimeframe?.[currentTimeframe] || DEMO_DATA.commandTotalsByTimeframe?.['30d'] || {
        axiaCases: 80, dlpAlerted: 35, totalDlpAlarms: 247, validatedByAxia: 35
    };

    container.innerHTML = `
        <div class="grid grid-cols-2 gap-3 text-center">
            <div class="flex flex-col sm:flex-row sm:items-center sm:justify-center gap-1 sm:gap-4">
                <div class="flex items-center justify-center gap-2">
                    <span class="material-symbols-outlined text-primary text-[18px]">cases</span>
                    <span class="text-[13px] text-text-secondary">Total AXIA Cases:</span>
                    <span class="text-base font-bold text-text-primary">${totals.axiaCases}</span>
                </div>
                <div class="hidden sm:block w-px h-4 bg-border-subtle"></div>
                <div class="flex items-center justify-center gap-2">
                    <span class="material-symbols-outlined text-status-blocked text-[18px]">shield</span>
                    <span class="text-[13px] text-text-secondary">DLP Alerted:</span>
                    <span class="text-base font-bold text-text-primary">${totals.dlpAlerted}</span>
                </div>
            </div>
            <div class="flex flex-col sm:flex-row sm:items-center sm:justify-center gap-1 sm:gap-4">
                <div class="flex items-center justify-center gap-2">
                    <span class="material-symbols-outlined text-severity-high text-[18px]">notifications_active</span>
                    <span class="text-[13px] text-text-secondary">Total DLP Alarms:</span>
                    <span class="text-base font-bold text-text-primary">${totals.totalDlpAlarms}</span>
                </div>
                <div class="hidden sm:block w-px h-4 bg-border-subtle"></div>
                <div class="flex items-center justify-center gap-2">
                    <span class="material-symbols-outlined text-status-validated text-[18px]">verified</span>
                    <span class="text-[13px] text-text-secondary">Validated by AXIA:</span>
                    <span class="text-base font-bold text-status-validated">${totals.validatedByAxia}</span>
                </div>
            </div>
        </div>
    `;
}

// ==================== DASHBOARD METRICS WIDGET (V5.5 - Improved Readability) ====================
function renderDashboardMetrics() {
    const container = document.getElementById('dashboard-metrics');
    if (!container) return;

    const metrics = DEMO_DATA.metricsByTimeframe[currentTimeframe] || DEMO_DATA.metricsByTimeframe['30d'];
    const systems = connectionsData.filter(c => c.status === 'connected' && c.category === 'system');

    // Get DLP-specific alerts
    const purview = systems.find(s => s.id === 'ms-purview');
    const netskope = systems.find(s => s.id === 'netskope');

    const purviewAlerts = purview?.stats.alerts || { critical: 0, medium: 0, low: 0 };
    const netskopeAlerts = netskope?.stats.alerts || { critical: 0, medium: 0, low: 0 };
    const purviewFP = purview?.stats.falsePositives || 0;
    const netskopeFP = netskope?.stats.falsePositives || 0;

    const engagements = metrics.engagementsByType || { employee: 0, manager: 0, legal: 0, evidence: 0 };
    const totalEngagements = engagements.employee + engagements.manager + engagements.legal;
    const mttr = metrics.meanTimeToResolution || { avg: 1.4, critical: 1.0, high: 1.6 };

    const totalBlocked = systems.reduce((sum, c) => sum + (c.stats.dlpBlocked || 0), 0);

    container.innerHTML = `
        <div class="bg-surface-card rounded-lg border border-border-default p-4 shadow-card">
            <h3 class="text-sm font-bold text-text-primary mb-3 flex items-center gap-2">
                <span class="material-symbols-outlined text-primary text-[18px]">analytics</span>
                Time-Based Metrics
            </h3>

            <!-- Row 1: Core Metrics (V5.18: Responsive) -->
            <div class="grid grid-cols-2 sm:grid-cols-3 gap-2 mb-3">
                <div class="bg-surface-elevated rounded-lg p-2 text-center">
                    <div class="text-lg font-bold text-text-primary">${metrics.totalInteractions?.toLocaleString() || '—'}</div>
                    <div class="text-[11px] text-text-secondary">Interactions</div>
                </div>
                <div class="bg-primary/10 rounded-lg p-2 text-center border border-primary/20">
                    <div class="text-lg font-bold text-primary">${metrics.open + metrics.closed}</div>
                    <div class="text-[11px] text-text-secondary">Cases</div>
                    <div class="text-[11px] text-text-secondary">Open: ${metrics.open} · Closed: ${metrics.closed}</div>
                </div>
                <div class="bg-ops-teal-bg rounded-lg p-2 text-center border border-ops-teal/20">
                    <div class="text-lg font-bold text-ops-teal">${totalEngagements}</div>
                    <div class="text-[11px] text-text-secondary">Engagements</div>
                </div>
            </div>

            <!-- Row 2: Actions -->
            <div class="grid grid-cols-2 gap-2 mb-3">
                <div class="bg-surface-elevated rounded-lg p-2">
                    <div class="flex items-center justify-between mb-1">
                        <span class="text-[11px] text-text-secondary">Policy Updates</span>
                        <span class="text-sm font-bold text-ops-purple">${metrics.policyUpdates}</span>
                    </div>
                    <div class="flex items-center justify-between">
                        <span class="text-[11px] text-text-secondary">Blocked</span>
                        <span class="text-sm font-bold text-status-blocked">${totalBlocked}</span>
                    </div>
                </div>
                <div class="bg-status-success/10 rounded-lg p-2 border border-status-success/20">
                    <div class="text-[11px] text-text-secondary mb-1">Mean Time to Resolution</div>
                    <div class="text-lg font-bold text-status-success">${mttr.avg}h</div>
                    <div class="text-[11px] text-text-secondary">Crit: ${mttr.critical}h · High: ${mttr.high}h</div>
                </div>
            </div>

            <!-- Row 3: DLP Alerts Breakdown - V5.7: Improved readability -->
            <div class="grid grid-cols-2 gap-2">
                <div class="bg-purple-500/5 rounded-lg p-2.5 border border-purple-500/10">
                    <div class="text-[11px] font-bold text-purple-500 mb-1.5">Purview Alerts:</div>
                    <div class="flex flex-wrap gap-1.5 text-[11px]">
                        <span class="text-severity-critical">Crit: <strong>${purviewAlerts.critical}</strong></span>
                        <span class="text-severity-medium">Med: <strong>${purviewAlerts.medium}</strong></span>
                        <span class="text-severity-low">Low: <strong>${purviewAlerts.low}</strong></span>
                        <span class="text-text-secondary ml-auto">FP: ${purviewFP}</span>
                    </div>
                </div>
                <div class="bg-teal-500/5 rounded-lg p-2.5 border border-teal-500/10">
                    <div class="text-[11px] font-bold text-teal-500 mb-1.5">Netskope Alerts:</div>
                    <div class="flex flex-wrap gap-1.5 text-[11px]">
                        <span class="text-severity-critical">Crit: <strong>${netskopeAlerts.critical}</strong></span>
                        <span class="text-severity-medium">Med: <strong>${netskopeAlerts.medium}</strong></span>
                        <span class="text-severity-low">Low: <strong>${netskopeAlerts.low}</strong></span>
                        <span class="text-text-secondary ml-auto">FP: ${netskopeFP}</span>
                    </div>
                </div>
            </div>
        </div>
    `;
}

// ==================== V6.12: ENFORCEMENT SCREEN (formerly Connections) ====================
// V6.12: Restructured to show only enforcement-related content:
// - DLP Systems (enforcement layer)
// - Smart Block Policies (AXIA-native enforcement)
// - DLP Additional Connections
// Email/SaaS channels and Context Sources moved to Settings > Integration
function renderConnectionsScreen() {
    const connectedItems = connectionsData.filter(c => c.status === 'connected');
    const systems = connectedItems.filter(c => c.category === 'system');
    const comingSoonItems = connectionsData.filter(c => c.status === 'coming-soon');

    // V5.10: Helper to render connection card (channels) - unbolded subtitles, single column
    const renderChannelCard = (conn) => {
        const policies = conn.policies || [];
        const stats = conn.stats;
        return `
            <details class="group bg-surface-card rounded-lg border border-border-default shadow-card overflow-hidden">
                <summary class="flex items-center gap-3 p-4 cursor-pointer select-none hover:bg-surface-hover/50 transition-colors">
                    <div class="w-10 h-10 rounded-lg bg-${conn.color}/20 flex items-center justify-center relative shrink-0">
                        <span class="material-symbols-outlined text-${conn.color} text-[20px]">${conn.icon}</span>
                        <span class="absolute -top-1 -right-1 w-4 h-4 bg-status-success rounded-full border-2 border-white flex items-center justify-center">
                            <span class="material-symbols-outlined text-white text-[10px]" style="font-variation-settings: 'FILL' 1">check</span>
                        </span>
                    </div>
                    <div class="flex-1 min-w-0">
                        <h4 class="text-sm font-bold text-text-primary">${conn.name}</h4>
                        <p class="text-xs text-text-secondary">${stats.dataProcessed}</p>
                    </div>
                    <span class="text-[11px] text-text-secondary shrink-0">Synced ${stats.lastSync}</span>
                    <span class="material-symbols-outlined text-text-secondary text-[18px] transition-transform duration-200 group-open:rotate-180">expand_more</span>
                </summary>
                <div class="border-t border-border-default p-4 bg-surface-elevated/50">
                    <!-- Connection Details (V5.18: Responsive) -->
                    <div class="grid grid-cols-3 gap-2 sm:gap-3 mb-3">
                        <div>
                            <span class="text-[11px] text-text-secondary block">Coverage</span>
                            <span class="text-sm font-bold text-text-primary">${stats.coverage || '100%'}</span>
                        </div>
                        <div>
                            <span class="text-[11px] text-text-secondary block">Integration</span>
                            <span class="text-sm font-bold text-text-primary">${stats.integration || 'API'}</span>
                        </div>
                        <div>
                            <span class="text-[11px] text-text-secondary block">Policies</span>
                            <span class="text-sm font-bold text-ops-purple">${policies.length} active</span>
                        </div>
                    </div>

                    <!-- Policies -->
                    ${policies.length > 0 ? `
                    <div class="space-y-2">
                        ${policies.map(policy => {
                            const scenarios = policy.scenarios || (policy.scenario ? [policy.scenario] : []);
                            const isEnabled = policy.enabled !== false;
                            return `
                            <div class="bg-ops-purple-bg rounded-lg p-2.5 border border-ops-purple/20">
                                <div class="flex items-center justify-between mb-1.5">
                                    <span class="text-[11px] font-bold text-text-primary">${policy.name}</span>
                                    <span class="text-[10px] px-1.5 py-0.5 rounded ${isEnabled ? 'bg-status-success/20 text-status-success' : 'bg-ops-slate-bg text-ops-slate'}">${isEnabled ? 'active' : 'paused'}</span>
                                </div>
                                ${scenarios.map((scenario, sIdx) => `
                                <div class="${sIdx > 0 ? 'mt-1.5 pt-1.5 border-t border-ops-purple/10' : ''}">
                                    <div class="space-y-1">
                                        <div class="scenario-condition" style="font-size: 11px;">
                                            <span class="scenario-label">When</span>
                                            <span class="scenario-value">${scenario.when}</span>
                                        </div>
                                        <div class="scenario-condition" style="font-size: 11px;">
                                            <span class="scenario-label">Does</span>
                                            <span class="scenario-value">${scenario.does}</span>
                                        </div>
                                        <div class="scenario-condition" style="font-size: 11px;">
                                            <span class="scenario-label">Through</span>
                                            <span class="scenario-value">${scenario.through}</span>
                                        </div>
                                        <div class="scenario-condition" style="font-size: 11px;">
                                            <span class="scenario-label">To</span>
                                            <span class="scenario-value">${scenario.to}</span>
                                        </div>
                                    </div>
                                </div>
                                `).join('')}
                                <div class="mt-1.5 pt-1.5 border-t border-ops-purple/10 flex items-center gap-3 text-[10px] text-text-secondary">
                                    <span>Triggers: <strong class="text-text-primary">${policy.triggerCount || 0}</strong></span>
                                </div>
                            </div>
                        `}).join('')}
                    </div>
                    ` : ''}
                </div>
            </details>
        `;
    };

    // V6.15: DLP system card - Coverage/Integration merged into main card, no expandable section
    const renderDlpCard = (conn) => {
        const stats = conn.stats;
        return `
            <div class="bg-surface-card rounded-lg border border-border-default shadow-card p-4">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 rounded-lg bg-${conn.color}/20 flex items-center justify-center relative shrink-0">
                        <span class="material-symbols-outlined text-${conn.color} text-[20px]">${conn.icon}</span>
                        <span class="absolute -top-1 -right-1 w-4 h-4 bg-status-success rounded-full border-2 border-white flex items-center justify-center">
                            <span class="material-symbols-outlined text-white text-[10px]" style="font-variation-settings: 'FILL' 1">check</span>
                        </span>
                    </div>
                    <div class="flex-1 min-w-0">
                        <h4 class="text-sm font-bold text-text-primary">${conn.name}</h4>
                        <p class="text-xs text-text-secondary">${stats.dataProcessed}</p>
                        <p class="text-[10px] text-text-secondary/70 mt-0.5">${stats.coverage || '—'} coverage · ${stats.integration || 'API'} · Synced ${stats.lastSync}</p>
                    </div>
                </div>
            </div>
        `;
    };

    // V6.14: DLP Systems unified - active cards + additional connections inline
    document.getElementById('connections-content').innerHTML = `
        <!-- DLP Systems (V6.14: Active + Available in same section) -->
        <section class="mb-6">
            <h3 class="text-sm font-bold text-text-secondary uppercase tracking-wider mb-3">DLP Systems</h3>
            <div class="grid gap-3 mb-3">
                ${systems.map(conn => renderDlpCard(conn)).join('')}
            </div>
            <!-- V6.14: Additional DLPs shown inline with "Connect" option -->
            ${renderAdditionalConnections('dlp')}
        </section>

        <!-- V6.13: Smart Block Policies (AXIA-native enforcement with target systems) -->
        <section class="mb-6">
            <h3 class="text-sm font-bold text-text-secondary uppercase tracking-wider mb-3">Smart Block Policies</h3>
            <p class="text-xs text-text-muted mb-3">Contextual enforcement rules that guide DLP systems and SaaS applications. These policies use behavioral context that static rules cannot capture.</p>
            <div class="grid gap-3">
                ${enforcementRulesData.map(rule => {
                    // V6.14: Only DLPs (Purview, Netskope) and direct API integrations (Slack)
                    const channelNames = {
                        'ms-purview': 'Purview',
                        'netskope': 'Netskope',
                        'slack': 'Slack'
                    };
                    const targetSystems = (rule.channels || []).map(ch => channelNames[ch] || ch).join(', ');
                    return `
                    <details class="group bg-surface-card rounded-lg border border-border-default shadow-card overflow-hidden" data-rule-id="${rule.id}">
                        <summary class="flex items-center gap-3 p-4 cursor-pointer select-none hover:bg-surface-hover/50 transition-colors">
                            <div class="w-10 h-10 rounded-lg bg-status-blocked/20 flex items-center justify-center relative shrink-0">
                                <span class="material-symbols-outlined text-status-blocked text-[20px]">security</span>
                                <span class="absolute -top-1 -right-1 w-4 h-4 ${rule.status === 'active' ? 'bg-status-success' : 'bg-ops-slate'} rounded-full border-2 border-white flex items-center justify-center">
                                    <span class="material-symbols-outlined text-white text-[10px]" style="font-variation-settings: 'FILL' 1">${rule.status === 'active' ? 'check' : 'pause'}</span>
                                </span>
                            </div>
                            <div class="flex-1 min-w-0">
                                <h4 class="text-sm font-bold text-text-primary">${rule.name}</h4>
                                <p class="text-xs text-text-secondary">${rule.description}</p>
                            </div>
                            <div class="flex items-center gap-2 shrink-0">
                                <span class="text-[10px] px-1.5 py-0.5 rounded ${rule.status === 'active' ? 'bg-status-success/20 text-status-success' : 'bg-ops-slate-bg text-ops-slate'}">${rule.status}</span>
                                <span class="material-symbols-outlined text-text-secondary text-[18px] transition-transform duration-200 group-open:rotate-180">expand_more</span>
                            </div>
                        </summary>
                        <div class="border-t border-border-default p-4 bg-surface-elevated/50">
                            <!-- V6.13: Target Systems FIRST, then Triggers -->
                            <div class="grid grid-cols-2 sm:grid-cols-4 gap-2 sm:gap-3 mb-3">
                                <div class="col-span-2 sm:col-span-1">
                                    <span class="text-[11px] text-text-secondary block">Guides</span>
                                    <span class="text-sm font-bold text-ops-purple">${targetSystems || 'All systems'}</span>
                                </div>
                                <div>
                                    <span class="text-[11px] text-text-secondary block">Triggers</span>
                                    <span class="text-sm font-bold text-text-primary">${rule.triggerCount}</span>
                                </div>
                                <div>
                                    <span class="text-[11px] text-text-secondary block">Last Triggered</span>
                                    <span class="text-sm font-bold text-text-primary">${rule.lastTriggered}</span>
                                </div>
                                <div>
                                    <span class="text-[11px] text-text-secondary block">Action</span>
                                    <span class="text-sm font-bold text-status-blocked">${rule.action}</span>
                                </div>
                            </div>

                            <!-- Scenario -->
                            <div class="bg-status-blocked/5 rounded-lg p-2.5 border border-status-blocked/20">
                                <div class="space-y-1">
                                    <div class="scenario-condition" style="font-size: 11px;">
                                        <span class="scenario-label">When</span>
                                        <span class="scenario-value">${rule.scenario.when}</span>
                                    </div>
                                    <div class="scenario-condition" style="font-size: 11px;">
                                        <span class="scenario-label">Does</span>
                                        <span class="scenario-value">${rule.scenario.does}</span>
                                    </div>
                                    <div class="scenario-condition" style="font-size: 11px;">
                                        <span class="scenario-label">Through</span>
                                        <span class="scenario-value">${rule.scenario.through}</span>
                                    </div>
                                    <div class="scenario-condition" style="font-size: 11px;">
                                        <span class="scenario-label">To</span>
                                        <span class="scenario-value">${rule.scenario.to}</span>
                                    </div>
                                </div>
                                ${rule.sourceCase ? `
                                <div class="mt-2 pt-2 border-t border-status-blocked/10 text-[10px] text-text-secondary">
                                    Created from: <span class="text-primary font-medium">${rule.sourceCase}</span>
                                </div>
                                ` : ''}
                            </div>

                            <!-- V6.15: Policy Actions (Edit / Enable-Disable) -->
                            <div class="mt-3 pt-3 border-t border-border-default flex items-center justify-between">
                                <div class="flex items-center gap-2">
                                    <button onclick="showToast('Edit Policy dialog would open here', 'info')" class="px-3 py-1.5 text-[11px] font-medium text-primary bg-primary/10 hover:bg-primary/20 rounded-lg transition-colors flex items-center gap-1">
                                        <span class="material-symbols-outlined text-[14px]">edit</span>
                                        Edit Policy
                                    </button>
                                    <button onclick="showToast('Policy ${rule.status === 'active' ? 'disabled' : 'enabled'}', '${rule.status === 'active' ? 'warning' : 'success'}')" class="px-3 py-1.5 text-[11px] font-medium ${rule.status === 'active' ? 'text-ops-slate bg-ops-slate-bg hover:bg-ops-slate/20' : 'text-status-success bg-status-success/10 hover:bg-status-success/20'} rounded-lg transition-colors flex items-center gap-1">
                                        <span class="material-symbols-outlined text-[14px]">${rule.status === 'active' ? 'pause_circle' : 'play_circle'}</span>
                                        ${rule.status === 'active' ? 'Disable' : 'Enable'}
                                    </button>
                                </div>
                                <button onclick="showToast('Policy deleted', 'warning')" class="px-2 py-1.5 text-[11px] font-medium text-status-blocked/70 hover:text-status-blocked hover:bg-status-blocked/10 rounded-lg transition-colors flex items-center gap-1">
                                    <span class="material-symbols-outlined text-[14px]">delete</span>
                                </button>
                            </div>
                        </div>
                    </details>
                `}).join('')}
            </div>
        </section>
    `;
}

// Keep old function name as alias for backward compatibility
function renderChannelsScreen() { renderConnectionsScreen(); }

// ==================== DASHBOARD VIEW SCREEN (V6.6 - Reordered 8 Widgets with Export) ====================
function renderDashboardViewScreen() {
    // V6.24: Redesigned Insights layout
    // Row 1: Overall Posture (RCS + MTTR dual line chart)
    renderOverallPosture();

    // Row 2: Cases timeline + AXIA Actions
    renderCasesTimeline();
    renderAxiaActionsPie();

    // Row 3: Top Case Types + Departments
    renderTopCaseTypes();
    renderDeptHeatmapPie();

    // Row 4: Total Alerts vs True Cases (expanded)
    renderFalseAlarmsChart();
}

// ==================== V6.3: Toggle Dashboard Edit Mode (Draggable Widgets) ====================
function toggleDashboardEditMode() {
    dashboardEditMode = !dashboardEditMode;
    const label = document.getElementById('edit-mode-label');
    const widgets = document.querySelectorAll('.dashboard-widget');

    if (dashboardEditMode) {
        if (label) label.textContent = 'Done';
        widgets.forEach(w => {
            w.draggable = true;
            w.classList.add('cursor-move', 'hover:ring-2', 'hover:ring-primary/50');
        });
        initDragDrop();
    } else {
        if (label) label.textContent = 'Edit';
        widgets.forEach(w => {
            w.draggable = false;
            w.classList.remove('cursor-move', 'hover:ring-2', 'hover:ring-primary/50');
        });
    }
}

// ==================== V6.3: Drag & Drop Widget Reordering ====================
let draggedWidget = null;

function initDragDrop() {
    const container = document.getElementById('dashboard-view-content');
    const widgets = document.querySelectorAll('.dashboard-widget');

    widgets.forEach(widget => {
        widget.addEventListener('dragstart', handleDragStart);
        widget.addEventListener('dragend', handleDragEnd);
        widget.addEventListener('dragover', handleDragOver);
        widget.addEventListener('drop', handleDrop);
        widget.addEventListener('dragenter', handleDragEnter);
        widget.addEventListener('dragleave', handleDragLeave);
    });
}

function handleDragStart(e) {
    draggedWidget = this;
    this.style.opacity = '0.5';
    e.dataTransfer.effectAllowed = 'move';
    e.dataTransfer.setData('text/plain', this.dataset.widget);
}

function handleDragEnd(e) {
    this.style.opacity = '1';
    document.querySelectorAll('.dashboard-widget').forEach(w => {
        w.classList.remove('ring-2', 'ring-primary');
    });
}

function handleDragOver(e) {
    e.preventDefault();
    e.dataTransfer.dropEffect = 'move';
}

function handleDragEnter(e) {
    if (this !== draggedWidget) {
        this.classList.add('ring-2', 'ring-primary');
    }
}

function handleDragLeave(e) {
    this.classList.remove('ring-2', 'ring-primary');
}

function handleDrop(e) {
    e.preventDefault();
    if (this !== draggedWidget && draggedWidget) {
        const container = document.getElementById('dashboard-view-content');
        const allWidgets = [...container.querySelectorAll('.dashboard-widget')];
        const draggedIndex = allWidgets.indexOf(draggedWidget);
        const targetIndex = allWidgets.indexOf(this);

        if (draggedIndex < targetIndex) {
            this.parentNode.insertBefore(draggedWidget, this.nextSibling);
        } else {
            this.parentNode.insertBefore(draggedWidget, this);
        }
    }
    this.classList.remove('ring-2', 'ring-primary');
}

// ==================== V6.3 NEW WIDGET: Before/After AXIA (ROI Transformation) ====================
function renderBeforeAfterAxia() {
    const container = document.getElementById('widget-before-after');
    if (!container) return;

    const data = DEMO_DATA.beforeAfterAxia || {};

    // Key metrics to show (most impactful)
    const metrics = [
        { key: 'falsePositiveRate', label: 'False Positives', before: data.falsePositiveRate?.before, after: data.falsePositiveRate?.after, unit: '%', improved: true },
        { key: 'meanTimeToResolution', label: 'MTTR', before: data.meanTimeToResolution?.before, after: data.meanTimeToResolution?.after, unit: 'h', improved: true },
        { key: 'analystCaseload', label: 'Analyst Load', before: data.analystCaseload?.before, after: data.analystCaseload?.after, unit: '/day', improved: true },
        { key: 'employeeCoaching', label: 'Coaching', before: data.employeeCoaching?.before, after: data.employeeCoaching?.after, unit: '/wk', improved: false }
    ];

    container.innerHTML = `
        <div class="flex items-center justify-between mb-2">
            <h3 class="text-xs font-bold text-text-primary uppercase tracking-wide flex items-center gap-1">
                <span class="material-symbols-outlined text-status-success text-[14px]">trending_up</span>
                AXIA Impact
            </h3>
            <span class="text-[10px] font-bold text-status-success">vs. DLP-Only</span>
        </div>
        <div class="flex-1 flex flex-col justify-center gap-1.5">
            ${metrics.map(m => {
                const improvement = m.improved
                    ? Math.round((1 - m.after / m.before) * 100)
                    : Math.round((m.after / m.before - 1) * 100);
                const color = m.improved ? '#22c55e' : '#6366f1';
                const arrow = m.improved ? '↓' : '↑';
                return `
                    <div class="flex items-center justify-between text-[11px]">
                        <span class="text-text-secondary">${m.label}</span>
                        <div class="flex items-center gap-2">
                            <span class="text-text-muted line-through">${m.before}${m.unit}</span>
                            <span class="font-bold" style="color: ${color}">${m.after}${m.unit}</span>
                            <span class="text-[9px] font-bold px-1 py-0.5 rounded" style="background: ${color}20; color: ${color}">${arrow}${Math.abs(improvement)}%</span>
                        </div>
                    </div>
                `;
            }).join('')}
        </div>
        <div class="text-[9px] text-text-secondary mt-2 pt-2 border-t border-border-subtle text-center">
            3-month deployment results
        </div>
    `;
}

// ==================== V6.24 WIDGET: Overall Posture (RCS rising + MTTR declining) ====================
function renderOverallPosture() {
    const container = document.getElementById('widget-overall-posture');
    if (!container) return;

    const rcs = DEMO_DATA.riskControlScore;
    const mttr = DEMO_DATA.mttrTrend;
    if (!rcs || !mttr) return;

    // Build time-series data based on selected timeframe
    let rcsValues, mttrValues, labels;
    if (dashboardTimeframe === '90d') {
        rcsValues = [rcs['90d'].composite, rcs['30d'].composite, rcs['7d'].composite];
        mttrValues = mttr['90d'].values;
        labels = ['Nov', 'Dec', 'Jan'];
    } else if (dashboardTimeframe === '30d') {
        rcsValues = [rcs['90d'].composite, Math.round((rcs['90d'].composite + rcs['30d'].composite) / 2), rcs['30d'].composite, rcs['7d'].composite];
        mttrValues = mttr['30d'].values;
        labels = mttr['30d'].labels;
    } else if (dashboardTimeframe === '1d') {
        rcsValues = [rcs['7d'].composite, Math.round((rcs['7d'].composite + rcs['1d'].composite) / 2), rcs['1d'].composite];
        mttrValues = mttr['1d'].values;
        labels = mttr['1d'].labels.length === rcsValues.length ? mttr['1d'].labels : ['Feb 5', 'Feb 6', 'Feb 7'];
    } else {
        rcsValues = [rcs['30d'].composite, Math.round((rcs['30d'].composite + rcs['7d'].composite) / 2), rcs['7d'].composite];
        mttrValues = mttr['7d'].values.length === 3 ? mttr['7d'].values : [mttr['7d'].values[0], mttr['7d'].values[3], mttr['7d'].values[6]];
        labels = ['Feb 1', 'Feb 4', 'Feb 7'];
    }

    const currentRcs = rcsValues[rcsValues.length - 1];
    const currentMttr = mttrValues[mttrValues.length - 1];
    const rcsColor = currentRcs >= 80 ? '#22c55e' : currentRcs >= 60 ? '#f59e0b' : '#ef4444';
    const mttrColor = '#22D3EE';
    const fmtMttr = (v) => v >= 10 ? Math.round(v) + 'h' : v.toFixed(1) + 'h';

    // RCS trend direction
    const rcsDiff = currentRcs - rcsValues[0];
    const rcsArrow = rcsDiff >= 0 ? '▲' : '▼';
    const rcsTrendClass = rcsDiff >= 0 ? 'text-status-success' : 'text-severity-critical';

    // MTTR trend direction (lower is better)
    const mttrFirst = mttrValues[0];
    const mttrImprovement = mttrFirst > 0 ? Math.round((1 - currentMttr / mttrFirst) * 100) : 0;

    container.innerHTML = `
        <div class="flex items-center justify-between mb-3">
            <h3 class="text-sm font-bold text-text-primary uppercase tracking-wide flex items-center gap-2">
                <span class="material-symbols-outlined text-primary text-[18px]">shield</span>
                Overall Posture
            </h3>
            <div class="flex items-center gap-1">
                ${renderExportButton('overall-posture')}
            </div>
        </div>
        <!-- KPI row -->
        <div class="flex items-center gap-6 mb-3">
            <div class="flex items-center gap-3">
                <div class="flex flex-col">
                    <span class="text-[10px] text-text-secondary uppercase tracking-wider font-semibold">Risk Control Score</span>
                    <div class="flex items-baseline gap-1.5">
                        <span class="text-3xl font-black" style="color: ${rcsColor}">${currentRcs}</span>
                        <span class="text-xs font-bold ${rcsTrendClass}">${rcsArrow} ${Math.abs(rcsDiff)}pts</span>
                    </div>
                </div>
            </div>
            <div class="w-px h-10 bg-border-subtle"></div>
            <div class="flex items-center gap-3">
                <div class="flex flex-col">
                    <span class="text-[10px] text-text-secondary uppercase tracking-wider font-semibold">Mean Time to Resolve</span>
                    <div class="flex items-baseline gap-1.5">
                        <span class="text-3xl font-black" style="color: ${mttrColor}">${fmtMttr(currentMttr)}</span>
                        ${mttrImprovement > 0 ? `<span class="text-xs font-bold text-status-success">↓ ${mttrImprovement}%</span>` : ''}
                    </div>
                </div>
            </div>
        </div>
        <!-- Prominent dual-line chart -->
        <div class="flex-1 flex items-end" style="min-height: 120px;">
            ${renderPostureDualChart(rcsValues, mttrValues, labels, rcsColor, mttrColor)}
        </div>
        <!-- Legend -->
        <div class="flex items-center gap-4 mt-2 pt-2 border-t border-border-subtle">
            <span class="flex items-center gap-1.5 text-[11px] text-text-secondary">
                <span class="inline-block w-3 h-[3px] rounded-full" style="background: ${rcsColor}"></span>
                Risk Control Score (higher = better)
            </span>
            <span class="flex items-center gap-1.5 text-[11px] text-text-secondary">
                <span class="inline-block w-3 h-[3px] rounded-full" style="background: ${mttrColor}"></span>
                MTTR (lower = better)
            </span>
        </div>
    `;
}

// V6.24 HELPER: Dual-axis chart for Overall Posture (RCS left axis, MTTR right axis)
function renderPostureDualChart(rcsValues, mttrValues, labels, rcsColor, mttrColor) {
    if (!rcsValues || !mttrValues) return '';

    const width = 600;
    const height = 140;
    const pad = { top: 12, bottom: 22, left: 40, right: 45 };
    const chartW = width - pad.left - pad.right;
    const chartH = height - pad.top - pad.bottom;

    // RCS axis: 0-100
    const rcsMax = 100;
    const rcsMin = 0;

    // MTTR axis: 0 to max value * 1.2
    const mttrMax = Math.max(...mttrValues, 1) * 1.2;

    // Normalize RCS & MTTR lengths (use max length)
    const len = Math.max(rcsValues.length, mttrValues.length);

    const rcsPts = rcsValues.map((v, i) => {
        const x = pad.left + (rcsValues.length === 1 ? chartW / 2 : (i / (rcsValues.length - 1)) * chartW);
        const y = pad.top + chartH - ((v - rcsMin) / (rcsMax - rcsMin)) * chartH;
        return { x, y, v };
    });

    const mttrPts = mttrValues.map((v, i) => {
        const x = pad.left + (mttrValues.length === 1 ? chartW / 2 : (i / (mttrValues.length - 1)) * chartW);
        const y = pad.top + chartH - (v / mttrMax) * chartH;
        return { x, y, v };
    });

    // RCS line + area
    const rcsLine = rcsPts.map(p => `${p.x},${p.y}`).join(' ');
    const rcsFill = `${rcsPts[0].x},${pad.top + chartH} ${rcsLine} ${rcsPts[rcsPts.length - 1].x},${pad.top + chartH}`;

    // MTTR line + area
    const mttrLine = mttrPts.map(p => `${p.x},${p.y}`).join(' ');
    const mttrFill = `${mttrPts[0].x},${pad.top + chartH} ${mttrLine} ${mttrPts[mttrPts.length - 1].x},${pad.top + chartH}`;

    // Grid lines (3 horizontal)
    const gridLines = [0.25, 0.5, 0.75].map(pct => {
        const y = pad.top + chartH - pct * chartH;
        const rcsVal = Math.round(rcsMin + pct * (rcsMax - rcsMin));
        return `
            <line x1="${pad.left}" y1="${y}" x2="${width - pad.right}" y2="${y}" stroke="var(--color-border-subtle,#e2e8f0)" stroke-width="0.5" stroke-dasharray="4,4"/>
            <text x="${pad.left - 6}" y="${y + 3}" text-anchor="end" style="font-size:9px;fill:${rcsColor};font-family:JetBrains Mono,monospace;font-weight:600">${rcsVal}</text>
        `;
    }).join('');

    // MTTR right axis labels
    const mttrAxisLabels = [0.25, 0.5, 0.75].map(pct => {
        const y = pad.top + chartH - pct * chartH;
        const mttrVal = (pct * mttrMax).toFixed(1);
        return `<text x="${width - pad.right + 6}" y="${y + 3}" text-anchor="start" style="font-size:9px;fill:${mttrColor};font-family:JetBrains Mono,monospace;font-weight:600">${mttrVal}h</text>`;
    }).join('');

    // X-axis labels
    const xLabels = (labels || []).map((lbl, i) => {
        const x = pad.left + (labels.length === 1 ? chartW / 2 : (i / (labels.length - 1)) * chartW);
        return `<text x="${x}" y="${height - 4}" text-anchor="middle" style="font-size:10px;fill:var(--color-text-muted,#94a3b8);font-family:Manrope,sans-serif;font-weight:500">${lbl}</text>`;
    }).join('');

    // Data point labels on RCS
    const rcsPointLabels = rcsPts.map(p =>
        `<circle cx="${p.x}" cy="${p.y}" r="4" fill="${rcsColor}" stroke="white" stroke-width="2"/>
         <text x="${p.x}" y="${p.y - 8}" text-anchor="middle" style="font-size:10px;font-weight:700;fill:${rcsColor};font-family:JetBrains Mono,monospace">${p.v}</text>`
    ).join('');

    // Data point labels on MTTR
    const fmtMttr = (v) => v >= 10 ? Math.round(v) + 'h' : v.toFixed(1) + 'h';
    const mttrPointLabels = mttrPts.map(p =>
        `<circle cx="${p.x}" cy="${p.y}" r="4" fill="${mttrColor}" stroke="white" stroke-width="2"/>
         <text x="${p.x}" y="${p.y - 8}" text-anchor="middle" style="font-size:10px;font-weight:700;fill:${mttrColor};font-family:JetBrains Mono,monospace">${fmtMttr(p.v)}</text>`
    ).join('');

    return `
        <svg width="${width}" height="${height}" viewBox="0 0 ${width} ${height}" class="w-full" preserveAspectRatio="xMidYMid meet">
            <!-- Grid -->
            <line x1="${pad.left}" y1="${pad.top + chartH}" x2="${width - pad.right}" y2="${pad.top + chartH}" stroke="var(--color-border-subtle,#e2e8f0)" stroke-width="1"/>
            ${gridLines}
            ${mttrAxisLabels}
            <!-- RCS area + line -->
            <polygon points="${rcsFill}" fill="${rcsColor}" opacity="0.1"/>
            <polyline points="${rcsLine}" fill="none" stroke="${rcsColor}" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
            ${rcsPointLabels}
            <!-- MTTR area + line -->
            <polygon points="${mttrFill}" fill="${mttrColor}" opacity="0.1"/>
            <polyline points="${mttrLine}" fill="none" stroke="${mttrColor}" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" stroke-dasharray="8,4"/>
            ${mttrPointLabels}
            <!-- Labels -->
            ${xLabels}
        </svg>
    `;
}

// ==================== V6.20 WIDGET: Risk Control Score ====================
function renderRiskControlScore() {
    const container = document.getElementById('widget-risk-score');
    if (!container) return;

    const scoreData = DEMO_DATA.riskControlScore?.[dashboardTimeframe] || DEMO_DATA.riskControlScore?.['30d'] || { composite: 75 };
    const score = scoreData.composite;
    const color = score >= 80 ? '#22c55e' : score >= 60 ? '#f59e0b' : '#ef4444';

    const rcs = DEMO_DATA.riskControlScore;
    // V6.21: Real date labels for RCS trend
    let trendValues, trendLabels;
    if (dashboardTimeframe === '90d') {
        trendValues = [rcs['90d'].composite, rcs['30d'].composite, rcs['7d'].composite];
        trendLabels = ['Nov', 'Dec', 'Jan'];
    } else if (dashboardTimeframe === '30d') {
        const start = rcs['90d'].composite;
        const mid = rcs['30d'].composite;
        const end = rcs['7d'].composite;
        trendValues = [start, Math.round((start + mid) / 2), mid, end];
        trendLabels = ['Jan 10', 'Jan 17', 'Jan 24', 'Jan 31'];
    } else if (dashboardTimeframe === '1d') {
        trendValues = [rcs['7d'].composite, Math.round((rcs['7d'].composite + rcs['1d'].composite) / 2), rcs['1d'].composite];
        trendLabels = ['Feb 5', 'Feb 6', 'Feb 7'];
    } else {
        trendValues = [rcs['30d'].composite, Math.round((rcs['30d'].composite + rcs['7d'].composite) / 2), rcs['7d'].composite];
        trendLabels = ['Feb 1', 'Feb 4', 'Feb 7'];
    }

    const ptsDiff = score - trendValues[0];
    const trendSign = ptsDiff >= 0 ? '▲' : '▼';
    const trendColor = ptsDiff >= 0 ? 'text-status-success' : 'text-severity-medium';

    // V6.23: Removed case status breakdown per Asaf feedback

    container.innerHTML = `
        <div class="flex items-center justify-between mb-2">
            <h3 class="text-xs font-bold text-text-primary uppercase tracking-wide">Risk Control Score</h3>
            <div class="flex items-center gap-1">
                ${renderExportButton('risk-score')}
            </div>
        </div>
        <div class="flex-1 flex flex-col justify-center">
            <div class="flex items-baseline gap-2 mb-2">
                <span class="text-3xl font-black" style="color: ${color}">${score}</span>
                <span class="text-xs font-bold ${trendColor}">${trendSign} ${Math.abs(ptsDiff)}pts</span>
            </div>
            ${renderAreaChart(trendValues, trendLabels, color, color, 45, 200)}
        </div>
    `;
}

// ==================== V6.20 WIDGET: Cases by Severity (Donut with center total) ====================
function renderCasesBySeverityPie() {
    const container = document.getElementById('widget-cases-severity');
    if (!container) return;

    const severity = DEMO_DATA.severityByTimeframe?.[dashboardTimeframe] || DEMO_DATA.severityByTimeframe?.['30d'];
    const data = [
        { label: 'Low', value: severity?.low?.total || 0, color: '#22c55e' },
        { label: 'Medium', value: severity?.medium?.total || 0, color: '#eab308' },
        { label: 'Critical', value: severity?.critical?.total || 0, color: '#dc2626' },
        { label: 'High', value: severity?.high?.total || 0, color: '#f97316' }
    ];
    const total = data.reduce((sum, d) => sum + d.value, 0);

    // V6.23: Tighter layout, reduced white space
    container.innerHTML = `
        <div class="flex items-center justify-between mb-1">
            <h3 class="text-xs font-bold text-text-primary uppercase tracking-wide">Cases by Severity</h3>
            <div class="flex items-center gap-1">
                ${renderExportButton('cases-severity')}
            </div>
        </div>
        <div class="flex-1 flex items-center gap-3">
            <div class="shrink-0">${renderPieChart(data, 85, true, 'Total')}</div>
            <div class="flex flex-col gap-1">
                ${data.map(d => `
                    <div class="flex items-center gap-2">
                        <span class="w-2 h-2 rounded-sm shrink-0" style="background: ${d.color}"></span>
                        <span class="text-[10px] text-text-secondary">${d.label}:</span>
                        <span class="text-[10px] font-bold text-text-primary">${d.value}</span>
                    </div>
                `).join('')}
            </div>
        </div>
    `;
}

// ==================== V6.20 WIDGET: Interactions Analyzed (Area Chart) ====================
function renderInteractionsChart() {
    const container = document.getElementById('widget-interactions');
    if (!container) return;

    const metrics = DEMO_DATA.metricsByTimeframe?.[dashboardTimeframe] || {};
    const trend = DEMO_DATA.interactionsTrend?.[dashboardTimeframe] || DEMO_DATA.interactionsTrend?.['30d'];
    const total = metrics.totalInteractions || 0;

    // V6.23: Removed graph per Asaf feedback - show number only
    container.innerHTML = `
        <div class="flex items-center justify-between mb-2">
            <h3 class="text-xs font-bold text-text-primary uppercase tracking-wide">Interactions</h3>
            <div class="flex items-center gap-1">
                ${renderExportButton('interactions')}
            </div>
        </div>
        <div class="flex-1 flex flex-col justify-center">
            <span class="text-3xl font-black text-text-primary">${total.toLocaleString()}</span>
            <span class="text-sm text-text-secondary mt-1">analyzed interactions</span>
        </div>
    `;
}

// ==================== V6.23 WIDGET: Cases (Prominent Numbers + Stacked Bar) ====================
function renderCasesByStatusPie() {
    const container = document.getElementById('widget-cases-status');
    if (!container) return;

    const status = DEMO_DATA.casesByStatus?.[dashboardTimeframe] || DEMO_DATA.casesByStatus?.['30d'] || {};
    const data = [
        { label: 'Closed', value: status.closed || 0, color: '#22c55e' },
        { label: 'Open', value: status.open || 0, color: '#3b82f6' },
        { label: 'Assigned', value: status.assigned || 0, color: '#8b5cf6' },
        { label: 'Unassigned', value: status.unassigned || 0, color: '#94a3b8' }
    ];
    const total = data.reduce((sum, d) => sum + d.value, 0);
    const closedPct = total > 0 ? Math.round((data[0].value / total) * 100) : 0;

    container.innerHTML = `
        <div class="flex items-center justify-between mb-2">
            <h3 class="text-xs font-bold text-text-primary uppercase tracking-wide">Cases</h3>
            <div class="flex items-center gap-1">
                ${renderExportButton('cases-status')}
            </div>
        </div>
        <div class="flex items-baseline gap-2 mb-3">
            <span class="text-2xl font-black text-status-success">${closedPct}%</span>
            <span class="text-xs text-text-secondary">closed</span>
        </div>
        <!-- Horizontal stacked bar -->
        <div class="w-full h-2.5 rounded-full overflow-hidden flex mb-3">
            ${data.map(d => {
                const pct = total > 0 ? (d.value / total) * 100 : 0;
                return pct > 0 ? `<div style="width:${pct}%;background:${d.color}" class="h-full"></div>` : '';
            }).join('')}
        </div>
        <!-- Prominent state numbers in 2x2 grid -->
        <div class="grid grid-cols-2 gap-2">
            ${data.map(d => `
                <div class="flex items-center gap-2 p-1.5 rounded-lg" style="background: ${d.color}10">
                    <span class="w-2 h-2 rounded-sm shrink-0" style="background:${d.color}"></span>
                    <div class="flex flex-col">
                        <span class="text-lg font-black text-text-primary leading-tight">${d.value}</span>
                        <span class="text-[10px] text-text-secondary">${d.label}</span>
                    </div>
                </div>
            `).join('')}
        </div>
    `;
}

// ==================== V6.24 WIDGET: Cases Timeline (stacked bars + interactions overlay) ====================
let casesTimelineMode = 'status'; // 'status' or 'severity'
function renderCasesTimeline() {
    const container = document.getElementById('widget-cases-timeline');
    if (!container) return;

    const timeline = DEMO_DATA.casesTimeline?.[dashboardTimeframe] || DEMO_DATA.casesTimeline?.['30d'];
    const metrics = DEMO_DATA.metricsByTimeframe?.[dashboardTimeframe] || {};
    if (!timeline) return;

    const totalCases = (DEMO_DATA.casesByStatus?.[dashboardTimeframe]?.open || 0) +
                       (DEMO_DATA.casesByStatus?.[dashboardTimeframe]?.assigned || 0) +
                       (DEMO_DATA.casesByStatus?.[dashboardTimeframe]?.unassigned || 0) +
                       (DEMO_DATA.casesByStatus?.[dashboardTimeframe]?.closed || 0);
    const totalInteractions = metrics.totalInteractions || 0;

    container.innerHTML = `
        <div class="flex items-center justify-between mb-2">
            <div class="flex items-center gap-3">
                <h3 class="text-sm font-bold text-text-primary uppercase tracking-wide flex items-center gap-2">
                    <span class="material-symbols-outlined text-primary text-[18px]">cases</span>
                    Cases
                </h3>
                <!-- Picker toggle -->
                <div class="flex items-center bg-surface-card rounded-lg border border-border-subtle overflow-hidden">
                    <button onclick="setCasesTimelineMode('status')" class="px-2.5 py-1 text-[10px] font-bold transition-colors ${casesTimelineMode === 'status' ? 'bg-primary text-white' : 'text-text-secondary hover:text-text-primary'}">Status</button>
                    <button onclick="setCasesTimelineMode('severity')" class="px-2.5 py-1 text-[10px] font-bold transition-colors ${casesTimelineMode === 'severity' ? 'bg-primary text-white' : 'text-text-secondary hover:text-text-primary'}">Severity</button>
                </div>
            </div>
            <div class="flex items-center gap-1">
                ${renderExportButton('cases-timeline')}
            </div>
        </div>
        <!-- KPI summary -->
        <div class="flex items-center gap-4 mb-3">
            <div class="flex items-baseline gap-1.5">
                <span class="text-2xl font-black text-text-primary">${totalCases}</span>
                <span class="text-[11px] text-text-secondary">total cases</span>
            </div>
            <div class="w-px h-6 bg-border-subtle"></div>
            <div class="flex items-baseline gap-1.5">
                <span class="text-2xl font-black text-accent-teal">${totalInteractions.toLocaleString()}</span>
                <span class="text-[11px] text-text-secondary">interactions analyzed</span>
            </div>
        </div>
        <!-- Prominent chart -->
        <div class="flex-1 flex items-end" style="min-height: 140px;">
            ${renderCasesStackedBarChart(timeline, casesTimelineMode)}
        </div>
        <!-- Legend -->
        <div class="flex items-center gap-3 mt-2 pt-2 border-t border-border-subtle flex-wrap">
            ${casesTimelineMode === 'status' ? `
                <span class="flex items-center gap-1 text-[10px] text-text-secondary"><span class="inline-block w-2.5 h-2.5 rounded-sm" style="background:#22c55e"></span>Closed</span>
                <span class="flex items-center gap-1 text-[10px] text-text-secondary"><span class="inline-block w-2.5 h-2.5 rounded-sm" style="background:#3b82f6"></span>Open</span>
            ` : `
                <span class="flex items-center gap-1 text-[10px] text-text-secondary"><span class="inline-block w-2.5 h-2.5 rounded-sm" style="background:#dc2626"></span>Critical</span>
                <span class="flex items-center gap-1 text-[10px] text-text-secondary"><span class="inline-block w-2.5 h-2.5 rounded-sm" style="background:#f97316"></span>High</span>
                <span class="flex items-center gap-1 text-[10px] text-text-secondary"><span class="inline-block w-2.5 h-2.5 rounded-sm" style="background:#eab308"></span>Medium</span>
                <span class="flex items-center gap-1 text-[10px] text-text-secondary"><span class="inline-block w-2.5 h-2.5 rounded-sm" style="background:#22c55e"></span>Low</span>
            `}
            <span class="flex items-center gap-1 text-[10px] text-text-secondary ml-auto"><span class="inline-block w-3 h-[2px] rounded-full" style="background:#22D3EE"></span>Interactions (scaled)</span>
        </div>
    `;
}

function setCasesTimelineMode(mode) {
    casesTimelineMode = mode;
    renderCasesTimeline();
}

// V6.24 HELPER: Stacked bar chart with interactions line overlay
function renderCasesStackedBarChart(timeline, mode) {
    if (!timeline || !timeline.labels) return '';

    const labels = timeline.labels;
    const n = labels.length;

    // Build stacks
    let stacks;
    if (mode === 'status') {
        stacks = [
            { key: 'closed', color: '#22c55e', values: timeline.closed },
            { key: 'open', color: '#3b82f6', values: timeline.open }
        ];
    } else {
        stacks = [
            { key: 'low', color: '#22c55e', values: timeline.low },
            { key: 'medium', color: '#eab308', values: timeline.medium },
            { key: 'high', color: '#f97316', values: timeline.high },
            { key: 'critical', color: '#dc2626', values: timeline.critical }
        ];
    }

    // Compute totals per bar
    const totals = labels.map((_, i) => stacks.reduce((sum, s) => sum + (s.values[i] || 0), 0));
    const maxTotal = Math.max(...totals, 1);

    const width = 600;
    const height = 150;
    const pad = { top: 20, bottom: 24, left: 8, right: 8 };
    const chartW = width - pad.left - pad.right;
    const chartH = height - pad.top - pad.bottom;
    const barGap = chartW * 0.15 / n; // gap between bars
    const barWidth = (chartW - barGap * (n + 1)) / n;

    // Build stacked bars
    let bars = '';
    for (let i = 0; i < n; i++) {
        const x = pad.left + barGap + i * (barWidth + barGap);
        let yOffset = pad.top + chartH; // start from bottom

        for (const stack of stacks) {
            const val = stack.values[i] || 0;
            const barH = (val / maxTotal) * chartH;
            if (barH > 0) {
                yOffset -= barH;
                const isBottom = stack === stacks[0];
                const isTop = stack === stacks[stacks.length - 1] || stacks.slice(stacks.indexOf(stack) + 1).every(s => (s.values[i] || 0) === 0);
                const rx = isTop ? 4 : 0;
                const rxB = isBottom ? 4 : 0;

                if (isTop && isBottom) {
                    bars += `<rect x="${x}" y="${yOffset}" width="${barWidth}" height="${barH}" rx="4" fill="${stack.color}" opacity="0.85"/>`;
                } else if (isTop) {
                    bars += `<path d="M${x},${yOffset + barH} L${x},${yOffset + rx} Q${x},${yOffset} ${x + rx},${yOffset} L${x + barWidth - rx},${yOffset} Q${x + barWidth},${yOffset} ${x + barWidth},${yOffset + rx} L${x + barWidth},${yOffset + barH} Z" fill="${stack.color}" opacity="0.85"/>`;
                } else {
                    bars += `<rect x="${x}" y="${yOffset}" width="${barWidth}" height="${barH}" fill="${stack.color}" opacity="0.85"/>`;
                }
            }
        }

        // Total label above bar
        const totalY = pad.top + chartH - (totals[i] / maxTotal) * chartH - 6;
        bars += `<text x="${x + barWidth / 2}" y="${totalY}" text-anchor="middle" style="font-size:10px;font-weight:700;fill:var(--color-text-primary,#1e293b);font-family:JetBrains Mono,monospace">${totals[i]}</text>`;
    }

    // Interactions line overlay (scaled to chart area)
    const interactions = timeline.interactions;
    let interactionsLine = '';
    if (interactions && interactions.length > 0) {
        const maxInt = Math.max(...interactions, 1);
        const intPts = interactions.map((v, i) => {
            const x = pad.left + barGap + i * (barWidth + barGap) + barWidth / 2;
            const y = pad.top + chartH - (v / maxInt) * chartH * 0.85; // scale to 85% height
            return { x, y, v };
        });
        const intLine = intPts.map(p => `${p.x},${p.y}`).join(' ');
        interactionsLine = `
            <polyline points="${intLine}" fill="none" stroke="#22D3EE" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" stroke-dasharray="6,3" opacity="0.7"/>
            ${intPts.map(p => `<circle cx="${p.x}" cy="${p.y}" r="3" fill="#22D3EE" stroke="white" stroke-width="1.5"/>`).join('')}
        `;

        // Add interaction labels (abbreviated)
        const fmtInt = (v) => {
            if (v >= 1000000) return (v / 1000000).toFixed(1) + 'M';
            if (v >= 1000) return Math.round(v / 1000) + 'K';
            return v.toString();
        };
        interactionsLine += intPts.map(p =>
            `<text x="${p.x}" y="${p.y - 7}" text-anchor="middle" style="font-size:8px;font-weight:600;fill:#22D3EE;font-family:JetBrains Mono,monospace">${fmtInt(p.v)}</text>`
        ).join('');
    }

    // X-axis labels
    const xLabels = labels.map((lbl, i) => {
        const x = pad.left + barGap + i * (barWidth + barGap) + barWidth / 2;
        return `<text x="${x}" y="${height - 4}" text-anchor="middle" style="font-size:10px;fill:var(--color-text-muted,#94a3b8);font-family:Manrope,sans-serif;font-weight:500">${lbl}</text>`;
    }).join('');

    // Horizontal grid lines
    const gridLines = [0.25, 0.5, 0.75].map(pct => {
        const y = pad.top + chartH - pct * chartH;
        return `<line x1="${pad.left}" y1="${y}" x2="${width - pad.right}" y2="${y}" stroke="var(--color-border-subtle,#e2e8f0)" stroke-width="0.5" stroke-dasharray="4,4" opacity="0.5"/>`;
    }).join('');

    return `
        <svg width="${width}" height="${height}" viewBox="0 0 ${width} ${height}" class="w-full" preserveAspectRatio="xMidYMid meet">
            <!-- Grid -->
            <line x1="${pad.left}" y1="${pad.top + chartH}" x2="${width - pad.right}" y2="${pad.top + chartH}" stroke="var(--color-border-subtle,#e2e8f0)" stroke-width="1"/>
            ${gridLines}
            <!-- Bars -->
            ${bars}
            <!-- Interactions line -->
            ${interactionsLine}
            <!-- Labels -->
            ${xLabels}
        </svg>
    `;
}

// ==================== V6.24 WIDGET: AXIA Actions (Donut Chart) ====================
function renderAxiaActionsPie() {
    const container = document.getElementById('widget-axia-actions');
    if (!container) return;

    const actions = DEMO_DATA.axiaActionsByTimeframe?.[dashboardTimeframe] || DEMO_DATA.axiaActionsByTimeframe?.['30d'] || {};
    const data = [
        { label: 'Employee', value: actions.employee || 0, color: '#6366f1' },
        { label: 'Manager', value: actions.manager || 0, color: '#8b5cf6' },
        { label: 'Guide', value: actions.smartLeakageControl || 0, color: '#22c55e' },
        { label: 'DLP Adj', value: actions.dlpAdjustment || 0, color: '#06b6d4' },
        { label: 'HR', value: actions.hr || 0, color: '#f59e0b' },
        { label: 'Legal', value: actions.legal || 0, color: '#dc2626' }
    ];
    const total = data.reduce((sum, d) => sum + d.value, 0);

    // V6.24: Donut chart with legend
    container.innerHTML = `
        <div class="flex items-center justify-between mb-2">
            <h3 class="text-xs font-bold text-text-primary uppercase tracking-wide">AXIA Actions</h3>
            <div class="flex items-center gap-1">
                ${renderExportButton('axia-actions')}
            </div>
        </div>
        <div class="flex-1 flex flex-col items-center justify-center gap-2">
            <div class="shrink-0">${renderPieChart(data, 110, true, 'Total')}</div>
            <div class="flex flex-wrap justify-center gap-x-3 gap-y-1">
                ${data.map(d => `
                    <div class="flex items-center gap-1">
                        <span class="w-2 h-2 rounded-sm shrink-0" style="background: ${d.color}"></span>
                        <span class="text-[10px] text-text-secondary">${d.label}</span>
                        <span class="text-[10px] font-bold text-text-primary">${d.value}</span>
                    </div>
                `).join('')}
            </div>
        </div>
    `;
}

// V6.21 HELPER: Vertical bars for AXIA Actions (fixed sizing)
function renderVerticalStackedBars(data) {
    if (!data || data.length === 0) return '';
    const maxVal = Math.max(...data.map(d => d.value), 1);
    const colWidth = 48;
    const barWidth = 24;
    const chartHeight = 80;
    const topPad = 16;  // space for value labels above bars
    const labelHeight = 14;
    const totalWidth = data.length * colWidth;
    const svgHeight = topPad + chartHeight + labelHeight;

    const bars = data.map((d, i) => {
        const cx = i * colWidth + colWidth / 2;
        const barX = cx - barWidth / 2;
        const barH = Math.max((d.value / maxVal) * chartHeight, d.value > 0 ? 3 : 0);
        const barY = topPad + chartHeight - barH;
        return `
            <rect x="${barX}" y="${barY}" width="${barWidth}" height="${barH}" rx="3" fill="${d.color}" opacity="0.85"/>
            <text x="${cx}" y="${barY - 4}" text-anchor="middle" style="font-size:9px;font-weight:700;fill:var(--color-text-primary,#1e293b);font-family:Manrope,sans-serif">${d.value}</text>
            <text x="${cx}" y="${topPad + chartHeight + 11}" text-anchor="middle" style="font-size:8px;fill:var(--color-text-secondary,#64748b);font-family:Manrope,sans-serif">${d.label}</text>
        `;
    }).join('');

    return `
        <svg width="${totalWidth}" height="${svgHeight}" viewBox="0 0 ${totalWidth} ${svgHeight}" class="w-full" style="max-width:${totalWidth}px">
            ${bars}
        </svg>
    `;
}

// ==================== V6.24 WIDGET: Total Alerts vs True Cases (expanded, prominent) ====================
function renderFalseAlarmsChart() {
    const container = document.getElementById('widget-false-alarms');
    if (!container) return;

    const trend = DEMO_DATA.falseAlarmsTrend?.[dashboardTimeframe] || DEMO_DATA.falseAlarmsTrend?.['30d'];
    const dlpTotal = trend?.dlpAlerts?.reduce((a, b) => a + b, 0) || 0;
    const axiaTotal = trend?.axiaTrueAlerts?.reduce((a, b) => a + b, 0) || 0;
    const noiseReduction = dlpTotal > 0 ? Math.round((1 - axiaTotal / dlpTotal) * 100) : 0;

    // V6.24: Expanded layout for col-span-6, more prominent chart
    container.innerHTML = `
        <div class="flex items-center justify-between mb-2">
            <h3 class="text-sm font-bold text-text-primary uppercase tracking-wide flex items-center gap-2">
                <span class="material-symbols-outlined text-status-success text-[18px]">filter_alt</span>
                Total Alerts vs. True Cases
            </h3>
            <div class="flex items-center gap-1">
                ${renderExportButton('signal-noise')}
            </div>
        </div>
        <!-- KPI row -->
        <div class="flex items-center gap-4 mb-3">
            <div class="flex items-baseline gap-1.5">
                <span class="text-2xl font-black text-status-success">${noiseReduction}%</span>
                <span class="text-[11px] text-text-secondary">noise reduced</span>
            </div>
            <div class="w-px h-6 bg-border-subtle"></div>
            <div class="flex items-baseline gap-1.5">
                <span class="text-lg font-bold" style="color:#1a2332">${dlpTotal.toLocaleString()}</span>
                <span class="text-[11px] text-text-secondary">DLP alerts</span>
            </div>
            <div class="flex items-baseline gap-1.5">
                <span class="text-lg font-bold text-status-success">${axiaTotal.toLocaleString()}</span>
                <span class="text-[11px] text-text-secondary">true cases</span>
            </div>
        </div>
        <!-- Prominent chart -->
        <div class="flex-1 flex items-end" style="min-height: 110px;">
            ${trend ? renderDualAreaChart(trend.dlpAlerts, trend.axiaTrueAlerts, trend.labels, '#1a2332', '#22c55e', 120, 400) : '<div class="text-text-secondary text-xs">No trend data</div>'}
        </div>
        <!-- Legend -->
        <div class="flex items-center gap-4 mt-2 pt-2 border-t border-border-subtle">
            <span class="flex items-center gap-1.5 text-[11px] text-text-secondary"><span class="inline-block w-3 h-[3px] rounded-full" style="background:#1a2332"></span>DLP Alerts (raw)</span>
            <span class="flex items-center gap-1.5 text-[11px] text-text-secondary"><span class="inline-block w-3 h-[3px] rounded-full" style="background:#22c55e"></span>AXIA True Cases</span>
        </div>
    `;
}

// ==================== V6.2 WIDGET: True Alarms (VALUE PROOF Bar) ====================
function renderTrueAlarmsBar() {
    const container = document.getElementById('widget-true-alarms');
    if (!container) return;

    const comparison = DEMO_DATA.trueAlarmsComparison?.[dashboardTimeframe] || DEMO_DATA.trueAlarmsComparison?.['30d'] || {};
    const axia = comparison.axiaDiscovered || 0;
    const dlp = comparison.dlpDiscovered || 0;
    const max = Math.max(axia, dlp, 1);
    const improvement = dlp > 0 ? Math.round((axia / dlp - 1) * 100) : 0;

    container.innerHTML = `
        <div class="flex items-center justify-between mb-2">
            <h3 class="text-xs font-bold text-text-primary uppercase tracking-wide flex items-center gap-1">
                <span class="material-symbols-outlined text-primary text-[14px]">verified</span>
                True Incidents Found
            </h3>
            <span class="text-[10px] font-bold text-primary">+${improvement}% more</span>
        </div>
        <div class="flex-1 flex flex-col justify-center gap-3">
            <div>
                <div class="flex items-center justify-between text-[11px] mb-1">
                    <span class="font-bold text-primary">AXIA</span>
                    <span class="font-black text-lg text-primary">${axia}</span>
                </div>
                <div class="w-full h-6 bg-surface-elevated rounded-lg overflow-hidden">
                    <div class="h-full bg-primary rounded-lg transition-all duration-500" style="width: ${(axia / max) * 100}%"></div>
                </div>
            </div>
            <div>
                <div class="flex items-center justify-between text-[11px] mb-1">
                    <span class="font-medium text-text-secondary">DLP Only</span>
                    <span class="font-bold text-text-secondary">${dlp}</span>
                </div>
                <div class="w-full h-4 bg-surface-elevated rounded-lg overflow-hidden">
                    <div class="h-full bg-gray-400 rounded-lg transition-all duration-500" style="width: ${(dlp / max) * 100}%"></div>
                </div>
            </div>
        </div>
        <div class="text-[10px] text-text-secondary mt-2 pt-2 border-t border-border-subtle text-center">
            AXIA finds more real threats than DLP alone
        </div>
    `;
}

// ==================== V6.21 WIDGET: MTTR (Value + Trend Sparkline) ====================
function renderMttrChart() {
    const container = document.getElementById('widget-mttr');
    if (!container) return;

    const trend = DEMO_DATA.mttrTrend?.[dashboardTimeframe] || DEMO_DATA.mttrTrend?.['30d'];
    const sla = DEMO_DATA.mttrTrend?.slaTarget || 2.0;
    const current = trend?.values?.[trend.values.length - 1] || 0;
    const first = trend?.values?.[0] || current;
    const belowSla = current <= sla;
    const improvement = first > 0 ? Math.round((1 - current / first) * 100) : 0;
    const valueColor = belowSla ? '#22c55e' : '#f59e0b';

    // Format value: show "48h" or "4.2h" or "0.5h"
    const fmtVal = (v) => v >= 10 ? Math.round(v) + 'h' : v.toFixed(1) + 'h';

    // V6.23: Tighter layout, reduced white space
    container.innerHTML = `
        <div class="flex items-center justify-between mb-1">
            <h3 class="text-xs font-bold text-text-primary uppercase tracking-wide">MTTR</h3>
            <div class="flex items-center gap-1">
                <span class="text-[10px] font-bold ${belowSla ? 'text-status-success' : 'text-severity-medium'}">${belowSla ? '✓ Below' : '✗ Above'} SLA</span>
                ${renderExportButton('mttr')}
            </div>
        </div>
        <div class="flex-1 flex flex-col justify-center">
            <div class="flex items-baseline gap-2 mb-1">
                <span class="text-3xl font-black" style="color:${valueColor}">${fmtVal(current)}</span>
                ${improvement > 0 ? `<span class="text-xs font-bold text-status-success">↓ ${improvement}%</span>` : ''}
            </div>
            <div class="text-[9px] text-text-secondary mb-1">SLA Target: ${sla}h</div>
            <div class="flex-1 flex items-end">
                ${trend ? renderAreaChart(trend.values, trend.labels, valueColor, valueColor, 50, 200) : ''}
            </div>
            <div class="flex justify-between text-[9px] text-text-muted mt-0.5">
                <span>${fmtVal(first)}</span>
                <span class="font-bold" style="color:${valueColor}">${fmtVal(current)}</span>
            </div>
        </div>
    `;
}

// ==================== V6.20 WIDGET: Department Risk Heatmap (Grid) ====================
let deptHeatmapFilter = 'total';
function renderDeptHeatmapPie() {
    const container = document.getElementById('widget-dept-heatmap');
    if (!container) return;

    const deptRisk = DEMO_DATA.departmentRiskByTimeframe?.[dashboardTimeframe] || DEMO_DATA.departmentRiskByTimeframe?.['30d'] || {};

    // V6.23: Full-width layout with reduced severities
    container.innerHTML = `
        <div class="flex items-center justify-between mb-2">
            <h3 class="text-xs font-bold text-text-primary uppercase tracking-wide">Departments</h3>
            <div class="flex items-center gap-1">
                ${renderExportButton('departments')}
            </div>
        </div>
        <div class="flex-1">
            ${renderHeatmapGrid(deptRisk)}
        </div>
    `;
}

function setDeptFilter(filter) {
    deptHeatmapFilter = filter;
    renderDeptHeatmapPie();
}

// ==================== V6.21 WIDGET: Top Case Types ====================
function renderTopCaseTypes() {
    const container = document.getElementById('widget-case-types');
    if (!container) return;

    const types = DEMO_DATA.caseTypesByTimeframe?.[dashboardTimeframe] || DEMO_DATA.caseTypesByTimeframe?.['30d'] || [];
    const maxCount = types.length > 0 ? types[0].count : 1;

    container.innerHTML = `
        <div class="flex items-center justify-between mb-3">
            <h3 class="text-xs font-bold text-text-primary uppercase tracking-wide">Top Case Types</h3>
            <div class="flex items-center gap-1">
                ${renderExportButton('case-types')}
            </div>
        </div>
        <div class="flex-1 flex flex-col justify-center gap-2">
            ${types.map(t => {
                const pct = Math.round((t.count / maxCount) * 100);
                return `
                    <div class="flex items-center gap-2">
                        <span class="material-symbols-outlined text-text-secondary text-[14px] shrink-0">${t.icon}</span>
                        <div class="flex-1 min-w-0">
                            <div class="flex justify-between items-center mb-0.5">
                                <span class="text-[11px] text-text-primary font-medium truncate">${t.type}</span>
                                <span class="text-[11px] font-bold text-text-primary shrink-0 ml-2">${t.count}</span>
                            </div>
                            <div class="w-full h-1.5 bg-surface-elevated rounded-full overflow-hidden">
                                <div class="h-full bg-primary/60 rounded-full" style="width:${pct}%"></div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('')}
        </div>
    `;
}

// ==================== V6.20 HELPER: Render SVG Donut/Pie Chart ====================
function renderPieChart(data, size = 80, donut = false, centerText = '') {
    const total = data.reduce((sum, d) => sum + d.value, 0);
    if (total === 0) return '<div class="text-text-secondary text-xs">No data</div>';

    const cx = size / 2;
    const cy = size / 2;
    const outerR = size / 2 - 4;
    const innerR = donut ? outerR * 0.6 : 0;
    let startAngle = -90;

    const paths = data.map(d => {
        const angle = (d.value / total) * 360;
        const endAngle = startAngle + angle;
        const largeArc = angle > 180 ? 1 : 0;
        const toRad = (deg) => (deg * Math.PI) / 180;

        if (donut) {
            // Donut arc segment
            const ox1 = cx + outerR * Math.cos(toRad(startAngle));
            const oy1 = cy + outerR * Math.sin(toRad(startAngle));
            const ox2 = cx + outerR * Math.cos(toRad(endAngle));
            const oy2 = cy + outerR * Math.sin(toRad(endAngle));
            const ix1 = cx + innerR * Math.cos(toRad(endAngle));
            const iy1 = cy + innerR * Math.sin(toRad(endAngle));
            const ix2 = cx + innerR * Math.cos(toRad(startAngle));
            const iy2 = cy + innerR * Math.sin(toRad(startAngle));

            const path = `M ${ox1} ${oy1} A ${outerR} ${outerR} 0 ${largeArc} 1 ${ox2} ${oy2} L ${ix1} ${iy1} A ${innerR} ${innerR} 0 ${largeArc} 0 ${ix2} ${iy2} Z`;
            startAngle = endAngle;
            return `<path d="${path}" fill="${d.color}" stroke="white" stroke-width="1.5"/>`;
        } else {
            // Filled pie slice
            const x1 = cx + outerR * Math.cos(toRad(startAngle));
            const y1 = cy + outerR * Math.sin(toRad(startAngle));
            const x2 = cx + outerR * Math.cos(toRad(endAngle));
            const y2 = cy + outerR * Math.sin(toRad(endAngle));
            const path = `M ${cx} ${cy} L ${x1} ${y1} A ${outerR} ${outerR} 0 ${largeArc} 1 ${x2} ${y2} Z`;
            startAngle = endAngle;
            return `<path d="${path}" fill="${d.color}" stroke="white" stroke-width="1"/>`;
        }
    }).join('');

    const centerEl = (donut && centerText) ? `
        <text x="${cx}" y="${cy - 4}" text-anchor="middle" style="font-size:${size > 100 ? 18 : 14}px;font-weight:900;fill:var(--color-text-primary,#1e293b);font-family:Manrope,sans-serif">${total}</text>
        <text x="${cx}" y="${cy + 10}" text-anchor="middle" style="font-size:${size > 100 ? 10 : 8}px;fill:var(--color-text-secondary,#64748b);font-family:Manrope,sans-serif">${centerText}</text>
    ` : '';

    return `<svg width="${size}" height="${size}" viewBox="0 0 ${size} ${size}">${paths}${centerEl}</svg>`;
}

// ==================== V6.2 HELPER: Render Mini Line Chart ====================
function renderMiniLineChart(values, color, height = 60, slaLine = null) {
    if (!values || values.length === 0) return '';

    const width = 120;
    const max = Math.max(...values, slaLine || 0, 1);
    const min = 0;
    const range = max - min;

    const points = values.map((v, i) => {
        const x = (i / (values.length - 1)) * width;
        const y = height - ((v - min) / range) * height;
        return `${x},${y}`;
    }).join(' ');

    let slaLineEl = '';
    if (slaLine !== null) {
        const slaY = height - ((slaLine - min) / range) * height;
        slaLineEl = `<line x1="0" y1="${slaY}" x2="${width}" y2="${slaY}" stroke="#ef4444" stroke-width="1" stroke-dasharray="3,3" opacity="0.5"/>`;
    }

    return `
        <svg width="${width}" height="${height}" viewBox="0 0 ${width} ${height}" class="w-full">
            ${slaLineEl}
            <polyline points="${points}" fill="none" stroke="${color}" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
    `;
}

// ==================== V6.2 HELPER: Render Dual Line Chart ====================
function renderDualLineChart(values1, values2, color1, color2, height = 60) {
    if (!values1 || !values2) return '';

    const width = 120;
    const max = Math.max(...values1, ...values2, 1);

    const points1 = values1.map((v, i) => {
        const x = (i / (values1.length - 1)) * width;
        const y = height - (v / max) * height;
        return `${x},${y}`;
    }).join(' ');

    const points2 = values2.map((v, i) => {
        const x = (i / (values2.length - 1)) * width;
        const y = height - (v / max) * height;
        return `${x},${y}`;
    }).join(' ');

    return `
        <svg width="${width}" height="${height}" viewBox="0 0 ${width} ${height}" class="w-full">
            <polyline points="${points1}" fill="none" stroke="${color1}" stroke-width="2" stroke-linecap="round" opacity="0.6"/>
            <polyline points="${points2}" fill="none" stroke="${color2}" stroke-width="2" stroke-linecap="round"/>
        </svg>
    `;
}

// ==================== V6.18 HELPER: Render Area Chart with Labels ====================
function renderAreaChart(values, labels, color, fillColor, height = 80, width = 200) {
    if (!values || values.length === 0) return '';
    const pad = { top: 4, bottom: 16, left: 4, right: 4 };
    const chartW = width - pad.left - pad.right;
    const chartH = height - pad.top - pad.bottom;
    const max = Math.max(...values, 1);
    const min = 0;
    const range = max - min || 1;

    const pts = values.map((v, i) => {
        const x = pad.left + (values.length === 1 ? chartW / 2 : (i / (values.length - 1)) * chartW);
        const y = pad.top + chartH - ((v - min) / range) * chartH;
        return { x, y };
    });

    const linePoints = pts.map(p => `${p.x},${p.y}`).join(' ');
    const fillPoints = `${pts[0].x},${pad.top + chartH} ${linePoints} ${pts[pts.length - 1].x},${pad.top + chartH}`;

    const labelEls = (labels || []).map((lbl, i) => {
        const x = pad.left + (labels.length === 1 ? chartW / 2 : (i / (labels.length - 1)) * chartW);
        return `<text x="${x}" y="${height - 2}" text-anchor="middle" style="font-size:8px;fill:var(--color-text-muted,#94a3b8);font-family:Manrope,sans-serif">${lbl}</text>`;
    }).join('');

    // Dot on last point
    const last = pts[pts.length - 1];

    return `
        <svg width="${width}" height="${height}" viewBox="0 0 ${width} ${height}" class="w-full">
            <polygon points="${fillPoints}" fill="${fillColor}" opacity="0.18"/>
            <polyline points="${linePoints}" fill="none" stroke="${color}" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <circle cx="${last.x}" cy="${last.y}" r="3" fill="${color}"/>
            ${labelEls}
        </svg>
    `;
}

// ==================== V6.18 HELPER: Render Dual Area Chart ====================
function renderDualAreaChart(values1, values2, labels, color1, color2, height = 80, width = 200) {
    if (!values1 || !values2) return '';
    const pad = { top: 4, bottom: 16, left: 4, right: 4 };
    const chartW = width - pad.left - pad.right;
    const chartH = height - pad.top - pad.bottom;
    const max = Math.max(...values1, ...values2, 1);

    const makePts = (vals) => vals.map((v, i) => {
        const x = pad.left + (vals.length === 1 ? chartW / 2 : (i / (vals.length - 1)) * chartW);
        const y = pad.top + chartH - (v / max) * chartH;
        return { x, y };
    });

    const pts1 = makePts(values1);
    const pts2 = makePts(values2);

    const line1 = pts1.map(p => `${p.x},${p.y}`).join(' ');
    const fill1 = `${pts1[0].x},${pad.top + chartH} ${line1} ${pts1[pts1.length - 1].x},${pad.top + chartH}`;
    const line2 = pts2.map(p => `${p.x},${p.y}`).join(' ');
    const fill2 = `${pts2[0].x},${pad.top + chartH} ${line2} ${pts2[pts2.length - 1].x},${pad.top + chartH}`;

    const labelEls = (labels || []).map((lbl, i) => {
        const x = pad.left + (labels.length === 1 ? chartW / 2 : (i / (labels.length - 1)) * chartW);
        return `<text x="${x}" y="${height - 2}" text-anchor="middle" style="font-size:8px;fill:var(--color-text-muted,#94a3b8);font-family:Manrope,sans-serif">${lbl}</text>`;
    }).join('');

    return `
        <svg width="${width}" height="${height}" viewBox="0 0 ${width} ${height}" class="w-full">
            <polygon points="${fill1}" fill="${color1}" opacity="0.12"/>
            <polyline points="${line1}" fill="none" stroke="${color1}" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" opacity="0.6"/>
            <polygon points="${fill2}" fill="${color2}" opacity="0.18"/>
            <polyline points="${line2}" fill="none" stroke="${color2}" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            ${labelEls}
        </svg>
    `;
}

// ==================== V6.18 HELPER: Render Stacked/Segmented Bar ====================
function renderStackedBar(data, width = 200) {
    const total = data.reduce((sum, d) => sum + d.value, 0);
    if (total === 0) return '<div class="text-text-secondary text-xs">No data</div>';

    let xOffset = 0;
    const barHeight = 20;
    const radius = 6;

    const segments = data.map((d, i) => {
        const segWidth = (d.value / total) * width;
        const x = xOffset;
        xOffset += segWidth;

        // First segment gets left radius, last gets right radius
        let rx = '0';
        let path = '';
        if (data.length === 1) {
            path = `<rect x="${x}" y="0" width="${segWidth}" height="${barHeight}" rx="${radius}" fill="${d.color}"/>`;
        } else if (i === 0) {
            path = `<path d="M${x + radius},0 L${x + segWidth},0 L${x + segWidth},${barHeight} L${x + radius},${barHeight} Q${x},${barHeight} ${x},${barHeight - radius} L${x},${radius} Q${x},0 ${x + radius},0 Z" fill="${d.color}"/>`;
        } else if (i === data.length - 1) {
            path = `<path d="M${x},0 L${x + segWidth - radius},0 Q${x + segWidth},0 ${x + segWidth},${radius} L${x + segWidth},${barHeight - radius} Q${x + segWidth},${barHeight} ${x + segWidth - radius},${barHeight} L${x},${barHeight} Z" fill="${d.color}"/>`;
        } else {
            path = `<rect x="${x}" y="0" width="${segWidth}" height="${barHeight}" fill="${d.color}"/>`;
        }
        return path;
    }).join('');

    return `
        <svg width="${width}" height="${barHeight}" viewBox="0 0 ${width} ${barHeight}" class="w-full" style="max-width: ${width}px">
            ${segments}
        </svg>
    `;
}

// ==================== V6.18 HELPER: Render Horizontal Bar Chart ====================
function renderHorizontalBars(data, maxWidth = 160, barHeight = 14, gap = 6) {
    if (!data || data.length === 0) return '<div class="text-text-secondary text-xs">No data</div>';

    const maxVal = Math.max(...data.map(d => d.value), 1);
    const totalHeight = data.length * (barHeight + gap) - gap;
    const labelWidth = 52;
    const countWidth = 24;
    const barStart = labelWidth + 4;
    const barMaxWidth = maxWidth - barStart - countWidth - 4;

    const bars = data.map((d, i) => {
        const y = i * (barHeight + gap);
        const barW = Math.max((d.value / maxVal) * barMaxWidth, d.value > 0 ? 4 : 0);
        return `
            <text x="${labelWidth}" y="${y + barHeight / 2 + 1}" text-anchor="end" class="fill-current text-text-secondary" style="font-size: 10px; font-family: Manrope, sans-serif;">${d.label}</text>
            <rect x="${barStart}" y="${y + 1}" width="${barW}" height="${barHeight - 2}" rx="3" fill="${d.color}" opacity="0.85"/>
            <text x="${barStart + barW + 4}" y="${y + barHeight / 2 + 1}" class="fill-current text-text-primary" style="font-size: 10px; font-weight: 700; font-family: Manrope, sans-serif;" dominant-baseline="middle">${d.value}</text>
        `;
    }).join('');

    return `
        <svg width="${maxWidth}" height="${totalHeight}" viewBox="0 0 ${maxWidth} ${totalHeight}" class="w-full" style="max-width: ${maxWidth}px">
            ${bars}
        </svg>
    `;
}

// ==================== V6.23 HELPER: Render Heatmap Grid (with totals, reduced severity columns) ====================
function renderHeatmapGrid(departments, severities = ['critical', 'high', 'medium']) {
    if (!departments || Object.keys(departments).length === 0) return '<div class="text-text-secondary text-xs">No data</div>';

    const sevColors = {
        critical: { bg: '#dc2626' },
        high: { bg: '#f97316' },
        medium: { bg: '#eab308' },
        low: { bg: '#22c55e' }
    };

    const sevLabels = { critical: 'C', high: 'H', medium: 'M', low: 'L' };

    const depts = Object.entries(departments)
        .filter(([_, d]) => d.cases > 0)
        .sort((a, b) => b[1].cases - a[1].cases);

    if (depts.length === 0) return '<div class="text-text-secondary text-xs">No cases</div>';

    const allVals = depts.flatMap(([_, d]) => severities.map(s => d[s] || 0));
    const maxVal = Math.max(...allVals, 1);

    // V6.23: Added Total column header
    const headerRow = `
        <div class="grid gap-1" style="grid-template-columns: minmax(80px, 1.2fr) 50px repeat(${severities.length}, 1fr)">
            <div></div>
            <div class="text-[10px] font-bold text-center uppercase tracking-wide text-text-primary">Total</div>
            ${severities.map(s => `<div class="text-[10px] font-bold text-center uppercase tracking-wide" style="color: ${sevColors[s].bg}">${sevLabels[s]}</div>`).join('')}
        </div>
    `;

    const rows = depts.map(([name, d]) => {
        // V6.23: Calculate department total
        const deptTotal = d.cases || 0;
        const cells = severities.map(s => {
            const val = d[s] || 0;
            const intensity = maxVal > 0 ? val / maxVal : 0;
            const bg = sevColors[s].bg;
            const alpha = val === 0 ? 0 : Math.max(0.25, Math.min(0.95, intensity * 0.75 + 0.25));
            const hexAlpha = val === 0 ? '' : Math.round(alpha * 255).toString(16).padStart(2, '0');
            const bgStyle = val === 0 ? 'background: var(--color-surface-elevated, #f1f5f9)' : `background-color: ${bg}${hexAlpha}`;
            const textColor = alpha > 0.5 ? '#fff' : (val === 0 ? 'var(--color-text-muted,#cbd5e1)' : '#1e293b');
            return `<div class="flex items-center justify-center rounded-sm" style="${bgStyle}; height: 26px;">
                <span style="font-size:10px;font-weight:700;color:${textColor}">${val > 0 ? val : ''}</span>
            </div>`;
        }).join('');
        return `
            <div class="grid gap-1 items-center" style="grid-template-columns: minmax(80px, 1.2fr) 50px repeat(${severities.length}, 1fr)">
                <div class="text-[10px] text-text-secondary truncate pr-1 font-medium">${name}</div>
                <div class="flex items-center justify-center rounded-sm" style="background: var(--color-surface-elevated, #f1f5f9); height: 26px;">
                    <span style="font-size:11px;font-weight:800;color:var(--color-text-primary,#1e293b)">${deptTotal}</span>
                </div>
                ${cells}
            </div>
        `;
    }).join('');

    return `${headerRow}<div class="flex flex-col gap-1 mt-1">${rows}</div>`;
}

// ==================== V6.18 HELPER: Render Gauge Arc ====================
function renderGaugeArc(current, target, maxVal, size = 120) {
    const cx = size / 2;
    const cy = size / 2 + 10;
    const r = size / 2 - 12;
    const startAngle = -210;
    const endAngle = 30;
    const totalArc = endAngle - startAngle; // 240 degrees

    // Target position on arc
    const targetAngle = startAngle + (Math.min(target, maxVal) / maxVal) * totalArc;
    // Current position on arc
    const currentAngle = startAngle + (Math.min(current, maxVal) / maxVal) * totalArc;

    const toRad = (deg) => (deg * Math.PI) / 180;

    // Background arc (full track)
    const bgX1 = cx + r * Math.cos(toRad(startAngle));
    const bgY1 = cy + r * Math.sin(toRad(startAngle));
    const bgX2 = cx + r * Math.cos(toRad(endAngle));
    const bgY2 = cy + r * Math.sin(toRad(endAngle));

    // Value arc
    const valX1 = cx + r * Math.cos(toRad(startAngle));
    const valY1 = cy + r * Math.sin(toRad(startAngle));
    const valX2 = cx + r * Math.cos(toRad(currentAngle));
    const valY2 = cy + r * Math.sin(toRad(currentAngle));
    const valLargeArc = (currentAngle - startAngle) > 180 ? 1 : 0;

    // SLA marker position
    const slaX = cx + r * Math.cos(toRad(targetAngle));
    const slaY = cy + r * Math.sin(toRad(targetAngle));
    const slaInnerX = cx + (r - 8) * Math.cos(toRad(targetAngle));
    const slaInnerY = cy + (r - 8) * Math.sin(toRad(targetAngle));
    const slaOuterX = cx + (r + 8) * Math.cos(toRad(targetAngle));
    const slaOuterY = cy + (r + 8) * Math.sin(toRad(targetAngle));

    const belowTarget = current <= target;
    const valueColor = belowTarget ? '#22c55e' : '#f59e0b';

    return `
        <svg width="${size}" height="${size * 0.7}" viewBox="0 0 ${size} ${size * 0.7 + 5}" class="w-full" style="max-width: ${size}px">
            <!-- Background track -->
            <path d="M ${bgX1} ${bgY1} A ${r} ${r} 0 1 1 ${bgX2} ${bgY2}" fill="none" stroke="var(--color-surface-elevated, #f1f5f9)" stroke-width="10" stroke-linecap="round"/>
            <!-- Value arc -->
            <path d="M ${valX1} ${valY1} A ${r} ${r} 0 ${valLargeArc} 1 ${valX2} ${valY2}" fill="none" stroke="${valueColor}" stroke-width="10" stroke-linecap="round"/>
            <!-- SLA target tick -->
            <line x1="${slaInnerX}" y1="${slaInnerY}" x2="${slaOuterX}" y2="${slaOuterY}" stroke="#ef4444" stroke-width="2.5" stroke-linecap="round"/>
            <!-- SLA label -->
            <text x="${slaOuterX + (slaOuterX > cx ? 3 : -3)}" y="${slaOuterY - 2}" text-anchor="${slaOuterX > cx ? 'start' : 'end'}" style="font-size: 8px; fill: #ef4444; font-family: Manrope, sans-serif; font-weight: 600;">SLA</text>
        </svg>
    `;
}

// ==================== V6.18 HELPER: Render Comparison Bars ====================
function renderComparisonBars(val1, label1, color1, val2, label2, color2, maxBarHeight = 70) {
    const maxVal = Math.max(val1, val2, 1);
    const h1 = Math.max((val1 / maxVal) * maxBarHeight, 4);
    const h2 = Math.max((val2 / maxVal) * maxBarHeight, 4);
    const barWidth = 44;
    const gap = 24;
    const topPad = 18; // space for number labels above bars
    const totalWidth = barWidth * 2 + gap;
    const totalHeight = topPad + maxBarHeight + 18;
    const barBase = topPad + maxBarHeight; // y where bars sit

    return `
        <svg width="${totalWidth}" height="${totalHeight}" viewBox="0 0 ${totalWidth} ${totalHeight}" class="w-full" style="max-width: ${totalWidth}px">
            <!-- Bar 1 -->
            <rect x="0" y="${barBase - h1}" width="${barWidth}" height="${h1}" rx="4" fill="${color1}" opacity="0.3"/>
            <text x="${barWidth / 2}" y="${barBase - h1 - 5}" text-anchor="middle" dominant-baseline="auto" style="font-size: 11px; font-weight: 800; fill: ${color1}; font-family: Manrope, sans-serif;">${val1}</text>
            <text x="${barWidth / 2}" y="${barBase + 13}" text-anchor="middle" style="font-size: 9px; fill: var(--color-text-secondary, #64748b); font-family: Manrope, sans-serif;">${label1}</text>
            <!-- Arrow -->
            <line x1="${barWidth + 4}" y1="${topPad + maxBarHeight / 2}" x2="${barWidth + gap - 4}" y2="${topPad + maxBarHeight / 2}" stroke="var(--color-text-muted, #94a3b8)" stroke-width="1.5" stroke-dasharray="3,2"/>
            <polygon points="${barWidth + gap - 4},${topPad + maxBarHeight / 2 - 3} ${barWidth + gap - 4},${topPad + maxBarHeight / 2 + 3} ${barWidth + gap},${topPad + maxBarHeight / 2}" fill="var(--color-text-muted, #94a3b8)"/>
            <!-- Bar 2 -->
            <rect x="${barWidth + gap}" y="${barBase - h2}" width="${barWidth}" height="${h2}" rx="4" fill="${color2}"/>
            <text x="${barWidth + gap + barWidth / 2}" y="${barBase - h2 - 5}" text-anchor="middle" dominant-baseline="auto" style="font-size: 11px; font-weight: 800; fill: ${color2}; font-family: Manrope, sans-serif;">${val2}</text>
            <text x="${barWidth + gap + barWidth / 2}" y="${barBase + 13}" text-anchor="middle" style="font-size: 9px; fill: var(--color-text-secondary, #64748b); font-family: Manrope, sans-serif;">${label2}</text>
        </svg>
    `;
}

// V5.10: Filter by department helper
function filterByDepartment(department) {
    // Navigate to cases screen filtered by department
    navigateTo('cases');
    // Could add department filter logic here in future
}

// ==================== V5.13: TREND CHART — controls below chart, added pie chart option ====================
function updateTrendChart() {
    const selector = document.getElementById('trend-metric-selector');
    const chartTypeSelect = document.getElementById('trend-chart-type');
    const container = document.getElementById('trend-chart-container');
    const legend = document.getElementById('trend-chart-legend');
    if (!selector || !container) return;

    const metric = selector.value;
    const chartType = chartTypeSelect ? chartTypeSelect.value : 'line';
    // V5.11: Use dashboardTimeframe (controlled by Dashboard header time selector)
    const timeframeDays = { '1d': 1, '7d': 7, '30d': 30, '90d': 90 };
    const days = timeframeDays[dashboardTimeframe] || 30;
    const tsData = DEMO_DATA.timeSeriesData;
    if (!tsData) {
        container.innerHTML = '<div class="flex items-center justify-center h-full text-text-secondary text-sm">No trend data available</div>';
        return;
    }

    const w = container.clientWidth || 340;
    const h = 200;
    const pad = { top: 15, right: 15, bottom: 25, left: 45 };
    const chartW = w - pad.left - pad.right;
    const chartH = h - pad.top - pad.bottom;

    // Helper: generate line path
    const linePath = (data, color, strokeWidth = 2) => {
        const pts = data.map((v, i) => {
            const x = pad.left + (i / (data.length - 1)) * chartW;
            const y = pad.top + chartH - (v / Math.max(...data, 1)) * chartH;
            return `${x},${y}`;
        });
        return `<polyline points="${pts.join(' ')}" fill="none" stroke="${color}" stroke-width="${strokeWidth}" stroke-linecap="round" stroke-linejoin="round"/>`;
    };

    // Helper: generate area path
    const areaPath = (data, color, opacity = 0.15) => {
        const max = Math.max(...data, 1);
        const pts = data.map((v, i) => {
            const x = pad.left + (i / (data.length - 1)) * chartW;
            const y = pad.top + chartH - (v / max) * chartH;
            return `${x},${y}`;
        });
        const baseline = pad.top + chartH;
        const first = pad.left;
        const last = pad.left + chartW;
        return `<polygon points="${first},${baseline} ${pts.join(' ')} ${last},${baseline}" fill="${color}" opacity="${opacity}"/>` +
               `<polyline points="${pts.join(' ')}" fill="none" stroke="${color}" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>`;
    };

    // Helper: generate bars for a single series
    const barSeries = (data, color, barW) => {
        const max = Math.max(...data, 1);
        return data.map((v, i) => {
            const barH = (v / max) * chartH;
            const x = pad.left + i * (chartW / data.length);
            const y = pad.top + chartH - barH;
            return `<rect x="${x}" y="${y}" width="${barW}" height="${barH}" fill="${color}" rx="1" opacity="0.8"/>`;
        }).join('');
    };

    // Helper: multi-line chart (used for cases-severity default and others)
    const multiLine = (series, colors, labels) => {
        const allVals = series.flat();
        const max = Math.max(...allVals, 1);
        let paths = '';
        series.forEach((data, idx) => {
            const sliced = data.slice(0, days);
            const pts = sliced.map((v, i) => {
                const x = pad.left + (i / (sliced.length - 1)) * chartW;
                const y = pad.top + chartH - (v / max) * chartH;
                return `${x},${y}`;
            });
            if (chartType === 'area') {
                const baseline = pad.top + chartH;
                const first = pad.left;
                const last = pad.left + ((sliced.length - 1) / (sliced.length - 1)) * chartW;
                paths += `<polygon points="${first},${baseline} ${pts.join(' ')} ${last},${baseline}" fill="${colors[idx]}" opacity="0.12"/>`;
            }
            paths += `<polyline points="${pts.join(' ')}" fill="none" stroke="${colors[idx]}" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>`;
        });
        return paths;
    };

    // Helper: multi-bar stacked
    const multiBarStacked = (series, colors) => {
        const slicedSeries = series.map(s => s.slice(0, days));
        const maxTotal = Math.max(...slicedSeries[0].map((_, i) => slicedSeries.reduce((sum, s) => sum + (s[i] || 0), 0)), 1);
        const barW = chartW / slicedSeries[0].length - 1;
        let bars = '';
        slicedSeries[0].forEach((_, i) => {
            let cumH = 0;
            const x = pad.left + i * (chartW / slicedSeries[0].length);
            // Draw from bottom to top
            for (let s = 0; s < slicedSeries.length; s++) {
                const val = slicedSeries[s][i] || 0;
                const segH = (val / maxTotal) * chartH;
                const y = pad.top + chartH - cumH - segH;
                bars += `<rect x="${x}" y="${y}" width="${barW}" height="${segH}" fill="${colors[s]}" rx="1"/>`;
                cumH += segH;
            }
        });
        return bars;
    };

    // V5.13: Pie chart helper
    const pieChart = (values, colors, labels) => {
        const total = values.reduce((s, v) => s + v, 0);
        if (total === 0) return '<text x="50%" y="50%" text-anchor="middle" fill="#9CA3AF" font-size="14">No data</text>';
        const cx = w / 2;
        const cy = h / 2;
        const r = Math.min(w, h) / 2 - 20;
        let startAngle = -Math.PI / 2; // Start at 12 o'clock
        let paths = '';
        values.forEach((val, i) => {
            if (val === 0) return;
            const angle = (val / total) * 2 * Math.PI;
            const endAngle = startAngle + angle;
            const largeArc = angle > Math.PI ? 1 : 0;
            const x1 = cx + r * Math.cos(startAngle);
            const y1 = cy + r * Math.sin(startAngle);
            const x2 = cx + r * Math.cos(endAngle);
            const y2 = cy + r * Math.sin(endAngle);
            paths += `<path d="M ${cx} ${cy} L ${x1} ${y1} A ${r} ${r} 0 ${largeArc} 1 ${x2} ${y2} Z" fill="${colors[i]}" opacity="0.85"/>`;
            // Add label at midpoint
            const midAngle = startAngle + angle / 2;
            const labelR = r * 0.65;
            const lx = cx + labelR * Math.cos(midAngle);
            const ly = cy + labelR * Math.sin(midAngle);
            if (val / total > 0.05) { // Only show label if slice is >5%
                paths += `<text x="${lx}" y="${ly}" text-anchor="middle" fill="white" font-size="11" font-weight="bold">${val}</text>`;
            }
            startAngle = endAngle;
        });
        return paths;
    };

    // Axes helper
    const axes = (maxLabel) => `
        <text x="${pad.left}" y="${h - 5}" font-size="11" fill="#9CA3AF">Day 1</text>
        <text x="${w - pad.right - 20}" y="${h - 5}" font-size="11" fill="#9CA3AF">Day ${days}</text>
        ${maxLabel ? `<text x="${pad.left - 5}" y="${pad.top + 10}" font-size="11" fill="#9CA3AF" text-anchor="end">${maxLabel}</text>` : ''}
        <line x1="${pad.left}" y1="${pad.top + chartH}" x2="${pad.left + chartW}" y2="${pad.top + chartH}" stroke="#E5E7EB" stroke-width="1"/>
    `;

    let svg = '';
    let legendHtml = '';

    if (metric === 'cases-severity') {
        // Default view: line graphs of cases by severity showing them declining over time
        const riskTrend = DEMO_DATA.riskTrend || [];
        const sliced = riskTrend.slice(0, days);
        const critData = sliced.map(d => d.critical);
        const highData = sliced.map(d => d.high);
        const medData = sliced.map(d => d.medium);
        const lowData = sliced.map(d => d.low);
        const series = [critData, highData, medData, lowData];
        const colors = ['#E74C3C', '#F39C12', '#3498DB', '#6B7280'];
        const allVals = series.flat();
        const max = Math.max(...allVals, 1);

        let content = '';
        if (chartType === 'pie') {
            // V5.13: Pie shows totals for the period
            const totals = [critData.reduce((a,b)=>a+b,0), highData.reduce((a,b)=>a+b,0), medData.reduce((a,b)=>a+b,0), lowData.reduce((a,b)=>a+b,0)];
            content = pieChart(totals, colors, ['Critical', 'High', 'Medium', 'Low']);
            svg = `<svg width="${w}" height="${h}" class="w-full">${content}</svg>`;
        } else if (chartType === 'bar') {
            content = multiBarStacked(series, colors);
            svg = `<svg width="${w}" height="${h}" class="w-full">${content}${axes(max)}</svg>`;
        } else {
            content = multiLine(series, colors, ['Critical', 'High', 'Medium', 'Low']);
            svg = `<svg width="${w}" height="${h}" class="w-full">${content}${axes(max)}</svg>`;
        }
        legendHtml = '<span class="flex items-center gap-1"><span class="w-3 h-0.5 bg-severity-critical"></span>Critical</span><span class="flex items-center gap-1"><span class="w-3 h-0.5 bg-severity-high"></span>High</span><span class="flex items-center gap-1"><span class="w-3 h-0.5 bg-severity-medium"></span>Medium</span><span class="flex items-center gap-1"><span class="w-3 h-0.5 bg-severity-low"></span>Low</span>';
    } else if (metric === 'interactions') {
        const data = (tsData.interactions || []).slice(0, days);
        const max = Math.max(...data, 1);
        let content = '';
        if (chartType === 'pie') {
            // V5.13: Pie not ideal for single series, show total as center text
            const total = data.reduce((a,b)=>a+b,0);
            content = `<circle cx="${w/2}" cy="${h/2}" r="${Math.min(w,h)/2-20}" fill="#09434e" opacity="0.85"/>
                      <text x="${w/2}" y="${h/2-8}" text-anchor="middle" fill="white" font-size="14" font-weight="bold">${total.toLocaleString()}</text>
                      <text x="${w/2}" y="${h/2+12}" text-anchor="middle" fill="white" font-size="11">Total</text>`;
            svg = `<svg width="${w}" height="${h}" class="w-full">${content}</svg>`;
        } else if (chartType === 'line') {
            content = linePath(data, '#09434e');
            svg = `<svg width="${w}" height="${h}" class="w-full">${content}${axes(max.toLocaleString())}</svg>`;
        } else if (chartType === 'area') {
            content = areaPath(data, '#09434e');
            svg = `<svg width="${w}" height="${h}" class="w-full">${content}${axes(max.toLocaleString())}</svg>`;
        } else {
            content = barSeries(data, '#09434e', chartW / data.length - 1);
            svg = `<svg width="${w}" height="${h}" class="w-full">${content}${axes(max.toLocaleString())}</svg>`;
        }
        legendHtml = '<span class="flex items-center gap-1"><span class="w-3 h-2 bg-primary rounded-sm"></span>Daily Interactions</span>';
    } else if (metric === 'cases') {
        const open = (tsData.cases?.open || []).slice(0, days);
        const closed = (tsData.cases?.closed || []).slice(0, days);
        const colors = ['#09434e', '#22C55E'];
        let content = '';
        if (chartType === 'pie') {
            const totals = [open.reduce((a,b)=>a+b,0), closed.reduce((a,b)=>a+b,0)];
            content = pieChart(totals, colors, ['Open', 'Closed']);
            svg = `<svg width="${w}" height="${h}" class="w-full">${content}</svg>`;
        } else if (chartType === 'bar') {
            content = multiBarStacked([open, closed], colors);
            svg = `<svg width="${w}" height="${h}" class="w-full">${content}${axes(Math.max(...open, ...closed, 1))}</svg>`;
        } else {
            content = multiLine([open, closed], colors, ['Open', 'Closed']);
            svg = `<svg width="${w}" height="${h}" class="w-full">${content}${axes(Math.max(...open, ...closed, 1))}</svg>`;
        }
        legendHtml = '<span class="flex items-center gap-1"><span class="w-3 h-0.5 bg-primary"></span>Open</span><span class="flex items-center gap-1"><span class="w-3 h-0.5 bg-status-success"></span>Closed</span>';
    } else if (metric === 'engagements') {
        const emp = (tsData.engagements?.employee || []).slice(0, days);
        const mgr = (tsData.engagements?.manager || []).slice(0, days);
        const legal = (tsData.engagements?.legal || []).slice(0, days);
        const colors = ['#22D3EE', '#8B5CF6', '#F39C12'];
        let content = '';
        if (chartType === 'pie') {
            const totals = [emp.reduce((a,b)=>a+b,0), mgr.reduce((a,b)=>a+b,0), legal.reduce((a,b)=>a+b,0)];
            content = pieChart(totals, colors, ['Employee', 'Manager', 'Legal']);
            svg = `<svg width="${w}" height="${h}" class="w-full">${content}</svg>`;
        } else if (chartType === 'bar') {
            content = multiBarStacked([emp, mgr, legal], colors);
            svg = `<svg width="${w}" height="${h}" class="w-full">${content}${axes(Math.max(...emp, ...mgr, ...legal, 1))}</svg>`;
        } else {
            content = multiLine([emp, mgr, legal], colors);
            svg = `<svg width="${w}" height="${h}" class="w-full">${content}${axes(Math.max(...emp, ...mgr, ...legal, 1))}</svg>`;
        }
        legendHtml = '<span class="flex items-center gap-1"><span class="w-3 h-0.5 bg-accent-teal"></span>Employee</span><span class="flex items-center gap-1"><span class="w-3 h-0.5" style="background:#8B5CF6"></span>Manager</span><span class="flex items-center gap-1"><span class="w-3 h-0.5 bg-severity-high"></span>Legal</span>';
    } else if (metric === 'dlp-alerts') {
        const crit = (tsData.dlpAlerts?.critical || []).slice(0, days);
        const med = (tsData.dlpAlerts?.medium || []).slice(0, days);
        const low = (tsData.dlpAlerts?.low || []).slice(0, days);
        const colors = ['#E74C3C', '#3498DB', '#6B7280'];
        let content = '';
        if (chartType === 'pie') {
            const totals = [crit.reduce((a,b)=>a+b,0), med.reduce((a,b)=>a+b,0), low.reduce((a,b)=>a+b,0)];
            content = pieChart(totals, colors, ['Critical', 'Medium', 'Low']);
            svg = `<svg width="${w}" height="${h}" class="w-full">${content}</svg>`;
        } else if (chartType === 'bar') {
            content = multiBarStacked([crit, med, low], colors);
            svg = `<svg width="${w}" height="${h}" class="w-full">${content}${axes(Math.max(...crit, ...med, ...low, 1))}</svg>`;
        } else {
            content = multiLine([crit, med, low], colors);
            svg = `<svg width="${w}" height="${h}" class="w-full">${content}${axes(Math.max(...crit, ...med, ...low, 1))}</svg>`;
        }
        legendHtml = '<span class="flex items-center gap-1"><span class="w-3 h-0.5 bg-severity-critical"></span>Critical</span><span class="flex items-center gap-1"><span class="w-3 h-0.5 bg-severity-medium"></span>Medium</span><span class="flex items-center gap-1"><span class="w-3 h-0.5 bg-severity-low"></span>Low</span>';
    } else if (metric === 'false-positives') {
        const fp = (tsData.dlpAlerts?.falsePositives || []).slice(0, days);
        const max = Math.max(...fp, 1);
        let content = '';
        if (chartType === 'line') content = linePath(fp, '#F59E0B');
        else if (chartType === 'area') content = areaPath(fp, '#F59E0B');
        else content = barSeries(fp, '#F59E0B', chartW / fp.length - 1);
        svg = `<svg width="${w}" height="${h}" class="w-full">${content}${axes(max)}</svg>`;
        legendHtml = '<span class="flex items-center gap-1"><span class="w-3 h-0.5 bg-status-warning"></span>False Positives</span>';
    } else if (metric === 'policy-blocked') {
        // Use engagements data as proxy (policy updates not in time series, show as flat)
        const emp = (tsData.engagements?.employee || []).slice(0, days);
        // Use DLP critical as proxy for blocked count
        const blocked = (tsData.dlpAlerts?.critical || []).slice(0, days).map(v => v * 8);
        const colors = ['#8B5CF6', '#EF4444'];
        let content = '';
        if (chartType === 'bar') content = multiBarStacked([emp.map(() => 1), blocked], colors);
        else content = multiLine([emp.map(() => 1), blocked], colors);
        const max = Math.max(...blocked, 1);
        svg = `<svg width="${w}" height="${h}" class="w-full">${content}${axes(max)}</svg>`;
        legendHtml = '<span class="flex items-center gap-1"><span class="w-3 h-0.5" style="background:#8B5CF6"></span>Policy Updates</span><span class="flex items-center gap-1"><span class="w-3 h-0.5 bg-status-blocked"></span>Blocked</span>';
    } else if (metric === 'mttr') {
        const data = (tsData.mttr || []).slice(0, days);
        const max = Math.max(...data, 1);
        let content = '';
        if (chartType === 'line') content = linePath(data, '#22C55E');
        else if (chartType === 'area') content = areaPath(data, '#22C55E');
        else content = barSeries(data, '#22C55E', chartW / data.length - 1);
        svg = `<svg width="${w}" height="${h}" class="w-full">${content}${axes(max + 'h')}</svg>`;
        legendHtml = '<span class="flex items-center gap-1"><span class="w-3 h-0.5 bg-status-success"></span>Avg Resolution Time (hrs)</span>';
    }

    container.innerHTML = svg;
    if (legend) legend.innerHTML = legendHtml;
}

function filterBySeverity(severity) {
    const dropdown = document.getElementById('severity-dropdown');
    dropdown.querySelectorAll('input').forEach(c => c.checked = c.value === severity);
    updateFilters();
    navigateTo('cases');
}

function loadMoreCases() {}

// ==================== TOUR CONTROLLER ====================
function startTour() {
    try {
        const modal = document.getElementById('welcome-modal');
        if (modal) {
            modal.classList.add('hidden');
            modal.style.display = 'none'; // Force hide as backup
        }
        tourActive = true;
        tourStep = 0;
        showTourStep();
    } catch (e) {
        console.error('startTour error:', e);
        // Still try to hide the modal
        const modal = document.getElementById('welcome-modal');
        if (modal) modal.style.display = 'none';
    }
}

function skipTour() {
    try {
        const modal = document.getElementById('welcome-modal');
        if (modal) {
            modal.classList.add('hidden');
            modal.style.display = 'none'; // Force hide as backup
        }
    } catch (e) {
        console.error('skipTour error:', e);
    }
}

function showTourStep() {
    const step = tourSteps[tourStep];
    const overlay = document.getElementById('tour-overlay');
    const tooltip = document.getElementById('tour-tooltip');

    // Execute action if caseId specified
    if (step.caseId) viewCase(step.caseId);

    // Navigate to correct screen
    if (step.screen !== currentScreen && step.screen !== 'case-details') {
        navigateTo(step.screen);
    }

    setTimeout(() => {
        overlay.classList.add('active');
        overlay.style.display = 'block'; // Override inline style
        tooltip.classList.remove('hidden');
        tooltip.style.display = 'block'; // Override inline style

        // Update progress
        document.getElementById('tour-progress').innerHTML = tourSteps.map((_, i) =>
            `<div class="tour-progress-dot ${i < tourStep ? 'completed' : ''} ${i === tourStep ? 'active' : ''}"></div>`
        ).join('');

        document.getElementById('tour-title').textContent = step.title;
        document.getElementById('tour-content').textContent = step.content;

        // Position tooltip
        tooltip.classList.remove('top-position', 'center-position', 'bottom-position');
        tooltip.classList.add(`${step.position}-position`);

        // Update buttons
        document.getElementById('tour-back').style.display = tourStep === 0 ? 'none' : 'block';
        document.getElementById('tour-next').textContent = tourStep === tourSteps.length - 1 ? 'Finish' : 'Next';
    }, 150);
}

function nextTourStep() {
    if (tourStep < tourSteps.length - 1) {
        tourStep++;
        showTourStep();
    } else {
        endTour();
    }
}

function prevTourStep() {
    if (tourStep > 0) {
        tourStep--;
        showTourStep();
    }
}

function endTour() {
    tourActive = false;
    const overlay = document.getElementById('tour-overlay');
    const tooltip = document.getElementById('tour-tooltip');
    if (overlay) {
        overlay.classList.remove('active');
        overlay.style.display = 'none';
    }
    if (tooltip) {
        tooltip.classList.add('hidden');
        tooltip.style.display = 'none';
    }
    navigateTo('dashboard');
}

// ==================== V5.5: ADDITIONAL CONNECTIONS ====================
// V6.20: Updated to handle in-environment (green), available (default), and coming-soon (grey) states
function renderAddConnCard(conn) {
    const isInEnv = conn.status === 'in-environment';
    const isComingSoon = conn.status === 'coming-soon';

    const borderClass = isInEnv ? 'border-status-success/50 hover:border-status-success' : isComingSoon ? 'border-border-subtle opacity-60' : 'border-border-subtle hover:border-primary';
    const bgHoverClass = isInEnv ? 'hover:bg-status-success/5' : isComingSoon ? '' : 'hover:bg-primary/5';
    const iconBgClass = isInEnv ? 'bg-status-success/10' : isComingSoon ? 'bg-surface-hover' : 'bg-surface-hover group-hover:bg-primary/10';
    const iconColorClass = isInEnv ? 'text-status-success' : isComingSoon ? 'text-text-muted' : 'text-text-secondary group-hover:text-primary';

    const actionLabel = isInEnv
        ? `<p class="text-[11px] text-status-success font-medium flex items-center gap-1"><span class="material-symbols-outlined text-[12px]">check_circle</span>Available — Connect</p>`
        : isComingSoon
        ? `<p class="text-[11px] text-text-muted font-medium">Coming Soon</p>`
        : `<p class="text-[11px] text-primary font-medium flex items-center gap-1"><span class="material-symbols-outlined text-[12px]">add_circle</span>Connect</p>`;

    const clickHandler = isComingSoon ? '' : `onclick="showConnectionFlow('${conn.name}', '${conn.icon}', ${isInEnv})"`;

    return `
        <button class="bg-surface-card rounded-lg border ${borderClass} ${bgHoverClass} p-3 transition-all text-left group ${isComingSoon ? 'cursor-default' : ''}" ${clickHandler}>
            <div class="flex items-center gap-2">
                <div class="w-8 h-8 rounded-lg ${iconBgClass} flex items-center justify-center transition-colors">
                    <span class="material-symbols-outlined ${iconColorClass} text-[16px] transition-colors">${conn.icon}</span>
                </div>
                <div class="flex-1 min-w-0">
                    <h4 class="text-[11px] font-medium ${isComingSoon ? 'text-text-muted' : 'text-text-primary'} truncate">${conn.name}</h4>
                    ${actionLabel}
                </div>
            </div>
        </button>
    `;
}

// V6.12: Updated to support filtering - pass 'dlp' for Enforcement screen, 'integration' for Settings
function renderAdditionalConnections(filter = 'all') {
    const addConn = DEMO_DATA.additionalConnections;
    if (!addConn) return '<div class="text-text-secondary text-sm">No additional connections configured.</div>';

    // V6.12: Filter for Enforcement screen - only DLP
    if (filter === 'dlp') {
        return `
            <div class="grid grid-cols-2 gap-2">
                ${(addConn.dlp || []).map(c => renderAddConnCard(c)).join('')}
            </div>
        `;
    }

    // V6.12: Filter for Settings > Integration - everything except DLP
    if (filter === 'integration') {
        return `
            <div class="mb-4">
                <h4 class="text-[11px] font-medium text-text-secondary mb-2">Text Channels</h4>
                <div class="grid grid-cols-2 gap-2">
                    ${(addConn.text || []).map(c => renderAddConnCard(c)).join('')}
                </div>
            </div>
            <div class="mb-4">
                <h4 class="text-[11px] font-medium text-text-secondary mb-2">SaaS Applications</h4>
                <div class="grid grid-cols-2 gap-2">
                    ${(addConn.saas || []).map(c => renderAddConnCard(c)).join('')}
                </div>
            </div>
            <div>
                <h4 class="text-[11px] font-medium text-text-secondary mb-2">Context Sources</h4>
                <div class="grid grid-cols-2 gap-2">
                    ${(addConn.context || []).map(c => renderAddConnCard(c)).join('')}
                </div>
            </div>
        `;
    }

    // Default: show all (backwards compatibility)
    return `
        <div class="mb-4">
            <h4 class="text-[11px] font-medium text-text-secondary mb-2">Text Channels</h4>
            <div class="grid grid-cols-2 gap-2">
                ${(addConn.text || []).map(c => renderAddConnCard(c)).join('')}
            </div>
        </div>
        <div class="mb-4">
            <h4 class="text-[11px] font-medium text-text-secondary mb-2">SaaS Applications</h4>
            <div class="grid grid-cols-2 gap-2">
                ${(addConn.saas || []).map(c => renderAddConnCard(c)).join('')}
            </div>
        </div>
        <div class="mb-4">
            <h4 class="text-[11px] font-medium text-text-secondary mb-2">DLP Systems</h4>
            <div class="grid grid-cols-2 gap-2">
                ${(addConn.dlp || []).map(c => renderAddConnCard(c)).join('')}
            </div>
        </div>
        <div>
            <h4 class="text-[11px] font-medium text-text-secondary mb-2">Context Sources</h4>
            <div class="grid grid-cols-2 gap-2">
                ${(addConn.context || []).map(c => renderAddConnCard(c)).join('')}
            </div>
        </div>
    `;
}

// ==================== V5.9: CASE ACTION OPTIONS (3x3 grid) ====================
function renderActionToggles() {
    const container = document.getElementById('action-toggles');
    if (!container) return;

    // V5.9: 3x3 grid layout for action toggles
    // V5.18: Responsive - 2 cols on mobile, 3 on sm+, compact mobile styling
    container.innerHTML = `
        <div class="grid grid-cols-2 sm:grid-cols-3 gap-2 sm:gap-3">
            ${caseActionOptions.map(action => {
                const mode = action.mode || 'manual';
                return `
                <div class="p-2 sm:p-3 bg-surface-card rounded-lg border border-border-default">
                    <div class="flex items-center justify-between mb-1.5 sm:mb-2">
                        <div class="flex items-center gap-1.5 sm:gap-2">
                            ${action.icon ? `<span class="material-symbols-outlined text-primary text-[14px] sm:text-[16px]">${action.icon}</span>` : ''}
                            <span class="text-[10px] sm:text-xs font-medium text-text-primary leading-tight">${action.label}</span>
                        </div>
                        <label class="relative inline-flex items-center cursor-pointer shrink-0">
                            <input type="checkbox" class="sr-only peer" ${action.enabled ? 'checked' : ''} onchange="toggleActionOption('${action.id}', this.checked)">
                            <div class="w-7 h-4 bg-surface-hover peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-3 peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-border-default after:border after:rounded-full after:h-3 after:w-3 after:transition-all peer-checked:bg-primary"></div>
                        </label>
                    </div>
                    ${action.category ? `<span class="text-[9px] sm:text-[10px] font-medium text-text-secondary bg-surface-hover px-1.5 py-0.5 rounded">${action.category}</span>` : ''}
                    ${action.enabled ? `
                    <div class="flex items-center gap-1 mt-1.5 sm:mt-2">
                        <button onclick="setActionMode('${action.id}', 'manual')" class="text-[9px] sm:text-[10px] font-medium px-1.5 py-0.5 rounded ${mode === 'manual' ? 'bg-primary text-white' : 'bg-surface-hover text-text-secondary hover:text-text-primary'}">Manual</button>
                        <button onclick="setActionMode('${action.id}', 'automated')" class="text-[9px] sm:text-[10px] font-medium px-1.5 py-0.5 rounded ${mode === 'automated' ? 'bg-primary text-white' : 'bg-surface-hover text-text-secondary hover:text-text-primary'}">Auto</button>
                    </div>` : ''}
                </div>`;
            }).join('')}
        </div>
    `;
}

// ==================== V6.12: SETTINGS INTEGRATION SECTION ====================
// Renders Email Channels, SaaS Channels, Context Sources (moved from Connect screen)
function renderSettingsIntegration() {
    const container = document.getElementById('settings-integration-content');
    if (!container) return;

    const connectedItems = connectionsData.filter(c => c.status === 'connected');
    const channels = connectedItems.filter(c => c.category === 'channel');
    const emailChannels = channels.filter(c => c.channelType === 'email');
    const saasChannels = channels.filter(c => c.channelType === 'saas');
    const contextConnections = connectedItems.filter(c => c.category === 'context' || c.isContextSource);

    // V6.12: Compact card for integration section
    const renderIntegrationCard = (conn) => `
        <div class="bg-white rounded-lg border border-border-default p-3 shadow-sm">
            <div class="flex items-center gap-3">
                <div class="w-8 h-8 rounded-lg bg-${conn.color}/20 flex items-center justify-center relative shrink-0">
                    <span class="material-symbols-outlined text-${conn.color} text-[16px]">${conn.icon}</span>
                    <span class="absolute -top-0.5 -right-0.5 w-3 h-3 bg-status-success rounded-full border-2 border-white flex items-center justify-center">
                        <span class="material-symbols-outlined text-white text-[8px]" style="font-variation-settings: 'FILL' 1">check</span>
                    </span>
                </div>
                <div class="flex-1 min-w-0">
                    <h4 class="text-sm font-medium text-text-primary truncate">${conn.name}</h4>
                    <p class="text-[11px] text-text-secondary">${conn.stats.dataProcessed}</p>
                </div>
                <span class="text-[10px] text-text-muted">Synced ${conn.stats.lastSync}</span>
            </div>
        </div>
    `;

    container.innerHTML = `
        <!-- Email Channels -->
        <div class="mb-4">
            <h4 class="text-[11px] font-bold text-text-secondary uppercase tracking-wider mb-2 flex items-center gap-1.5">
                <span class="material-symbols-outlined text-[14px]">mail</span>
                Email Channels
            </h4>
            <div class="grid gap-2">
                ${emailChannels.map(conn => renderIntegrationCard(conn)).join('')}
            </div>
        </div>

        <!-- SaaS Channels -->
        ${saasChannels.length > 0 ? `
        <div class="mb-4">
            <h4 class="text-[11px] font-bold text-text-secondary uppercase tracking-wider mb-2 flex items-center gap-1.5">
                <span class="material-symbols-outlined text-[14px]">cloud</span>
                SaaS Channels
            </h4>
            <div class="grid gap-2">
                ${saasChannels.map(conn => renderIntegrationCard(conn)).join('')}
            </div>
        </div>
        ` : ''}

        <!-- Context Sources -->
        ${contextConnections.length > 0 ? `
        <div class="mb-4">
            <h4 class="text-[11px] font-bold text-text-secondary uppercase tracking-wider mb-2 flex items-center gap-1.5">
                <span class="material-symbols-outlined text-[14px]">database</span>
                Context Sources
            </h4>
            <div class="grid gap-2">
                ${contextConnections.map(conn => `
                    <div class="bg-white rounded-lg border border-border-default p-3 shadow-sm">
                        <div class="flex items-center gap-3">
                            <div class="w-8 h-8 rounded-lg bg-${conn.color}/20 flex items-center justify-center relative shrink-0">
                                <span class="material-symbols-outlined text-${conn.color} text-[16px]">${conn.icon}</span>
                                <span class="absolute -top-0.5 -right-0.5 w-3 h-3 bg-status-success rounded-full border-2 border-white flex items-center justify-center">
                                    <span class="material-symbols-outlined text-white text-[8px]" style="font-variation-settings: 'FILL' 1">check</span>
                                </span>
                            </div>
                            <div class="flex-1 min-w-0">
                                <h4 class="text-sm font-medium text-text-primary truncate">${conn.name}</h4>
                                <p class="text-[11px] text-text-secondary">${conn.stats.dataProcessed}</p>
                            </div>
                            <span class="text-[10px] font-medium text-accent-teal bg-accent-teal/10 px-1.5 py-0.5 rounded">Enrichment</span>
                        </div>
                    </div>
                `).join('')}
            </div>
        </div>
        ` : ''}

        <!-- Additional Connections (non-DLP) -->
        <div>
            <h4 class="text-[11px] font-bold text-text-secondary uppercase tracking-wider mb-2 flex items-center gap-1.5">
                <span class="material-symbols-outlined text-[14px]">add_circle</span>
                Additional Connections
            </h4>
            ${renderAdditionalConnections('integration')}
        </div>
    `;
}

// ==================== V6.20: CONNECT SCREEN ====================
function renderConnectScreen() {
    const activeContainer = document.getElementById('connect-active-content');
    const additionalContainer = document.getElementById('connect-additional-content');
    if (!activeContainer || !additionalContainer) return;

    const connectedItems = connectionsData.filter(c => c.status === 'connected');
    const channels = connectedItems.filter(c => c.category === 'channel');
    const emailChannels = channels.filter(c => c.channelType === 'email');
    const saasChannels = channels.filter(c => c.channelType === 'saas');
    const contextConnections = connectedItems.filter(c => c.category === 'context' || c.isContextSource);

    const renderConnectedCard = (conn) => `
        <div class="bg-white rounded-lg border border-border-default p-3 shadow-sm">
            <div class="flex items-center gap-3">
                <div class="w-8 h-8 rounded-lg bg-${conn.color}/20 flex items-center justify-center relative shrink-0">
                    <span class="material-symbols-outlined text-${conn.color} text-[16px]">${conn.icon}</span>
                    <span class="absolute -top-0.5 -right-0.5 w-3 h-3 bg-status-success rounded-full border-2 border-white flex items-center justify-center">
                        <span class="material-symbols-outlined text-white text-[8px]" style="font-variation-settings: 'FILL' 1">check</span>
                    </span>
                </div>
                <div class="flex-1 min-w-0">
                    <h4 class="text-sm font-medium text-text-primary truncate">${conn.name}</h4>
                    <p class="text-[11px] text-text-secondary">${conn.stats.dataProcessed}</p>
                </div>
                <span class="text-[10px] text-text-muted">Synced ${conn.stats.lastSync}</span>
            </div>
        </div>
    `;

    activeContainer.innerHTML = `
        <!-- Email Channels -->
        <div class="mb-4">
            <h4 class="text-[11px] font-bold text-text-secondary uppercase tracking-wider mb-2 flex items-center gap-1.5">
                <span class="material-symbols-outlined text-[14px]">mail</span>
                Email Channels
            </h4>
            <div class="grid gap-2">
                ${emailChannels.map(conn => renderConnectedCard(conn)).join('')}
            </div>
        </div>

        <!-- SaaS Channels -->
        ${saasChannels.length > 0 ? `
        <div class="mb-4">
            <h4 class="text-[11px] font-bold text-text-secondary uppercase tracking-wider mb-2 flex items-center gap-1.5">
                <span class="material-symbols-outlined text-[14px]">cloud</span>
                SaaS Channels
            </h4>
            <div class="grid gap-2">
                ${saasChannels.map(conn => renderConnectedCard(conn)).join('')}
            </div>
        </div>
        ` : ''}

        <!-- Context Sources -->
        ${contextConnections.length > 0 ? `
        <div>
            <h4 class="text-[11px] font-bold text-text-secondary uppercase tracking-wider mb-2 flex items-center gap-1.5">
                <span class="material-symbols-outlined text-[14px]">database</span>
                Context Sources
            </h4>
            <div class="grid gap-2">
                ${contextConnections.map(conn => `
                    <div class="bg-white rounded-lg border border-border-default p-3 shadow-sm">
                        <div class="flex items-center gap-3">
                            <div class="w-8 h-8 rounded-lg bg-${conn.color}/20 flex items-center justify-center relative shrink-0">
                                <span class="material-symbols-outlined text-${conn.color} text-[16px]">${conn.icon}</span>
                                <span class="absolute -top-0.5 -right-0.5 w-3 h-3 bg-status-success rounded-full border-2 border-white flex items-center justify-center">
                                    <span class="material-symbols-outlined text-white text-[8px]" style="font-variation-settings: 'FILL' 1">check</span>
                                </span>
                            </div>
                            <div class="flex-1 min-w-0">
                                <h4 class="text-sm font-medium text-text-primary truncate">${conn.name}</h4>
                                <p class="text-[11px] text-text-secondary">${conn.stats.dataProcessed}</p>
                            </div>
                            <span class="text-[10px] font-medium text-accent-teal bg-accent-teal/10 px-1.5 py-0.5 rounded">Enrichment</span>
                        </div>
                    </div>
                `).join('')}
            </div>
        </div>
        ` : ''}
    `;

    additionalContainer.innerHTML = `
        ${renderAdditionalConnections('integration')}
        <div class="mt-4">
            <h4 class="text-[11px] font-bold text-text-secondary uppercase tracking-wider mb-2 flex items-center gap-1.5">
                <span class="material-symbols-outlined text-[14px]">shield</span>
                DLP Systems
            </h4>
            ${renderAdditionalConnections('dlp')}
        </div>
    `;
}

// V6.20: Connection flow modal
function showConnectionFlow(name, icon, isInEnvironment) {
    const modal = document.getElementById('policy-modal');
    const content = document.getElementById('policy-modal-content');

    const connectionFields = {
        'Microsoft Teams Chat': { fields: ['Tenant ID', 'Client ID', 'Client Secret'], method: 'OAuth 2.0' },
        'Dropbox Business': { fields: ['API Key', 'App Secret'], method: 'OAuth 2.0' },
        'Box Enterprise': { fields: ['Client ID', 'Client Secret', 'Enterprise ID'], method: 'JWT Auth' },
        'OneDrive': { fields: ['Tenant ID', 'Client ID', 'Client Secret'], method: 'OAuth 2.0' },
        'ServiceNow ITSM': { fields: ['Instance URL', 'Client ID', 'Client Secret'], method: 'OAuth 2.0' },
        'Jira': { fields: ['Instance URL', 'API Token', 'User Email'], method: 'API Token' },
        'Active Directory': { fields: ['Domain', 'LDAP URL', 'Service Account', 'Password'], method: 'LDAP' },
        'Symantec DLP': { fields: ['Server URL', 'API Key'], method: 'REST API' },
        'Forcepoint DLP': { fields: ['Server URL', 'API Key', 'Account ID'], method: 'REST API' },
        'Digital Guardian': { fields: ['Tenant URL', 'API Key'], method: 'REST API' },
        'Trellix DLP': { fields: ['Server URL', 'API Key'], method: 'REST API' },
        'Proofpoint DLP': { fields: ['API Key', 'API Secret'], method: 'REST API' },
        'Code42 Incydr': { fields: ['API Gateway URL', 'API Client ID', 'API Secret'], method: 'REST API' },
        'Zscaler DLP': { fields: ['Cloud Name', 'API Key', 'API Secret'], method: 'REST API' },
        'Palo Alto DSPM': { fields: ['Instance URL', 'API Key'], method: 'REST API' }
    };

    const config = connectionFields[name] || { fields: ['API Key'], method: 'REST API' };

    content.innerHTML = `
        <div class="flex items-center justify-between mb-4">
            <h3 class="text-lg font-bold text-text-primary flex items-center gap-2">
                <span class="material-symbols-outlined ${isInEnvironment ? 'text-status-success' : 'text-primary'}">${icon}</span>
                Connect ${name}
            </h3>
            <button onclick="closePolicyModal()" class="w-8 h-8 flex items-center justify-center rounded-lg hover:bg-surface-hover text-text-secondary">
                <span class="material-symbols-outlined">close</span>
            </button>
        </div>
        ${isInEnvironment ? `
        <div class="bg-status-success/5 border border-status-success/20 rounded-lg p-3 mb-4 flex items-start gap-2">
            <span class="material-symbols-outlined text-status-success text-lg shrink-0">check_circle</span>
            <div>
                <div class="text-sm font-medium text-text-primary">Detected in your environment</div>
                <div class="text-xs text-text-secondary">AXIA detected ${name} in your organization. Connect to start monitoring.</div>
            </div>
        </div>
        ` : ''}
        <div class="text-xs text-text-secondary mb-3">Authentication Method: <span class="font-medium text-text-primary">${config.method}</span></div>
        <div class="space-y-3 mb-4" id="conn-flow-fields">
            ${config.fields.map(field => `
                <div>
                    <label class="text-xs font-medium text-text-secondary block mb-1">${field}</label>
                    <input type="${field.toLowerCase().includes('password') || field.toLowerCase().includes('secret') ? 'password' : 'text'}" placeholder="Enter ${field.toLowerCase()}" class="w-full px-3 py-2 bg-surface-card border border-border-default rounded-lg text-sm text-text-primary placeholder-text-muted focus:border-primary focus:outline-none focus:ring-1 focus:ring-primary/30">
                </div>
            `).join('')}
        </div>
        <div class="mb-4">
            <label class="text-xs font-medium text-text-secondary block mb-1">Add to Channels</label>
            <div class="flex flex-wrap gap-2">
                <label class="flex items-center gap-1.5 px-2.5 py-1.5 bg-surface-card border border-border-subtle rounded-lg cursor-pointer hover:border-primary text-xs">
                    <input type="checkbox" checked class="text-primary rounded w-3 h-3">
                    <span>Monitoring</span>
                </label>
                <label class="flex items-center gap-1.5 px-2.5 py-1.5 bg-surface-card border border-border-subtle rounded-lg cursor-pointer hover:border-primary text-xs">
                    <input type="checkbox" checked class="text-primary rounded w-3 h-3">
                    <span>Alerting</span>
                </label>
                <label class="flex items-center gap-1.5 px-2.5 py-1.5 bg-surface-card border border-border-subtle rounded-lg cursor-pointer hover:border-primary text-xs">
                    <input type="checkbox" class="text-primary rounded w-3 h-3">
                    <span>Enforcement</span>
                </label>
            </div>
        </div>
        <div class="flex gap-2">
            <button onclick="completeConnection('${name}')" class="flex-1 px-4 py-2 bg-primary text-white rounded-lg font-medium hover:opacity-90 transition-colors flex items-center justify-center gap-2">
                <span class="material-symbols-outlined text-lg">link</span>
                Test & Connect
            </button>
            <button onclick="closePolicyModal()" class="px-4 py-2 bg-surface-hover text-text-secondary rounded-lg font-medium hover:text-text-primary transition-colors">Cancel</button>
        </div>
    `;
    modal.classList.remove('hidden');
}

function completeConnection(name) {
    const content = document.getElementById('policy-modal-content');
    content.innerHTML = `
        <div class="flex flex-col items-center py-6">
            <div class="w-16 h-16 rounded-full bg-status-success/10 flex items-center justify-center mb-4">
                <span class="material-symbols-outlined text-status-success text-[32px]">check_circle</span>
            </div>
            <h3 class="text-lg font-bold text-text-primary mb-2">${name} Connected</h3>
            <p class="text-sm text-text-secondary text-center mb-4">Connection established successfully. Data will start syncing within a few minutes.</p>
            <button onclick="closePolicyModal(); renderConnectScreen();" class="px-6 py-2 bg-primary text-white rounded-lg font-medium hover:opacity-90 transition-colors">Done</button>
        </div>
    `;
}

function toggleActionOption(actionId, enabled) {
    const action = caseActionOptions.find(a => a.id === actionId);
    if (action) action.enabled = enabled;
    renderActionToggles();
}

function setActionMode(actionId, mode) {
    const action = caseActionOptions.find(a => a.id === actionId);
    if (action) action.mode = mode;
    renderActionToggles();
}

function confirmCaseActions() {
    const checked = document.querySelectorAll('.case-action-check:checked');
    const actions = Array.from(checked).map(c => c.dataset.action);
    console.log('Confirmed actions:', actions);
    // V6.11: Handle enforcement actions - trigger follow-up dialogs
    actions.forEach(actionId => {
        if (['create-dlp-rule', 'adjust-dlp-rule', 'activate-smart-block'].includes(actionId)) {
            handlePolicyAction(actionId, currentCaseId);
        }
    });
}

// ==================== V6.10: ENFORCEMENT ACTION HANDLERS ====================
function handlePolicyAction(actionId, caseId) {
    const caseData = casesData.find(c => c.id === caseId) || casesData[0];
    switch(actionId) {
        case 'create-dlp-rule':
            showCreatePolicyModal(caseData);
            break;
        case 'adjust-dlp-rule':
            showAdjustPoliciesModal(caseData);
            break;
        case 'activate-smart-block':
            showSmartControlModal(caseData);
            break;
    }
}

function showCreatePolicyModal(caseData) {
    const modal = document.getElementById('policy-modal');
    const content = document.getElementById('policy-modal-content');
    const policyName = `Block ${caseData.contentType || 'Sensitive Content'} - ${caseData.entity?.name?.split(' ')[1] || 'Rule'}`;

    content.innerHTML = `
        <div class="flex items-center justify-between mb-4">
            <h3 class="text-lg font-bold text-text-primary flex items-center gap-2">
                <span class="material-symbols-outlined text-primary">add_circle</span>
                Create DLP Rule
            </h3>
            <button onclick="closePolicyModal()" class="w-8 h-8 flex items-center justify-center rounded-lg hover:bg-surface-hover text-text-secondary">
                <span class="material-symbols-outlined">close</span>
            </button>
        </div>
        <div class="space-y-4">
            <div>
                <label class="block text-sm font-medium text-text-secondary mb-1">Rule Name</label>
                <input type="text" value="${policyName}" class="w-full px-3 py-2 rounded-lg border border-border-default bg-surface-elevated text-text-primary text-sm focus:border-primary focus:ring-1 focus:ring-primary outline-none">
            </div>
            <div>
                <label class="block text-sm font-medium text-text-secondary mb-1">Target DLP System</label>
                <select class="w-full px-3 py-2 rounded-lg border border-border-default bg-surface-elevated text-text-primary text-sm">
                    <option>Microsoft Purview</option>
                    <option>Netskope CASB</option>
                </select>
            </div>
            <div>
                <label class="block text-sm font-medium text-text-secondary mb-1">Conditions (Auto-generated from case)</label>
                <div class="bg-surface-card rounded-lg p-3 border border-border-subtle text-xs space-y-1">
                    <div class="flex items-center gap-2"><span class="text-primary">✓</span> Content type: ${caseData.contentType || 'Source Code'}</div>
                    <div class="flex items-center gap-2"><span class="text-primary">✓</span> Sender role: ${caseData.role || 'Engineer'}</div>
                    <div class="flex items-center gap-2"><span class="text-primary">✓</span> Destination: External domains (non-whitelisted)</div>
                    <div class="flex items-center gap-2"><span class="text-primary">✓</span> Volume: > 10 files in 24h window</div>
                </div>
            </div>
            <div>
                <label class="block text-sm font-medium text-text-secondary mb-1">Action</label>
                <div class="flex gap-2">
                    <label class="flex items-center gap-2 px-3 py-2 bg-status-blocked/10 border border-status-blocked/30 rounded-lg cursor-pointer">
                        <input type="radio" name="policy-action" checked class="text-status-blocked">
                        <span class="text-sm">Block + Alert</span>
                    </label>
                    <label class="flex items-center gap-2 px-3 py-2 bg-surface-hover border border-border-subtle rounded-lg cursor-pointer">
                        <input type="radio" name="policy-action" class="text-severity-high">
                        <span class="text-sm">Alert Only</span>
                    </label>
                </div>
            </div>
            <div class="flex gap-2 pt-2">
                <button onclick="confirmCreatePolicy()" class="flex-1 px-4 py-2 bg-primary text-white rounded-lg font-medium hover:bg-primary-hover transition-colors">
                    Create Rule
                </button>
                <button onclick="closePolicyModal()" class="px-4 py-2 bg-surface-hover text-text-secondary rounded-lg font-medium hover:text-text-primary transition-colors">
                    Cancel
                </button>
            </div>
        </div>
    `;
    modal.classList.remove('hidden');
}

function showAdjustPoliciesModal(caseData) {
    const modal = document.getElementById('policy-modal');
    const content = document.getElementById('policy-modal-content');

    content.innerHTML = `
        <div class="flex items-center justify-between mb-4">
            <h3 class="text-lg font-bold text-text-primary flex items-center gap-2">
                <span class="material-symbols-outlined text-ops-purple">tune</span>
                Adjust Related DLP Rules
            </h3>
            <button onclick="closePolicyModal()" class="w-8 h-8 flex items-center justify-center rounded-lg hover:bg-surface-hover text-text-secondary">
                <span class="material-symbols-outlined">close</span>
            </button>
        </div>
        <p class="text-sm text-text-secondary mb-4">The following DLP rules are related to this case. Adjust as needed:</p>
        <div class="space-y-3 mb-4">
            <div class="bg-surface-card rounded-lg p-3 border border-border-subtle">
                <div class="flex items-center justify-between mb-2">
                    <span class="font-medium text-sm text-text-primary">Source Code External Share</span>
                    <label class="relative inline-flex items-center cursor-pointer">
                        <input type="checkbox" checked class="sr-only peer">
                        <div class="w-9 h-5 bg-surface-hover rounded-full peer peer-checked:bg-primary peer-checked:after:translate-x-full after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-4 after:w-4 after:transition-all"></div>
                    </label>
                </div>
                <div class="text-xs text-text-muted">Blocks code files to external recipients • Purview</div>
            </div>
            <div class="bg-surface-card rounded-lg p-3 border border-border-subtle">
                <div class="flex items-center justify-between mb-2">
                    <span class="font-medium text-sm text-text-primary">Bulk Download Alert</span>
                    <label class="relative inline-flex items-center cursor-pointer">
                        <input type="checkbox" checked class="sr-only peer">
                        <div class="w-9 h-5 bg-surface-hover rounded-full peer peer-checked:bg-primary peer-checked:after:translate-x-full after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-4 after:w-4 after:transition-all"></div>
                    </label>
                </div>
                <div class="text-xs text-text-muted">Alerts on >50 files in 24h • Netskope</div>
            </div>
            <div class="bg-surface-card rounded-lg p-3 border border-border-subtle">
                <div class="flex items-center justify-between mb-2">
                    <span class="font-medium text-sm text-text-primary">Departure Risk Enhanced</span>
                    <label class="relative inline-flex items-center cursor-pointer">
                        <input type="checkbox" class="sr-only peer">
                        <div class="w-9 h-5 bg-surface-hover rounded-full peer peer-checked:bg-primary peer-checked:after:translate-x-full after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-4 after:w-4 after:transition-all"></div>
                    </label>
                </div>
                <div class="text-xs text-text-muted">Stricter rules for departing employees • Combined</div>
            </div>
        </div>
        <div class="flex gap-2">
            <button onclick="confirmAdjustPolicies()" class="flex-1 px-4 py-2 bg-ops-purple text-white rounded-lg font-medium hover:opacity-90 transition-colors">
                Save Changes
            </button>
            <button onclick="closePolicyModal()" class="px-4 py-2 bg-surface-hover text-text-secondary rounded-lg font-medium hover:text-text-primary transition-colors">
                Cancel
            </button>
        </div>
    `;
    modal.classList.remove('hidden');
}

function showSmartControlModal(caseData) {
    const modal = document.getElementById('policy-modal');
    const content = document.getElementById('policy-modal-content');

    content.innerHTML = `
        <div class="flex items-center justify-between mb-4">
            <h3 class="text-lg font-bold text-text-primary flex items-center gap-2">
                <span class="material-symbols-outlined text-status-blocked">security</span>
                Activate Smart Block
            </h3>
            <button onclick="closePolicyModal()" class="w-8 h-8 flex items-center justify-center rounded-lg hover:bg-surface-hover text-text-secondary">
                <span class="material-symbols-outlined">close</span>
            </button>
        </div>
        <div class="bg-status-blocked/5 border border-status-blocked/20 rounded-lg p-4 mb-4">
            <div class="flex items-start gap-3">
                <span class="material-symbols-outlined text-status-blocked text-xl">shield</span>
                <div>
                    <div class="font-medium text-text-primary mb-1">Real-time AI Protection</div>
                    <div class="text-sm text-text-secondary">AXIA will actively monitor and block similar patterns using contextual analysis, not just static rules.</div>
                </div>
            </div>
        </div>
        <div class="space-y-3 mb-4">
            <div class="text-sm font-medium text-text-secondary">Protection Scope:</div>
            <div class="grid grid-cols-2 gap-2">
                <label class="flex items-center gap-2 px-3 py-2 bg-surface-card border border-border-subtle rounded-lg cursor-pointer hover:border-primary">
                    <input type="checkbox" checked class="text-primary rounded">
                    <span class="text-sm text-text-primary">${caseData.entity?.name || 'This employee'}</span>
                </label>
                <label class="flex items-center gap-2 px-3 py-2 bg-surface-card border border-border-subtle rounded-lg cursor-pointer hover:border-primary">
                    <input type="checkbox" checked class="text-primary rounded">
                    <span class="text-sm text-text-primary">${caseData.entity?.department || 'Engineering'} Dept</span>
                </label>
                <label class="flex items-center gap-2 px-3 py-2 bg-surface-card border border-border-subtle rounded-lg cursor-pointer hover:border-primary">
                    <input type="checkbox" class="text-primary rounded">
                    <span class="text-sm text-text-primary">All departing employees</span>
                </label>
                <label class="flex items-center gap-2 px-3 py-2 bg-surface-card border border-border-subtle rounded-lg cursor-pointer hover:border-primary">
                    <input type="checkbox" class="text-primary rounded">
                    <span class="text-sm text-text-primary">Organization-wide</span>
                </label>
            </div>
        </div>
        <div class="bg-surface-card rounded-lg p-3 border border-border-subtle mb-4">
            <div class="text-xs text-text-secondary mb-2">Smart Control will monitor:</div>
            <div class="flex flex-wrap gap-2">
                <span class="px-2 py-1 bg-severity-critical/10 text-severity-critical text-xs rounded">Source code</span>
                <span class="px-2 py-1 bg-severity-high/10 text-severity-high text-xs rounded">Customer data</span>
                <span class="px-2 py-1 bg-severity-medium/10 text-severity-medium text-xs rounded">Internal docs</span>
                <span class="px-2 py-1 bg-primary/10 text-primary text-xs rounded">+ Learn patterns</span>
            </div>
        </div>
        <div class="flex gap-2">
            <button onclick="confirmSmartControl()" class="flex-1 px-4 py-2 bg-status-blocked text-white rounded-lg font-medium hover:opacity-90 transition-colors flex items-center justify-center gap-2">
                <span class="material-symbols-outlined text-lg">shield</span>
                Activate Protection
            </button>
            <button onclick="closePolicyModal()" class="px-4 py-2 bg-surface-hover text-text-secondary rounded-lg font-medium hover:text-text-primary transition-colors">
                Cancel
            </button>
        </div>
    `;
    modal.classList.remove('hidden');
}

function closePolicyModal() {
    const modal = document.getElementById('policy-modal');
    if (modal) modal.classList.add('hidden');
}

function confirmCreatePolicy() {
    closePolicyModal();
    // Show success feedback
    showPolicyToast('DLP Rule created successfully', 'add_circle', 'primary');
}

function confirmAdjustPolicies() {
    closePolicyModal();
    showPolicyToast('DLP Rule adjustments saved', 'tune', 'ops-purple');
}

function confirmSmartControl() {
    closePolicyModal();
    showPolicyToast('Smart Block activated', 'shield', 'status-blocked');
    // V6.20: Navigate to Enforce tab and scroll to the first smart block policy
    setTimeout(() => {
        navigateTo('connections');
        setTimeout(() => {
            const firstPolicy = document.querySelector('[data-rule-id]');
            if (firstPolicy) {
                firstPolicy.setAttribute('open', '');
                firstPolicy.scrollIntoView({ behavior: 'smooth', block: 'center' });
                firstPolicy.style.outline = '2px solid var(--status-blocked)';
                firstPolicy.style.outlineOffset = '2px';
                setTimeout(() => { firstPolicy.style.outline = ''; firstPolicy.style.outlineOffset = ''; }, 3000);
            }
        }, 300);
    }, 1000);
}

function showPolicyToast(message, icon, colorClass) {
    const toast = document.createElement('div');
    toast.className = `fixed bottom-24 left-1/2 -translate-x-1/2 bg-surface-card border border-border-default shadow-lg rounded-lg px-4 py-3 flex items-center gap-3 z-50 animate-fade-in`;
    toast.innerHTML = `
        <span class="material-symbols-outlined text-${colorClass}">${icon}</span>
        <span class="text-sm font-medium text-text-primary">${message}</span>
    `;
    document.body.appendChild(toast);
    setTimeout(() => {
        toast.style.opacity = '0';
        toast.style.transition = 'opacity 0.3s';
        setTimeout(() => toast.remove(), 300);
    }, 3000);
}

function updateSelectedActionCount() {
    const checked = document.querySelectorAll('.case-action-check:checked');
    const countEl = document.getElementById('selected-action-count');
    if (countEl) countEl.textContent = checked.length;
}

// ==================== V6.20: DOCUMENT VIEWER ====================
const documentContent = {
    'CASE-2024-001': { filename: 'project_algorithms_v3.zip', type: 'Archive Contents', pages: [
        { title: 'recommendation_engine.py', content: `import numpy as np\nfrom sklearn.ensemble import GradientBoostingClassifier\n\nclass PropietaryRecommendationEngine:\n    """<mark class="doc-highlight">Core recommendation algorithm - CONFIDENTIAL</mark>\n    <mark class="doc-highlight">Patent pending: US-2024-0847291</mark>\n    """\n    def __init__(self, config):\n        self.model = GradientBoostingClassifier(\n            n_estimators=500,\n            learning_rate=0.05,\n            <mark class="doc-highlight">max_depth=8  # Proprietary tuning parameter</mark>\n        )\n        self.feature_weights = {\n            <mark class="doc-highlight">'user_affinity': 0.34,</mark>\n            <mark class="doc-highlight">'temporal_decay': 0.21,</mark>\n            <mark class="doc-highlight">'content_similarity': 0.45</mark>\n        }\n\n    def predict(self, user_profile, candidates):\n        features = self._extract_features(user_profile, candidates)\n        return self.model.predict_proba(features)` },
        { title: 'customer_export_2024.csv', content: `Customer ID, Company, Contract Value, Renewal Date, NPS Score\n<mark class="doc-highlight">C-10042, Acme Corp, $2,400,000, 2024-06-15, 9</mark>\n<mark class="doc-highlight">C-10043, GlobalTech Inc, $1,850,000, 2024-08-22, 8</mark>\n<mark class="doc-highlight">C-10044, Meridian Systems, $3,100,000, 2024-03-01, 7</mark>\nC-10045, DataFlow LLC, $890,000, 2024-11-30, 9\n<mark class="doc-highlight">C-10046, Enterprise Solutions, $4,200,000, 2024-07-18, 6</mark>\n<mark class="doc-highlight">C-10047, CloudFirst Inc, $2,750,000, 2024-09-05, 8</mark>\n...\n<mark class="doc-highlight">[2,340 records total - bulk CRM export detected]</mark>` }
    ]},
    'CASE-2024-002': { filename: 'Q1_2025_Roadmap_FINAL.zip', type: 'Encrypted Archive', pages: [
        { title: 'Product_Roadmap_2025.pptx', content: `SLIDE 1: <mark class="doc-highlight">2025 Product Strategy - INTERNAL ONLY</mark>\n\nSLIDE 3: Market Expansion Plan\n- <mark class="doc-highlight">Q1: Launch enterprise tier ($50K+ deals)</mark>\n- <mark class="doc-highlight">Q2: APAC market entry via Singapore office</mark>\n- Q3: Partner ecosystem launch\n- <mark class="doc-highlight">Q4: IPO readiness preparation</mark>\n\nSLIDE 5: Competitive Response\n- <mark class="doc-highlight">Counter-positioning against DirectCompete</mark>\n- <mark class="doc-highlight">Pricing undercut strategy: 30% below market</mark>\n- Feature parity timeline: 6 months` }
    ]},
    'CASE-2024-003': { filename: 'financial_model_v2.xlsx', type: 'Spreadsheet', pages: [
        { title: 'Revenue_Projections_2025.xlsx', content: `Sheet: Revenue Model\n\n                    Q1 2025    Q2 2025    Q3 2025    Q4 2025\n<mark class="doc-highlight">Enterprise ARR    $12.4M     $15.1M     $18.7M     $22.3M</mark>\n<mark class="doc-highlight">Growth Rate       34%        42%        38%        41%</mark>\nChurn Rate        2.1%       1.8%       1.9%       1.7%\n<mark class="doc-highlight">CAC               $4,200     $3,800     $3,500     $3,200</mark>\n<mark class="doc-highlight">LTV/CAC           5.2x       5.8x       6.1x       6.5x</mark>\n\nSheet: Board Deck Notes\n<mark class="doc-highlight">"Do not share externally - pre-IPO financials"</mark>` }
    ]},
    'CASE-2024-004': { filename: 'design_system_v4.fig', type: 'Design File', pages: [
        { title: 'Component_Library_Export.pdf', content: `Design System v4.0 — Internal\n\nSection: Brand Guidelines\n<mark class="doc-highlight">Primary: #1A73E8  Secondary: #34A853</mark>\n<mark class="doc-highlight">Font: Inter (Licensed - Enterprise only)</mark>\n\nSection: Unreleased Components\n<mark class="doc-highlight">New checkout flow (launching Q2)</mark>\n<mark class="doc-highlight">AI assistant panel (patent pending)</mark>\nNavigation redesign (approved)\n<mark class="doc-highlight">Mobile-first dashboard (competitive advantage)</mark>` }
    ]}
};

function getDocContentForCase(caseId) {
    if (documentContent[caseId]) return documentContent[caseId];
    const c = casesData.find(cs => cs.id === caseId);
    if (!c) return { filename: 'document.pdf', type: 'Document', pages: [{ title: 'Document', content: 'Document content preview not available for this case.' }] };
    return { filename: 'confidential_document.zip', type: 'Attachment', pages: [
        { title: 'Flagged Content', content: `<mark class="doc-highlight">${c.analysis.what}</mark>\n\n${c.analysis.whyMatters}\n\n<mark class="doc-highlight">${c.analysis.whyUnusual}</mark>` }
    ]};
}

function openDocViewer(caseId) {
    const doc = getDocContentForCase(caseId);
    const modal = document.getElementById('doc-viewer-modal');
    document.getElementById('doc-viewer-title').textContent = doc.filename;
    const contentEl = document.getElementById('doc-viewer-content');
    contentEl.innerHTML = doc.pages.map((page, i) => `
        ${doc.pages.length > 1 ? `<div class="flex items-center gap-2 ${i > 0 ? 'mt-5 pt-5 border-t border-border-default' : ''} mb-3">
            <span class="material-symbols-outlined text-text-secondary text-[16px]">draft</span>
            <span class="text-xs font-bold text-text-secondary uppercase tracking-wider">${page.title}</span>
        </div>` : ''}
        <pre class="whitespace-pre-wrap font-mono text-[12px] leading-relaxed bg-surface-card border border-border-subtle rounded-lg p-4 overflow-x-auto">${page.content}</pre>
    `).join('');
    modal.classList.remove('hidden');
}

function closeDocViewer() {
    document.getElementById('doc-viewer-modal').classList.add('hidden');
}

// ==================== EVENT LISTENERS ====================
document.addEventListener('click', (e) => {
    if (!e.target.closest('.filter-btn') && !e.target.closest('.filter-dropdown')) {
        closeAllFilters();
    }
});

// V5.5: Update action count when checkboxes change
// V6.9.1: Also trigger policy modals for policy actions when checked
document.addEventListener('change', (e) => {
    if (e.target.classList.contains('case-action-check')) {
        updateSelectedActionCount();
        // V6.11: Immediately show modal for enforcement actions
        const actionId = e.target.dataset.action;
        if (e.target.checked && ['create-dlp-rule', 'adjust-dlp-rule', 'activate-smart-block'].includes(actionId)) {
            handlePolicyAction(actionId, currentCaseId);
        }
    }
});

// ==================== TIME SELECTOR ====================
function initTimeSelector() {
    // V6.0: Posture screen time selector - updates security posture and posture severity cards
    document.querySelectorAll('.posture-time-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            document.querySelectorAll('.posture-time-btn').forEach(b => {
                b.classList.remove('bg-primary', 'text-white', 'border-primary', 'shadow-sm', 'shadow-primary/20', 'font-bold');
                b.classList.add('bg-surface-card', 'text-text-secondary', 'border-border-subtle', 'font-medium');
            });
            this.classList.remove('bg-surface-card', 'text-text-secondary', 'border-border-subtle', 'font-medium');
            this.classList.add('bg-primary', 'text-white', 'border-primary', 'shadow-sm', 'shadow-primary/20', 'font-bold');
            currentTimeframe = this.dataset.range;
            // Also sync Command screen time selector
            document.querySelectorAll('.time-btn').forEach(b => {
                b.classList.remove('bg-primary', 'text-white', 'border-primary', 'shadow-sm', 'shadow-primary/20', 'font-bold');
                b.classList.add('bg-surface-card', 'text-text-secondary', 'border-border-subtle', 'font-medium');
                if (b.dataset.range === currentTimeframe) {
                    b.classList.remove('bg-surface-card', 'text-text-secondary', 'border-border-subtle', 'font-medium');
                    b.classList.add('bg-primary', 'text-white', 'border-primary', 'shadow-sm', 'shadow-primary/20', 'font-bold');
                }
            });
            renderSecurityPosture();
        });
    });

    // Command screen time selector - V5.4: Default to 1d
    // V5.15: Updates severity cards, accordion headers, and case list
    document.querySelectorAll('.time-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            document.querySelectorAll('.time-btn').forEach(b => {
                b.classList.remove('bg-primary', 'text-white', 'border-primary', 'shadow-sm', 'shadow-primary/20', 'font-bold');
                b.classList.add('bg-surface-card', 'text-text-secondary', 'border-border-subtle', 'font-medium');
            });
            this.classList.remove('bg-surface-card', 'text-text-secondary', 'border-border-subtle', 'font-medium');
            this.classList.add('bg-primary', 'text-white', 'border-primary', 'shadow-sm', 'shadow-primary/20', 'font-bold');
            currentTimeframe = this.dataset.range;
            // Also sync Posture screen time selector
            document.querySelectorAll('.posture-time-btn').forEach(b => {
                b.classList.remove('bg-primary', 'text-white', 'border-primary', 'shadow-sm', 'shadow-primary/20', 'font-bold');
                b.classList.add('bg-surface-card', 'text-text-secondary', 'border-border-subtle', 'font-medium');
                if (b.dataset.range === currentTimeframe) {
                    b.classList.remove('bg-surface-card', 'text-text-secondary', 'border-border-subtle', 'font-medium');
                    b.classList.add('bg-primary', 'text-white', 'border-primary', 'shadow-sm', 'shadow-primary/20', 'font-bold');
                }
            });
            renderSeverityCards();
            updateAccordionHeaders();
            renderDashboardCases();
            renderCommandTotals(); // V6.9: Update command totals with timeframe
        });
    });

    // Dashboard screen time selector - V5.4: Keep 30d default
    // V5.14: Preserve chart type selection when changing timeframe
    document.querySelectorAll('.dashboard-time-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            // V5.14: Save current chart type and metric before re-render
            const chartTypeSelect = document.getElementById('trend-chart-type');
            const metricSelect = document.getElementById('trend-metric-selector');
            const savedChartType = chartTypeSelect ? chartTypeSelect.value : 'line';
            const savedMetric = metricSelect ? metricSelect.value : 'cases-severity';

            document.querySelectorAll('.dashboard-time-btn').forEach(b => {
                b.classList.remove('bg-primary', 'text-white', 'border-primary', 'shadow-sm', 'shadow-primary/20', 'font-bold');
                b.classList.add('bg-surface-card', 'text-text-secondary', 'border-border-subtle', 'font-medium');
            });
            this.classList.remove('bg-surface-card', 'text-text-secondary', 'border-border-subtle', 'font-medium');
            this.classList.add('bg-primary', 'text-white', 'border-primary', 'shadow-sm', 'shadow-primary/20', 'font-bold');
            dashboardTimeframe = this.dataset.range;
            renderDashboardViewScreen();

            // V5.14: Restore chart type and metric after re-render
            setTimeout(() => {
                const newChartTypeSelect = document.getElementById('trend-chart-type');
                const newMetricSelect = document.getElementById('trend-metric-selector');
                if (newChartTypeSelect) newChartTypeSelect.value = savedChartType;
                if (newMetricSelect) newMetricSelect.value = savedMetric;
                updateTrendChart();
            }, 60);
        });
    });

    // Connections screen time selector
    document.querySelectorAll('.connections-time-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            document.querySelectorAll('.connections-time-btn').forEach(b => {
                b.classList.remove('bg-primary', 'text-white', 'border-primary', 'shadow-sm', 'shadow-primary/20', 'font-bold');
                b.classList.add('bg-surface-card', 'text-text-secondary', 'border-border-subtle', 'font-medium');
            });
            this.classList.remove('bg-surface-card', 'text-text-secondary', 'border-border-subtle', 'font-medium');
            this.classList.add('bg-primary', 'text-white', 'border-primary', 'shadow-sm', 'shadow-primary/20', 'font-bold');
            currentTimeframe = this.dataset.range;
            renderConnectionsScreen();
        });
    });

    // Cases screen time selector - V5.4: Default to 1d
    document.querySelectorAll('.cases-time-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            document.querySelectorAll('.cases-time-btn').forEach(b => {
                b.classList.remove('bg-primary', 'text-white', 'border-primary', 'shadow-sm', 'shadow-primary/20', 'font-bold');
                b.classList.add('bg-surface-card', 'text-text-secondary', 'border-border-subtle', 'font-medium');
            });
            this.classList.remove('bg-surface-card', 'text-text-secondary', 'border-border-subtle', 'font-medium');
            this.classList.add('bg-primary', 'text-white', 'border-primary', 'shadow-sm', 'shadow-primary/20', 'font-bold');
            currentTimeframe = this.dataset.range;
            renderCaseList();
        });
    });
}

// ==================== THEME TOGGLE ====================
let isDarkMode = false;

function toggleTheme() {
    try {
        isDarkMode = !isDarkMode;
        const html = document.documentElement;
        const toggle = document.getElementById('theme-toggle');
        const indicator = document.getElementById('theme-toggle-indicator');
        const icon = document.getElementById('theme-icon');

        if (!toggle || !indicator || !icon) return;

        // V6.22: Update logo to branded two-tone colors based on theme
        updateLogoColors(isDarkMode);

        if (isDarkMode) {
            html.classList.add('dark');
            indicator.style.transform = 'translateX(24px)';
            indicator.innerHTML = '<span class="material-symbols-outlined text-white text-[14px]">dark_mode</span>';
            icon.textContent = 'dark_mode';
            toggle.classList.remove('bg-surface-hover');
            toggle.classList.add('bg-primary/30');
        } else {
            html.classList.remove('dark');
            indicator.style.transform = 'translateX(0)';
            indicator.innerHTML = '<span class="material-symbols-outlined text-white text-[14px]">light_mode</span>';
            icon.textContent = 'light_mode';
            toggle.classList.add('bg-surface-hover');
            toggle.classList.remove('bg-primary/30');
        }

        localStorage.setItem('axia-theme', isDarkMode ? 'dark' : 'light');
    } catch (e) {
        console.warn('Theme toggle failed:', e);
    }
}

// V6.22: Two-tone logo per brand guidelines
// Light bg: outer/crosshairs #0F766E, inner/center #0D9488
// Dark bg: outer/crosshairs #0D9488, inner/center #22D3EE
function updateLogoColors(dark) {
    const logo = document.getElementById('axia-logo');
    if (!logo) return;

    const outerColor = dark ? '#0D9488' : '#0F766E';
    const innerColor = dark ? '#22D3EE' : '#0D9488';

    logo.querySelectorAll('.logo-outer').forEach(el => {
        el.setAttribute('stroke', outerColor);
    });
    logo.querySelectorAll('.logo-inner').forEach(el => {
        el.setAttribute('stroke', innerColor);
    });
    logo.querySelectorAll('.logo-glow, .logo-center').forEach(el => {
        el.setAttribute('fill', innerColor);
    });
    logo.querySelectorAll('.logo-crosshair').forEach(el => {
        el.setAttribute('stroke', outerColor);
    });
}

function initTheme() {
    try {
        // V6.22: Clear any stale theme preference, default to light mode
        localStorage.removeItem('axia-theme');
        isDarkMode = false;
        updateLogoColors(false);

        const savedTheme = null; // Force light mode on load
        if (savedTheme === 'dark') {
            const html = document.documentElement;
            const toggle = document.getElementById('theme-toggle');
            const indicator = document.getElementById('theme-toggle-indicator');
            const icon = document.getElementById('theme-icon');

            if (html && toggle && indicator && icon) {
                isDarkMode = true;
                html.classList.add('dark');
                indicator.style.transform = 'translateX(24px)';
                indicator.innerHTML = '<span class="material-symbols-outlined text-white text-[14px]">dark_mode</span>';
                icon.textContent = 'dark_mode';
                toggle.classList.remove('bg-surface-hover');
                toggle.classList.add('bg-primary/30');
                // V6.22: Set branded logo colors for dark mode
                updateLogoColors(true);
            }
        } else {
            // V6.22: Explicitly set branded logo colors for light mode (default)
            isDarkMode = false;
            updateLogoColors(false);
        }
    } catch (e) {
        console.warn('Theme initialization failed:', e);
    }
}

// ==================== INITIALIZATION ====================
document.addEventListener('DOMContentLoaded', function() {
    console.log('AXIA Demo V6.17: DOMContentLoaded fired');

    // Initialize case action options from DEMO_DATA
    if (typeof DEMO_DATA !== 'undefined' && DEMO_DATA.caseActionOptions) {
        caseActionOptions = DEMO_DATA.caseActionOptions;
    } else {
        caseActionOptions = [
            { id: 'contact-employee', label: 'Contact Employee', icon: 'person', enabled: true, category: 'engagement' },
            { id: 'contact-manager', label: 'Contact Manager', icon: 'supervisor_account', enabled: true, category: 'engagement' },
            { id: 'contact-legal', label: 'Contact Legal', icon: 'gavel', enabled: true, category: 'escalation' },
            { id: 'contact-hr', label: 'Contact HR', icon: 'badge', enabled: true, category: 'escalation' },
            { id: 'create-dlp-rule', label: 'Create new DLP Rule', icon: 'add_circle', enabled: true, category: 'enforcement' },
            { id: 'adjust-dlp-rule', label: 'Adjust related DLP Rule', icon: 'tune', enabled: true, category: 'enforcement' },
            { id: 'activate-smart-block', label: 'Activate Smart Block', icon: 'security', enabled: true, category: 'enforcement' }
        ];
    }

    // Initialize each component with individual try-catch
    try { initTimeSelector(); console.log('initTimeSelector OK'); } catch(e) { console.error('initTimeSelector failed:', e); }
    try { initTheme(); console.log('initTheme OK'); } catch(e) { console.error('initTheme failed:', e); }
    // V6.22: Force branded logo color update after DOM is fully rendered
    setTimeout(() => { updateLogoColors(isDarkMode); }, 0);
    // V6.1: Posture screen (first screen) rendering
    try { renderSecurityPosture(); console.log('renderSecurityPosture OK'); } catch(e) { console.error('renderSecurityPosture failed:', e); }
    // Command screen rendering (pre-render for faster navigation)
    try { renderSeverityCards(); console.log('renderSeverityCards OK'); } catch(e) { console.error('renderSeverityCards failed:', e); }
    try { updateAccordionHeaders(); console.log('updateAccordionHeaders OK'); } catch(e) { console.error('updateAccordionHeaders failed:', e); }
    try { renderDashboardCases(); console.log('renderDashboardCases OK'); } catch(e) { console.error('renderDashboardCases failed:', e); }
    try { renderCommandTotals(); console.log('renderCommandTotals OK'); } catch(e) { console.error('renderCommandTotals failed:', e); } // V6.9: Command totals
    try { renderCaseList(); console.log('renderCaseList OK'); } catch(e) { console.error('renderCaseList failed:', e); }
    try { if (typeof renderFullChat === 'function') renderFullChat(); console.log('renderFullChat OK'); } catch(e) { console.error('renderFullChat failed:', e); }
    try { if (typeof updateApiStatus === 'function') updateApiStatus(); console.log('updateApiStatus OK'); } catch(e) { console.error('updateApiStatus failed:', e); }
    try { renderActionToggles(); console.log('renderActionToggles OK'); } catch(e) { console.error('renderActionToggles failed:', e); }

    console.log('AXIA Demo V6.17: Initialization complete');
});

</script>

<!-- V6.10: Enforcement Action Modals -->
<div id="policy-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center">
    <div class="absolute inset-0 bg-black/50 backdrop-blur-sm" onclick="closePolicyModal()"></div>
    <div id="policy-modal-content" class="relative bg-surface-elevated rounded-xl shadow-2xl border border-border-default p-6 max-w-md w-full mx-4 max-h-[90vh] overflow-y-auto">
        <!-- Content injected dynamically -->
    </div>
</div>

<!-- V6.20: Document Viewer Modal -->
<div id="doc-viewer-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center">
    <div class="absolute inset-0 bg-black/50 backdrop-blur-sm" onclick="closeDocViewer()"></div>
    <div class="relative bg-surface-elevated rounded-xl shadow-2xl border border-border-default max-w-2xl w-full mx-4 max-h-[85vh] flex flex-col">
        <div id="doc-viewer-header" class="flex items-center justify-between px-5 py-3 border-b border-border-default shrink-0">
            <div class="flex items-center gap-3">
                <span class="material-symbols-outlined text-text-secondary">description</span>
                <span id="doc-viewer-title" class="text-sm font-bold text-text-primary">Document Preview</span>
            </div>
            <button onclick="closeDocViewer()" class="w-8 h-8 flex items-center justify-center rounded-lg hover:bg-surface-hover text-text-secondary">
                <span class="material-symbols-outlined">close</span>
            </button>
        </div>
        <div id="doc-viewer-content" class="p-5 overflow-y-auto flex-1 text-sm text-text-primary leading-relaxed">
            <!-- Content injected dynamically -->
        </div>
        <div class="px-5 py-3 border-t border-border-default shrink-0 flex items-center justify-between">
            <div class="flex items-center gap-2 text-xs text-text-muted">
                <span class="material-symbols-outlined text-[14px]">info</span>
                <span>Highlighted sections indicate sensitive content detected by AXIA</span>
            </div>
            <button onclick="closeDocViewer()" class="px-4 py-1.5 text-xs font-medium text-text-secondary bg-surface-hover rounded-lg hover:text-text-primary transition-colors">Close</button>
        </div>
    </div>
</div>

</body>
</html>
